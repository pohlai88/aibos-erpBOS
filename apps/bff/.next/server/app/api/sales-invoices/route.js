/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/sales-invoices/route";
exports.ids = ["app/api/sales-invoices/route"];
exports.modules = {

/***/ "(rsc)/../../node_modules/.pnpm/next@15.5.4_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fsales-invoices%2Froute&page=%2Fapi%2Fsales-invoices%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsales-invoices%2Froute.ts&appDir=C%3A%5CAI-BOS%5Caibos-erpBOS%5Capps%5Cbff%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CAI-BOS%5Caibos-erpBOS%5Capps%5Cbff&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D&isGlobalNotFoundEnabled=!":
/*!**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ../../node_modules/.pnpm/next@15.5.4_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fsales-invoices%2Froute&page=%2Fapi%2Fsales-invoices%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsales-invoices%2Froute.ts&appDir=C%3A%5CAI-BOS%5Caibos-erpBOS%5Capps%5Cbff%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CAI-BOS%5Caibos-erpBOS%5Capps%5Cbff&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D&isGlobalNotFoundEnabled=! ***!
  \**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   handler: () => (/* binding */ handler),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/../../node_modules/.pnpm/next@15.5.4_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/../../node_modules/.pnpm/next@15.5.4_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/../../node_modules/.pnpm/next@15.5.4_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! next/dist/server/request-meta */ \"(rsc)/../../node_modules/.pnpm/next@15.5.4_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/server/request-meta.js\");\n/* harmony import */ var next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! next/dist/server/lib/trace/tracer */ \"(rsc)/../../node_modules/.pnpm/next@15.5.4_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/server/lib/trace/tracer.js\");\n/* harmony import */ var next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var next_dist_shared_lib_router_utils_app_paths__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! next/dist/shared/lib/router/utils/app-paths */ \"next/dist/shared/lib/router/utils/app-paths\");\n/* harmony import */ var next_dist_shared_lib_router_utils_app_paths__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(next_dist_shared_lib_router_utils_app_paths__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! next/dist/server/base-http/node */ \"(rsc)/../../node_modules/.pnpm/next@15.5.4_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/server/base-http/node.js\");\n/* harmony import */ var next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_6__);\n/* harmony import */ var next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! next/dist/server/web/spec-extension/adapters/next-request */ \"(rsc)/../../node_modules/.pnpm/next@15.5.4_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/server/web/spec-extension/adapters/next-request.js\");\n/* harmony import */ var next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_7__);\n/* harmony import */ var next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! next/dist/server/lib/trace/constants */ \"(rsc)/../../node_modules/.pnpm/next@15.5.4_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/server/lib/trace/constants.js\");\n/* harmony import */ var next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_8___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_8__);\n/* harmony import */ var next_dist_server_instrumentation_utils__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! next/dist/server/instrumentation/utils */ \"(rsc)/../../node_modules/.pnpm/next@15.5.4_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/server/instrumentation/utils.js\");\n/* harmony import */ var next_dist_server_send_response__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! next/dist/server/send-response */ \"(rsc)/../../node_modules/.pnpm/next@15.5.4_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/server/send-response.js\");\n/* harmony import */ var next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! next/dist/server/web/utils */ \"(rsc)/../../node_modules/.pnpm/next@15.5.4_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/server/web/utils.js\");\n/* harmony import */ var next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_11___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_11__);\n/* harmony import */ var next_dist_server_lib_cache_control__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! next/dist/server/lib/cache-control */ \"(rsc)/../../node_modules/.pnpm/next@15.5.4_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/server/lib/cache-control.js\");\n/* harmony import */ var next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! next/dist/lib/constants */ \"(rsc)/../../node_modules/.pnpm/next@15.5.4_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/lib/constants.js\");\n/* harmony import */ var next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13___default = /*#__PURE__*/__webpack_require__.n(next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__);\n/* harmony import */ var next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! next/dist/shared/lib/no-fallback-error.external */ \"next/dist/shared/lib/no-fallback-error.external\");\n/* harmony import */ var next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_14___default = /*#__PURE__*/__webpack_require__.n(next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_14__);\n/* harmony import */ var next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! next/dist/server/response-cache */ \"(rsc)/../../node_modules/.pnpm/next@15.5.4_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/server/response-cache/index.js\");\n/* harmony import */ var next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_15___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_15__);\n/* harmony import */ var C_AI_BOS_aibos_erpBOS_apps_bff_app_api_sales_invoices_route_ts__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./app/api/sales-invoices/route.ts */ \"(rsc)/./app/api/sales-invoices/route.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([C_AI_BOS_aibos_erpBOS_apps_bff_app_api_sales_invoices_route_ts__WEBPACK_IMPORTED_MODULE_16__]);\nC_AI_BOS_aibos_erpBOS_apps_bff_app_api_sales_invoices_route_ts__WEBPACK_IMPORTED_MODULE_16__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/sales-invoices/route\",\n        pathname: \"/api/sales-invoices\",\n        filename: \"route\",\n        bundlePath: \"app/api/sales-invoices/route\"\n    },\n    distDir: \".next\" || 0,\n    relativeProjectDir:  false || '',\n    resolvedPagePath: \"C:\\\\AI-BOS\\\\aibos-erpBOS\\\\apps\\\\bff\\\\app\\\\api\\\\sales-invoices\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_AI_BOS_aibos_erpBOS_apps_bff_app_api_sales_invoices_route_ts__WEBPACK_IMPORTED_MODULE_16__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\nasync function handler(req, res, ctx) {\n    var _nextConfig_experimental;\n    let srcPage = \"/api/sales-invoices/route\";\n    // turbopack doesn't normalize `/index` in the page name\n    // so we need to to process dynamic routes properly\n    // TODO: fix turbopack providing differing value from webpack\n    if (false) {} else if (srcPage === '/index') {\n        // we always normalize /index specifically\n        srcPage = '/';\n    }\n    const multiZoneDraftMode = false;\n    const prepareResult = await routeModule.prepare(req, res, {\n        srcPage,\n        multiZoneDraftMode\n    });\n    if (!prepareResult) {\n        res.statusCode = 400;\n        res.end('Bad Request');\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n        return null;\n    }\n    const { buildId, params, nextConfig, isDraftMode, prerenderManifest, routerServerContext, isOnDemandRevalidate, revalidateOnlyGenerated, resolvedPathname } = prepareResult;\n    const normalizedSrcPage = (0,next_dist_shared_lib_router_utils_app_paths__WEBPACK_IMPORTED_MODULE_5__.normalizeAppPath)(srcPage);\n    let isIsr = Boolean(prerenderManifest.dynamicRoutes[normalizedSrcPage] || prerenderManifest.routes[resolvedPathname]);\n    if (isIsr && !isDraftMode) {\n        const isPrerendered = Boolean(prerenderManifest.routes[resolvedPathname]);\n        const prerenderInfo = prerenderManifest.dynamicRoutes[normalizedSrcPage];\n        if (prerenderInfo) {\n            if (prerenderInfo.fallback === false && !isPrerendered) {\n                throw new next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_14__.NoFallbackError();\n            }\n        }\n    }\n    let cacheKey = null;\n    if (isIsr && !routeModule.isDev && !isDraftMode) {\n        cacheKey = resolvedPathname;\n        // ensure /index and / is normalized to one key\n        cacheKey = cacheKey === '/index' ? '/' : cacheKey;\n    }\n    const supportsDynamicResponse = // If we're in development, we always support dynamic HTML\n    routeModule.isDev === true || // If this is not SSG or does not have static paths, then it supports\n    // dynamic HTML.\n    !isIsr;\n    // This is a revalidation request if the request is for a static\n    // page and it is not being resumed from a postponed render and\n    // it is not a dynamic RSC request then it is a revalidation\n    // request.\n    const isRevalidate = isIsr && !supportsDynamicResponse;\n    const method = req.method || 'GET';\n    const tracer = (0,next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4__.getTracer)();\n    const activeSpan = tracer.getActiveScopeSpan();\n    const context = {\n        params,\n        prerenderManifest,\n        renderOpts: {\n            experimental: {\n                cacheComponents: Boolean(nextConfig.experimental.cacheComponents),\n                authInterrupts: Boolean(nextConfig.experimental.authInterrupts)\n            },\n            supportsDynamicResponse,\n            incrementalCache: (0,next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__.getRequestMeta)(req, 'incrementalCache'),\n            cacheLifeProfiles: (_nextConfig_experimental = nextConfig.experimental) == null ? void 0 : _nextConfig_experimental.cacheLife,\n            isRevalidate,\n            waitUntil: ctx.waitUntil,\n            onClose: (cb)=>{\n                res.on('close', cb);\n            },\n            onAfterTaskError: undefined,\n            onInstrumentationRequestError: (error, _request, errorContext)=>routeModule.onRequestError(req, error, errorContext, routerServerContext)\n        },\n        sharedContext: {\n            buildId\n        }\n    };\n    const nodeNextReq = new next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_6__.NodeNextRequest(req);\n    const nodeNextRes = new next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_6__.NodeNextResponse(res);\n    const nextReq = next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_7__.NextRequestAdapter.fromNodeNextRequest(nodeNextReq, (0,next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_7__.signalFromNodeResponse)(res));\n    try {\n        const invokeRouteModule = async (span)=>{\n            return routeModule.handle(nextReq, context).finally(()=>{\n                if (!span) return;\n                span.setAttributes({\n                    'http.status_code': res.statusCode,\n                    'next.rsc': false\n                });\n                const rootSpanAttributes = tracer.getRootSpanAttributes();\n                // We were unable to get attributes, probably OTEL is not enabled\n                if (!rootSpanAttributes) {\n                    return;\n                }\n                if (rootSpanAttributes.get('next.span_type') !== next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_8__.BaseServerSpan.handleRequest) {\n                    console.warn(`Unexpected root span type '${rootSpanAttributes.get('next.span_type')}'. Please report this Next.js issue https://github.com/vercel/next.js`);\n                    return;\n                }\n                const route = rootSpanAttributes.get('next.route');\n                if (route) {\n                    const name = `${method} ${route}`;\n                    span.setAttributes({\n                        'next.route': route,\n                        'http.route': route,\n                        'next.span_name': name\n                    });\n                    span.updateName(name);\n                } else {\n                    span.updateName(`${method} ${req.url}`);\n                }\n            });\n        };\n        const handleResponse = async (currentSpan)=>{\n            var _cacheEntry_value;\n            const responseGenerator = async ({ previousCacheEntry })=>{\n                try {\n                    if (!(0,next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__.getRequestMeta)(req, 'minimalMode') && isOnDemandRevalidate && revalidateOnlyGenerated && !previousCacheEntry) {\n                        res.statusCode = 404;\n                        // on-demand revalidate always sets this header\n                        res.setHeader('x-nextjs-cache', 'REVALIDATED');\n                        res.end('This page could not be found');\n                        return null;\n                    }\n                    const response = await invokeRouteModule(currentSpan);\n                    req.fetchMetrics = context.renderOpts.fetchMetrics;\n                    let pendingWaitUntil = context.renderOpts.pendingWaitUntil;\n                    // Attempt using provided waitUntil if available\n                    // if it's not we fallback to sendResponse's handling\n                    if (pendingWaitUntil) {\n                        if (ctx.waitUntil) {\n                            ctx.waitUntil(pendingWaitUntil);\n                            pendingWaitUntil = undefined;\n                        }\n                    }\n                    const cacheTags = context.renderOpts.collectedTags;\n                    // If the request is for a static response, we can cache it so long\n                    // as it's not edge.\n                    if (isIsr) {\n                        const blob = await response.blob();\n                        // Copy the headers from the response.\n                        const headers = (0,next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_11__.toNodeOutgoingHttpHeaders)(response.headers);\n                        if (cacheTags) {\n                            headers[next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__.NEXT_CACHE_TAGS_HEADER] = cacheTags;\n                        }\n                        if (!headers['content-type'] && blob.type) {\n                            headers['content-type'] = blob.type;\n                        }\n                        const revalidate = typeof context.renderOpts.collectedRevalidate === 'undefined' || context.renderOpts.collectedRevalidate >= next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__.INFINITE_CACHE ? false : context.renderOpts.collectedRevalidate;\n                        const expire = typeof context.renderOpts.collectedExpire === 'undefined' || context.renderOpts.collectedExpire >= next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__.INFINITE_CACHE ? undefined : context.renderOpts.collectedExpire;\n                        // Create the cache entry for the response.\n                        const cacheEntry = {\n                            value: {\n                                kind: next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_15__.CachedRouteKind.APP_ROUTE,\n                                status: response.status,\n                                body: Buffer.from(await blob.arrayBuffer()),\n                                headers\n                            },\n                            cacheControl: {\n                                revalidate,\n                                expire\n                            }\n                        };\n                        return cacheEntry;\n                    } else {\n                        // send response without caching if not ISR\n                        await (0,next_dist_server_send_response__WEBPACK_IMPORTED_MODULE_10__.sendResponse)(nodeNextReq, nodeNextRes, response, context.renderOpts.pendingWaitUntil);\n                        return null;\n                    }\n                } catch (err) {\n                    // if this is a background revalidate we need to report\n                    // the request error here as it won't be bubbled\n                    if (previousCacheEntry == null ? void 0 : previousCacheEntry.isStale) {\n                        await routeModule.onRequestError(req, err, {\n                            routerKind: 'App Router',\n                            routePath: srcPage,\n                            routeType: 'route',\n                            revalidateReason: (0,next_dist_server_instrumentation_utils__WEBPACK_IMPORTED_MODULE_9__.getRevalidateReason)({\n                                isRevalidate,\n                                isOnDemandRevalidate\n                            })\n                        }, routerServerContext);\n                    }\n                    throw err;\n                }\n            };\n            const cacheEntry = await routeModule.handleResponse({\n                req,\n                nextConfig,\n                cacheKey,\n                routeKind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n                isFallback: false,\n                prerenderManifest,\n                isRoutePPREnabled: false,\n                isOnDemandRevalidate,\n                revalidateOnlyGenerated,\n                responseGenerator,\n                waitUntil: ctx.waitUntil\n            });\n            // we don't create a cacheEntry for ISR\n            if (!isIsr) {\n                return null;\n            }\n            if ((cacheEntry == null ? void 0 : (_cacheEntry_value = cacheEntry.value) == null ? void 0 : _cacheEntry_value.kind) !== next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_15__.CachedRouteKind.APP_ROUTE) {\n                var _cacheEntry_value1;\n                throw Object.defineProperty(new Error(`Invariant: app-route received invalid cache entry ${cacheEntry == null ? void 0 : (_cacheEntry_value1 = cacheEntry.value) == null ? void 0 : _cacheEntry_value1.kind}`), \"__NEXT_ERROR_CODE\", {\n                    value: \"E701\",\n                    enumerable: false,\n                    configurable: true\n                });\n            }\n            if (!(0,next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__.getRequestMeta)(req, 'minimalMode')) {\n                res.setHeader('x-nextjs-cache', isOnDemandRevalidate ? 'REVALIDATED' : cacheEntry.isMiss ? 'MISS' : cacheEntry.isStale ? 'STALE' : 'HIT');\n            }\n            // Draft mode should never be cached\n            if (isDraftMode) {\n                res.setHeader('Cache-Control', 'private, no-cache, no-store, max-age=0, must-revalidate');\n            }\n            const headers = (0,next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_11__.fromNodeOutgoingHttpHeaders)(cacheEntry.value.headers);\n            if (!((0,next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__.getRequestMeta)(req, 'minimalMode') && isIsr)) {\n                headers.delete(next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__.NEXT_CACHE_TAGS_HEADER);\n            }\n            // If cache control is already set on the response we don't\n            // override it to allow users to customize it via next.config\n            if (cacheEntry.cacheControl && !res.getHeader('Cache-Control') && !headers.get('Cache-Control')) {\n                headers.set('Cache-Control', (0,next_dist_server_lib_cache_control__WEBPACK_IMPORTED_MODULE_12__.getCacheControlHeader)(cacheEntry.cacheControl));\n            }\n            await (0,next_dist_server_send_response__WEBPACK_IMPORTED_MODULE_10__.sendResponse)(nodeNextReq, nodeNextRes, new Response(cacheEntry.value.body, {\n                headers,\n                status: cacheEntry.value.status || 200\n            }));\n            return null;\n        };\n        // TODO: activeSpan code path is for when wrapped by\n        // next-server can be removed when this is no longer used\n        if (activeSpan) {\n            await handleResponse(activeSpan);\n        } else {\n            await tracer.withPropagatedContext(req.headers, ()=>tracer.trace(next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_8__.BaseServerSpan.handleRequest, {\n                    spanName: `${method} ${req.url}`,\n                    kind: next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4__.SpanKind.SERVER,\n                    attributes: {\n                        'http.method': method,\n                        'http.target': req.url\n                    }\n                }, handleResponse));\n        }\n    } catch (err) {\n        if (!(err instanceof next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_14__.NoFallbackError)) {\n            await routeModule.onRequestError(req, err, {\n                routerKind: 'App Router',\n                routePath: normalizedSrcPage,\n                routeType: 'route',\n                revalidateReason: (0,next_dist_server_instrumentation_utils__WEBPACK_IMPORTED_MODULE_9__.getRevalidateReason)({\n                    isRevalidate,\n                    isOnDemandRevalidate\n                })\n            });\n        }\n        // rethrow so that we can handle serving error page\n        // If this is during static generation, throw the error again.\n        if (isIsr) throw err;\n        // Otherwise, send a 500 response.\n        await (0,next_dist_server_send_response__WEBPACK_IMPORTED_MODULE_10__.sendResponse)(nodeNextReq, nodeNextRes, new Response(null, {\n            status: 500\n        }));\n        return null;\n    }\n}\n\n//# sourceMappingURL=app-route.js.map\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL25leHRAMTUuNS40X3JlYWN0LWRvbUAxOS4xLjFfcmVhY3RAMTkuMS4xX19yZWFjdEAxOS4xLjEvbm9kZV9tb2R1bGVzL25leHQvZGlzdC9idWlsZC93ZWJwYWNrL2xvYWRlcnMvbmV4dC1hcHAtbG9hZGVyL2luZGV4LmpzP25hbWU9YXBwJTJGYXBpJTJGc2FsZXMtaW52b2ljZXMlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRnNhbGVzLWludm9pY2VzJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGc2FsZXMtaW52b2ljZXMlMkZyb3V0ZS50cyZhcHBEaXI9QyUzQSU1Q0FJLUJPUyU1Q2FpYm9zLWVycEJPUyU1Q2FwcHMlNUNiZmYlNUNhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPUMlM0ElNUNBSS1CT1MlNUNhaWJvcy1lcnBCT1MlNUNhcHBzJTVDYmZmJmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEJmlzR2xvYmFsTm90Rm91bmRFbmFibGVkPSEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBK0Y7QUFDdkM7QUFDcUI7QUFDZDtBQUNTO0FBQ087QUFDSztBQUNtQztBQUNqRDtBQUNPO0FBQ2Y7QUFDc0M7QUFDekI7QUFDTTtBQUNDO0FBQ2hCO0FBQ2tDO0FBQ3BHO0FBQ0E7QUFDQTtBQUNBLHdCQUF3Qix5R0FBbUI7QUFDM0M7QUFDQSxjQUFjLGtFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLGFBQWEs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Qiw0RUFBc0I7QUFDckQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2Q0FBNkMsMEZBQXFCO0FBQ2xFO0FBQ0Esa0JBQWtCLDZFQUFZO0FBQzlCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWLDZFQUE2RSxnRkFBYztBQUMzRixpQ0FBaUMsUUFBUSxFQUFFLFFBQVE7QUFDbkQsMEJBQTBCLHVFQUFRO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsTUFBTTtBQUNOLDZCQUE2Qiw2RkFBZTtBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQywyRkFBbUI7QUFDckQ7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsNkVBQVk7QUFDMUI7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBIiwic291cmNlcyI6WyIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0IHsgZ2V0UmVxdWVzdE1ldGEgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yZXF1ZXN0LW1ldGFcIjtcbmltcG9ydCB7IGdldFRyYWNlciwgU3BhbktpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvdHJhY2UvdHJhY2VyXCI7XG5pbXBvcnQgeyBub3JtYWxpemVBcHBQYXRoIH0gZnJvbSBcIm5leHQvZGlzdC9zaGFyZWQvbGliL3JvdXRlci91dGlscy9hcHAtcGF0aHNcIjtcbmltcG9ydCB7IE5vZGVOZXh0UmVxdWVzdCwgTm9kZU5leHRSZXNwb25zZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Jhc2UtaHR0cC9ub2RlXCI7XG5pbXBvcnQgeyBOZXh0UmVxdWVzdEFkYXB0ZXIsIHNpZ25hbEZyb21Ob2RlUmVzcG9uc2UgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci93ZWIvc3BlYy1leHRlbnNpb24vYWRhcHRlcnMvbmV4dC1yZXF1ZXN0XCI7XG5pbXBvcnQgeyBCYXNlU2VydmVyU3BhbiB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi90cmFjZS9jb25zdGFudHNcIjtcbmltcG9ydCB7IGdldFJldmFsaWRhdGVSZWFzb24gfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9pbnN0cnVtZW50YXRpb24vdXRpbHNcIjtcbmltcG9ydCB7IHNlbmRSZXNwb25zZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3NlbmQtcmVzcG9uc2VcIjtcbmltcG9ydCB7IGZyb21Ob2RlT3V0Z29pbmdIdHRwSGVhZGVycywgdG9Ob2RlT3V0Z29pbmdIdHRwSGVhZGVycyB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3dlYi91dGlsc1wiO1xuaW1wb3J0IHsgZ2V0Q2FjaGVDb250cm9sSGVhZGVyIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL2NhY2hlLWNvbnRyb2xcIjtcbmltcG9ydCB7IElORklOSVRFX0NBQ0hFLCBORVhUX0NBQ0hFX1RBR1NfSEVBREVSIH0gZnJvbSBcIm5leHQvZGlzdC9saWIvY29uc3RhbnRzXCI7XG5pbXBvcnQgeyBOb0ZhbGxiYWNrRXJyb3IgfSBmcm9tIFwibmV4dC9kaXN0L3NoYXJlZC9saWIvbm8tZmFsbGJhY2stZXJyb3IuZXh0ZXJuYWxcIjtcbmltcG9ydCB7IENhY2hlZFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3Jlc3BvbnNlLWNhY2hlXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiQzpcXFxcQUktQk9TXFxcXGFpYm9zLWVycEJPU1xcXFxhcHBzXFxcXGJmZlxcXFxhcHBcXFxcYXBpXFxcXHNhbGVzLWludm9pY2VzXFxcXHJvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9zYWxlcy1pbnZvaWNlcy9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3NhbGVzLWludm9pY2VzXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9zYWxlcy1pbnZvaWNlcy9yb3V0ZVwiXG4gICAgfSxcbiAgICBkaXN0RGlyOiBwcm9jZXNzLmVudi5fX05FWFRfUkVMQVRJVkVfRElTVF9ESVIgfHwgJycsXG4gICAgcmVsYXRpdmVQcm9qZWN0RGlyOiBwcm9jZXNzLmVudi5fX05FWFRfUkVMQVRJVkVfUFJPSkVDVF9ESVIgfHwgJycsXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCJDOlxcXFxBSS1CT1NcXFxcYWlib3MtZXJwQk9TXFxcXGFwcHNcXFxcYmZmXFxcXGFwcFxcXFxhcGlcXFxcc2FsZXMtaW52b2ljZXNcXFxccm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyB3b3JrQXN5bmNTdG9yYWdlLCB3b3JrVW5pdEFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICB3b3JrQXN5bmNTdG9yYWdlLFxuICAgICAgICB3b3JrVW5pdEFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHdvcmtBc3luY1N0b3JhZ2UsIHdvcmtVbml0QXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgcGF0Y2hGZXRjaCwgIH07XG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihyZXEsIHJlcywgY3R4KSB7XG4gICAgdmFyIF9uZXh0Q29uZmlnX2V4cGVyaW1lbnRhbDtcbiAgICBsZXQgc3JjUGFnZSA9IFwiL2FwaS9zYWxlcy1pbnZvaWNlcy9yb3V0ZVwiO1xuICAgIC8vIHR1cmJvcGFjayBkb2Vzbid0IG5vcm1hbGl6ZSBgL2luZGV4YCBpbiB0aGUgcGFnZSBuYW1lXG4gICAgLy8gc28gd2UgbmVlZCB0byB0byBwcm9jZXNzIGR5bmFtaWMgcm91dGVzIHByb3Blcmx5XG4gICAgLy8gVE9ETzogZml4IHR1cmJvcGFjayBwcm92aWRpbmcgZGlmZmVyaW5nIHZhbHVlIGZyb20gd2VicGFja1xuICAgIGlmIChwcm9jZXNzLmVudi5UVVJCT1BBQ0spIHtcbiAgICAgICAgc3JjUGFnZSA9IHNyY1BhZ2UucmVwbGFjZSgvXFwvaW5kZXgkLywgJycpIHx8ICcvJztcbiAgICB9IGVsc2UgaWYgKHNyY1BhZ2UgPT09ICcvaW5kZXgnKSB7XG4gICAgICAgIC8vIHdlIGFsd2F5cyBub3JtYWxpemUgL2luZGV4IHNwZWNpZmljYWxseVxuICAgICAgICBzcmNQYWdlID0gJy8nO1xuICAgIH1cbiAgICBjb25zdCBtdWx0aVpvbmVEcmFmdE1vZGUgPSBwcm9jZXNzLmVudi5fX05FWFRfTVVMVElfWk9ORV9EUkFGVF9NT0RFO1xuICAgIGNvbnN0IHByZXBhcmVSZXN1bHQgPSBhd2FpdCByb3V0ZU1vZHVsZS5wcmVwYXJlKHJlcSwgcmVzLCB7XG4gICAgICAgIHNyY1BhZ2UsXG4gICAgICAgIG11bHRpWm9uZURyYWZ0TW9kZVxuICAgIH0pO1xuICAgIGlmICghcHJlcGFyZVJlc3VsdCkge1xuICAgICAgICByZXMuc3RhdHVzQ29kZSA9IDQwMDtcbiAgICAgICAgcmVzLmVuZCgnQmFkIFJlcXVlc3QnKTtcbiAgICAgICAgY3R4LndhaXRVbnRpbCA9PSBudWxsID8gdm9pZCAwIDogY3R4LndhaXRVbnRpbC5jYWxsKGN0eCwgUHJvbWlzZS5yZXNvbHZlKCkpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgeyBidWlsZElkLCBwYXJhbXMsIG5leHRDb25maWcsIGlzRHJhZnRNb2RlLCBwcmVyZW5kZXJNYW5pZmVzdCwgcm91dGVyU2VydmVyQ29udGV4dCwgaXNPbkRlbWFuZFJldmFsaWRhdGUsIHJldmFsaWRhdGVPbmx5R2VuZXJhdGVkLCByZXNvbHZlZFBhdGhuYW1lIH0gPSBwcmVwYXJlUmVzdWx0O1xuICAgIGNvbnN0IG5vcm1hbGl6ZWRTcmNQYWdlID0gbm9ybWFsaXplQXBwUGF0aChzcmNQYWdlKTtcbiAgICBsZXQgaXNJc3IgPSBCb29sZWFuKHByZXJlbmRlck1hbmlmZXN0LmR5bmFtaWNSb3V0ZXNbbm9ybWFsaXplZFNyY1BhZ2VdIHx8IHByZXJlbmRlck1hbmlmZXN0LnJvdXRlc1tyZXNvbHZlZFBhdGhuYW1lXSk7XG4gICAgaWYgKGlzSXNyICYmICFpc0RyYWZ0TW9kZSkge1xuICAgICAgICBjb25zdCBpc1ByZXJlbmRlcmVkID0gQm9vbGVhbihwcmVyZW5kZXJNYW5pZmVzdC5yb3V0ZXNbcmVzb2x2ZWRQYXRobmFtZV0pO1xuICAgICAgICBjb25zdCBwcmVyZW5kZXJJbmZvID0gcHJlcmVuZGVyTWFuaWZlc3QuZHluYW1pY1JvdXRlc1tub3JtYWxpemVkU3JjUGFnZV07XG4gICAgICAgIGlmIChwcmVyZW5kZXJJbmZvKSB7XG4gICAgICAgICAgICBpZiAocHJlcmVuZGVySW5mby5mYWxsYmFjayA9PT0gZmFsc2UgJiYgIWlzUHJlcmVuZGVyZWQpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm9GYWxsYmFja0Vycm9yKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgbGV0IGNhY2hlS2V5ID0gbnVsbDtcbiAgICBpZiAoaXNJc3IgJiYgIXJvdXRlTW9kdWxlLmlzRGV2ICYmICFpc0RyYWZ0TW9kZSkge1xuICAgICAgICBjYWNoZUtleSA9IHJlc29sdmVkUGF0aG5hbWU7XG4gICAgICAgIC8vIGVuc3VyZSAvaW5kZXggYW5kIC8gaXMgbm9ybWFsaXplZCB0byBvbmUga2V5XG4gICAgICAgIGNhY2hlS2V5ID0gY2FjaGVLZXkgPT09ICcvaW5kZXgnID8gJy8nIDogY2FjaGVLZXk7XG4gICAgfVxuICAgIGNvbnN0IHN1cHBvcnRzRHluYW1pY1Jlc3BvbnNlID0gLy8gSWYgd2UncmUgaW4gZGV2ZWxvcG1lbnQsIHdlIGFsd2F5cyBzdXBwb3J0IGR5bmFtaWMgSFRNTFxuICAgIHJvdXRlTW9kdWxlLmlzRGV2ID09PSB0cnVlIHx8IC8vIElmIHRoaXMgaXMgbm90IFNTRyBvciBkb2VzIG5vdCBoYXZlIHN0YXRpYyBwYXRocywgdGhlbiBpdCBzdXBwb3J0c1xuICAgIC8vIGR5bmFtaWMgSFRNTC5cbiAgICAhaXNJc3I7XG4gICAgLy8gVGhpcyBpcyBhIHJldmFsaWRhdGlvbiByZXF1ZXN0IGlmIHRoZSByZXF1ZXN0IGlzIGZvciBhIHN0YXRpY1xuICAgIC8vIHBhZ2UgYW5kIGl0IGlzIG5vdCBiZWluZyByZXN1bWVkIGZyb20gYSBwb3N0cG9uZWQgcmVuZGVyIGFuZFxuICAgIC8vIGl0IGlzIG5vdCBhIGR5bmFtaWMgUlNDIHJlcXVlc3QgdGhlbiBpdCBpcyBhIHJldmFsaWRhdGlvblxuICAgIC8vIHJlcXVlc3QuXG4gICAgY29uc3QgaXNSZXZhbGlkYXRlID0gaXNJc3IgJiYgIXN1cHBvcnRzRHluYW1pY1Jlc3BvbnNlO1xuICAgIGNvbnN0IG1ldGhvZCA9IHJlcS5tZXRob2QgfHwgJ0dFVCc7XG4gICAgY29uc3QgdHJhY2VyID0gZ2V0VHJhY2VyKCk7XG4gICAgY29uc3QgYWN0aXZlU3BhbiA9IHRyYWNlci5nZXRBY3RpdmVTY29wZVNwYW4oKTtcbiAgICBjb25zdCBjb250ZXh0ID0ge1xuICAgICAgICBwYXJhbXMsXG4gICAgICAgIHByZXJlbmRlck1hbmlmZXN0LFxuICAgICAgICByZW5kZXJPcHRzOiB7XG4gICAgICAgICAgICBleHBlcmltZW50YWw6IHtcbiAgICAgICAgICAgICAgICBjYWNoZUNvbXBvbmVudHM6IEJvb2xlYW4obmV4dENvbmZpZy5leHBlcmltZW50YWwuY2FjaGVDb21wb25lbnRzKSxcbiAgICAgICAgICAgICAgICBhdXRoSW50ZXJydXB0czogQm9vbGVhbihuZXh0Q29uZmlnLmV4cGVyaW1lbnRhbC5hdXRoSW50ZXJydXB0cylcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzdXBwb3J0c0R5bmFtaWNSZXNwb25zZSxcbiAgICAgICAgICAgIGluY3JlbWVudGFsQ2FjaGU6IGdldFJlcXVlc3RNZXRhKHJlcSwgJ2luY3JlbWVudGFsQ2FjaGUnKSxcbiAgICAgICAgICAgIGNhY2hlTGlmZVByb2ZpbGVzOiAoX25leHRDb25maWdfZXhwZXJpbWVudGFsID0gbmV4dENvbmZpZy5leHBlcmltZW50YWwpID09IG51bGwgPyB2b2lkIDAgOiBfbmV4dENvbmZpZ19leHBlcmltZW50YWwuY2FjaGVMaWZlLFxuICAgICAgICAgICAgaXNSZXZhbGlkYXRlLFxuICAgICAgICAgICAgd2FpdFVudGlsOiBjdHgud2FpdFVudGlsLFxuICAgICAgICAgICAgb25DbG9zZTogKGNiKT0+e1xuICAgICAgICAgICAgICAgIHJlcy5vbignY2xvc2UnLCBjYik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25BZnRlclRhc2tFcnJvcjogdW5kZWZpbmVkLFxuICAgICAgICAgICAgb25JbnN0cnVtZW50YXRpb25SZXF1ZXN0RXJyb3I6IChlcnJvciwgX3JlcXVlc3QsIGVycm9yQ29udGV4dCk9PnJvdXRlTW9kdWxlLm9uUmVxdWVzdEVycm9yKHJlcSwgZXJyb3IsIGVycm9yQ29udGV4dCwgcm91dGVyU2VydmVyQ29udGV4dClcbiAgICAgICAgfSxcbiAgICAgICAgc2hhcmVkQ29udGV4dDoge1xuICAgICAgICAgICAgYnVpbGRJZFxuICAgICAgICB9XG4gICAgfTtcbiAgICBjb25zdCBub2RlTmV4dFJlcSA9IG5ldyBOb2RlTmV4dFJlcXVlc3QocmVxKTtcbiAgICBjb25zdCBub2RlTmV4dFJlcyA9IG5ldyBOb2RlTmV4dFJlc3BvbnNlKHJlcyk7XG4gICAgY29uc3QgbmV4dFJlcSA9IE5leHRSZXF1ZXN0QWRhcHRlci5mcm9tTm9kZU5leHRSZXF1ZXN0KG5vZGVOZXh0UmVxLCBzaWduYWxGcm9tTm9kZVJlc3BvbnNlKHJlcykpO1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGludm9rZVJvdXRlTW9kdWxlID0gYXN5bmMgKHNwYW4pPT57XG4gICAgICAgICAgICByZXR1cm4gcm91dGVNb2R1bGUuaGFuZGxlKG5leHRSZXEsIGNvbnRleHQpLmZpbmFsbHkoKCk9PntcbiAgICAgICAgICAgICAgICBpZiAoIXNwYW4pIHJldHVybjtcbiAgICAgICAgICAgICAgICBzcGFuLnNldEF0dHJpYnV0ZXMoe1xuICAgICAgICAgICAgICAgICAgICAnaHR0cC5zdGF0dXNfY29kZSc6IHJlcy5zdGF0dXNDb2RlLFxuICAgICAgICAgICAgICAgICAgICAnbmV4dC5yc2MnOiBmYWxzZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJvb3RTcGFuQXR0cmlidXRlcyA9IHRyYWNlci5nZXRSb290U3BhbkF0dHJpYnV0ZXMoKTtcbiAgICAgICAgICAgICAgICAvLyBXZSB3ZXJlIHVuYWJsZSB0byBnZXQgYXR0cmlidXRlcywgcHJvYmFibHkgT1RFTCBpcyBub3QgZW5hYmxlZFxuICAgICAgICAgICAgICAgIGlmICghcm9vdFNwYW5BdHRyaWJ1dGVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHJvb3RTcGFuQXR0cmlidXRlcy5nZXQoJ25leHQuc3Bhbl90eXBlJykgIT09IEJhc2VTZXJ2ZXJTcGFuLmhhbmRsZVJlcXVlc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBVbmV4cGVjdGVkIHJvb3Qgc3BhbiB0eXBlICcke3Jvb3RTcGFuQXR0cmlidXRlcy5nZXQoJ25leHQuc3Bhbl90eXBlJyl9Jy4gUGxlYXNlIHJlcG9ydCB0aGlzIE5leHQuanMgaXNzdWUgaHR0cHM6Ly9naXRodWIuY29tL3ZlcmNlbC9uZXh0LmpzYCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3Qgcm91dGUgPSByb290U3BhbkF0dHJpYnV0ZXMuZ2V0KCduZXh0LnJvdXRlJyk7XG4gICAgICAgICAgICAgICAgaWYgKHJvdXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBgJHttZXRob2R9ICR7cm91dGV9YDtcbiAgICAgICAgICAgICAgICAgICAgc3Bhbi5zZXRBdHRyaWJ1dGVzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICduZXh0LnJvdXRlJzogcm91dGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAnaHR0cC5yb3V0ZSc6IHJvdXRlLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ25leHQuc3Bhbl9uYW1lJzogbmFtZVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgc3Bhbi51cGRhdGVOYW1lKG5hbWUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNwYW4udXBkYXRlTmFtZShgJHttZXRob2R9ICR7cmVxLnVybH1gKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgaGFuZGxlUmVzcG9uc2UgPSBhc3luYyAoY3VycmVudFNwYW4pPT57XG4gICAgICAgICAgICB2YXIgX2NhY2hlRW50cnlfdmFsdWU7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZUdlbmVyYXRvciA9IGFzeW5jICh7IHByZXZpb3VzQ2FjaGVFbnRyeSB9KT0+e1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghZ2V0UmVxdWVzdE1ldGEocmVxLCAnbWluaW1hbE1vZGUnKSAmJiBpc09uRGVtYW5kUmV2YWxpZGF0ZSAmJiByZXZhbGlkYXRlT25seUdlbmVyYXRlZCAmJiAhcHJldmlvdXNDYWNoZUVudHJ5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXMuc3RhdHVzQ29kZSA9IDQwNDtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9uLWRlbWFuZCByZXZhbGlkYXRlIGFsd2F5cyBzZXRzIHRoaXMgaGVhZGVyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXMuc2V0SGVhZGVyKCd4LW5leHRqcy1jYWNoZScsICdSRVZBTElEQVRFRCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzLmVuZCgnVGhpcyBwYWdlIGNvdWxkIG5vdCBiZSBmb3VuZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBpbnZva2VSb3V0ZU1vZHVsZShjdXJyZW50U3Bhbik7XG4gICAgICAgICAgICAgICAgICAgIHJlcS5mZXRjaE1ldHJpY3MgPSBjb250ZXh0LnJlbmRlck9wdHMuZmV0Y2hNZXRyaWNzO1xuICAgICAgICAgICAgICAgICAgICBsZXQgcGVuZGluZ1dhaXRVbnRpbCA9IGNvbnRleHQucmVuZGVyT3B0cy5wZW5kaW5nV2FpdFVudGlsO1xuICAgICAgICAgICAgICAgICAgICAvLyBBdHRlbXB0IHVzaW5nIHByb3ZpZGVkIHdhaXRVbnRpbCBpZiBhdmFpbGFibGVcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgaXQncyBub3Qgd2UgZmFsbGJhY2sgdG8gc2VuZFJlc3BvbnNlJ3MgaGFuZGxpbmdcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBlbmRpbmdXYWl0VW50aWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdHgud2FpdFVudGlsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LndhaXRVbnRpbChwZW5kaW5nV2FpdFVudGlsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZW5kaW5nV2FpdFVudGlsID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNhY2hlVGFncyA9IGNvbnRleHQucmVuZGVyT3B0cy5jb2xsZWN0ZWRUYWdzO1xuICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGUgcmVxdWVzdCBpcyBmb3IgYSBzdGF0aWMgcmVzcG9uc2UsIHdlIGNhbiBjYWNoZSBpdCBzbyBsb25nXG4gICAgICAgICAgICAgICAgICAgIC8vIGFzIGl0J3Mgbm90IGVkZ2UuXG4gICAgICAgICAgICAgICAgICAgIGlmIChpc0lzcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYmxvYiA9IGF3YWl0IHJlc3BvbnNlLmJsb2IoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENvcHkgdGhlIGhlYWRlcnMgZnJvbSB0aGUgcmVzcG9uc2UuXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBoZWFkZXJzID0gdG9Ob2RlT3V0Z29pbmdIdHRwSGVhZGVycyhyZXNwb25zZS5oZWFkZXJzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYWNoZVRhZ3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzW05FWFRfQ0FDSEVfVEFHU19IRUFERVJdID0gY2FjaGVUYWdzO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFoZWFkZXJzWydjb250ZW50LXR5cGUnXSAmJiBibG9iLnR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzWydjb250ZW50LXR5cGUnXSA9IGJsb2IudHlwZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJldmFsaWRhdGUgPSB0eXBlb2YgY29udGV4dC5yZW5kZXJPcHRzLmNvbGxlY3RlZFJldmFsaWRhdGUgPT09ICd1bmRlZmluZWQnIHx8IGNvbnRleHQucmVuZGVyT3B0cy5jb2xsZWN0ZWRSZXZhbGlkYXRlID49IElORklOSVRFX0NBQ0hFID8gZmFsc2UgOiBjb250ZXh0LnJlbmRlck9wdHMuY29sbGVjdGVkUmV2YWxpZGF0ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGV4cGlyZSA9IHR5cGVvZiBjb250ZXh0LnJlbmRlck9wdHMuY29sbGVjdGVkRXhwaXJlID09PSAndW5kZWZpbmVkJyB8fCBjb250ZXh0LnJlbmRlck9wdHMuY29sbGVjdGVkRXhwaXJlID49IElORklOSVRFX0NBQ0hFID8gdW5kZWZpbmVkIDogY29udGV4dC5yZW5kZXJPcHRzLmNvbGxlY3RlZEV4cGlyZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENyZWF0ZSB0aGUgY2FjaGUgZW50cnkgZm9yIHRoZSByZXNwb25zZS5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNhY2hlRW50cnkgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2luZDogQ2FjaGVkUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiByZXNwb25zZS5zdGF0dXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvZHk6IEJ1ZmZlci5mcm9tKGF3YWl0IGJsb2IuYXJyYXlCdWZmZXIoKSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlQ29udHJvbDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXZhbGlkYXRlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHBpcmVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNhY2hlRW50cnk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBzZW5kIHJlc3BvbnNlIHdpdGhvdXQgY2FjaGluZyBpZiBub3QgSVNSXG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBzZW5kUmVzcG9uc2Uobm9kZU5leHRSZXEsIG5vZGVOZXh0UmVzLCByZXNwb25zZSwgY29udGV4dC5yZW5kZXJPcHRzLnBlbmRpbmdXYWl0VW50aWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhpcyBpcyBhIGJhY2tncm91bmQgcmV2YWxpZGF0ZSB3ZSBuZWVkIHRvIHJlcG9ydFxuICAgICAgICAgICAgICAgICAgICAvLyB0aGUgcmVxdWVzdCBlcnJvciBoZXJlIGFzIGl0IHdvbid0IGJlIGJ1YmJsZWRcbiAgICAgICAgICAgICAgICAgICAgaWYgKHByZXZpb3VzQ2FjaGVFbnRyeSA9PSBudWxsID8gdm9pZCAwIDogcHJldmlvdXNDYWNoZUVudHJ5LmlzU3RhbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHJvdXRlTW9kdWxlLm9uUmVxdWVzdEVycm9yKHJlcSwgZXJyLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcm91dGVyS2luZDogJ0FwcCBSb3V0ZXInLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvdXRlUGF0aDogc3JjUGFnZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3V0ZVR5cGU6ICdyb3V0ZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV2YWxpZGF0ZVJlYXNvbjogZ2V0UmV2YWxpZGF0ZVJlYXNvbih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzUmV2YWxpZGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNPbkRlbWFuZFJldmFsaWRhdGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgcm91dGVyU2VydmVyQ29udGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBjb25zdCBjYWNoZUVudHJ5ID0gYXdhaXQgcm91dGVNb2R1bGUuaGFuZGxlUmVzcG9uc2Uoe1xuICAgICAgICAgICAgICAgIHJlcSxcbiAgICAgICAgICAgICAgICBuZXh0Q29uZmlnLFxuICAgICAgICAgICAgICAgIGNhY2hlS2V5LFxuICAgICAgICAgICAgICAgIHJvdXRlS2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgICAgICAgICBpc0ZhbGxiYWNrOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBwcmVyZW5kZXJNYW5pZmVzdCxcbiAgICAgICAgICAgICAgICBpc1JvdXRlUFBSRW5hYmxlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgaXNPbkRlbWFuZFJldmFsaWRhdGUsXG4gICAgICAgICAgICAgICAgcmV2YWxpZGF0ZU9ubHlHZW5lcmF0ZWQsXG4gICAgICAgICAgICAgICAgcmVzcG9uc2VHZW5lcmF0b3IsXG4gICAgICAgICAgICAgICAgd2FpdFVudGlsOiBjdHgud2FpdFVudGlsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vIHdlIGRvbid0IGNyZWF0ZSBhIGNhY2hlRW50cnkgZm9yIElTUlxuICAgICAgICAgICAgaWYgKCFpc0lzcikge1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKChjYWNoZUVudHJ5ID09IG51bGwgPyB2b2lkIDAgOiAoX2NhY2hlRW50cnlfdmFsdWUgPSBjYWNoZUVudHJ5LnZhbHVlKSA9PSBudWxsID8gdm9pZCAwIDogX2NhY2hlRW50cnlfdmFsdWUua2luZCkgIT09IENhY2hlZFJvdXRlS2luZC5BUFBfUk9VVEUpIHtcbiAgICAgICAgICAgICAgICB2YXIgX2NhY2hlRW50cnlfdmFsdWUxO1xuICAgICAgICAgICAgICAgIHRocm93IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShuZXcgRXJyb3IoYEludmFyaWFudDogYXBwLXJvdXRlIHJlY2VpdmVkIGludmFsaWQgY2FjaGUgZW50cnkgJHtjYWNoZUVudHJ5ID09IG51bGwgPyB2b2lkIDAgOiAoX2NhY2hlRW50cnlfdmFsdWUxID0gY2FjaGVFbnRyeS52YWx1ZSkgPT0gbnVsbCA/IHZvaWQgMCA6IF9jYWNoZUVudHJ5X3ZhbHVlMS5raW5kfWApLCBcIl9fTkVYVF9FUlJPUl9DT0RFXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IFwiRTcwMVwiLFxuICAgICAgICAgICAgICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIWdldFJlcXVlc3RNZXRhKHJlcSwgJ21pbmltYWxNb2RlJykpIHtcbiAgICAgICAgICAgICAgICByZXMuc2V0SGVhZGVyKCd4LW5leHRqcy1jYWNoZScsIGlzT25EZW1hbmRSZXZhbGlkYXRlID8gJ1JFVkFMSURBVEVEJyA6IGNhY2hlRW50cnkuaXNNaXNzID8gJ01JU1MnIDogY2FjaGVFbnRyeS5pc1N0YWxlID8gJ1NUQUxFJyA6ICdISVQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIERyYWZ0IG1vZGUgc2hvdWxkIG5ldmVyIGJlIGNhY2hlZFxuICAgICAgICAgICAgaWYgKGlzRHJhZnRNb2RlKSB7XG4gICAgICAgICAgICAgICAgcmVzLnNldEhlYWRlcignQ2FjaGUtQ29udHJvbCcsICdwcml2YXRlLCBuby1jYWNoZSwgbm8tc3RvcmUsIG1heC1hZ2U9MCwgbXVzdC1yZXZhbGlkYXRlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBoZWFkZXJzID0gZnJvbU5vZGVPdXRnb2luZ0h0dHBIZWFkZXJzKGNhY2hlRW50cnkudmFsdWUuaGVhZGVycyk7XG4gICAgICAgICAgICBpZiAoIShnZXRSZXF1ZXN0TWV0YShyZXEsICdtaW5pbWFsTW9kZScpICYmIGlzSXNyKSkge1xuICAgICAgICAgICAgICAgIGhlYWRlcnMuZGVsZXRlKE5FWFRfQ0FDSEVfVEFHU19IRUFERVIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gSWYgY2FjaGUgY29udHJvbCBpcyBhbHJlYWR5IHNldCBvbiB0aGUgcmVzcG9uc2Ugd2UgZG9uJ3RcbiAgICAgICAgICAgIC8vIG92ZXJyaWRlIGl0IHRvIGFsbG93IHVzZXJzIHRvIGN1c3RvbWl6ZSBpdCB2aWEgbmV4dC5jb25maWdcbiAgICAgICAgICAgIGlmIChjYWNoZUVudHJ5LmNhY2hlQ29udHJvbCAmJiAhcmVzLmdldEhlYWRlcignQ2FjaGUtQ29udHJvbCcpICYmICFoZWFkZXJzLmdldCgnQ2FjaGUtQ29udHJvbCcpKSB7XG4gICAgICAgICAgICAgICAgaGVhZGVycy5zZXQoJ0NhY2hlLUNvbnRyb2wnLCBnZXRDYWNoZUNvbnRyb2xIZWFkZXIoY2FjaGVFbnRyeS5jYWNoZUNvbnRyb2wpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGF3YWl0IHNlbmRSZXNwb25zZShub2RlTmV4dFJlcSwgbm9kZU5leHRSZXMsIG5ldyBSZXNwb25zZShjYWNoZUVudHJ5LnZhbHVlLmJvZHksIHtcbiAgICAgICAgICAgICAgICBoZWFkZXJzLFxuICAgICAgICAgICAgICAgIHN0YXR1czogY2FjaGVFbnRyeS52YWx1ZS5zdGF0dXMgfHwgMjAwXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfTtcbiAgICAgICAgLy8gVE9ETzogYWN0aXZlU3BhbiBjb2RlIHBhdGggaXMgZm9yIHdoZW4gd3JhcHBlZCBieVxuICAgICAgICAvLyBuZXh0LXNlcnZlciBjYW4gYmUgcmVtb3ZlZCB3aGVuIHRoaXMgaXMgbm8gbG9uZ2VyIHVzZWRcbiAgICAgICAgaWYgKGFjdGl2ZVNwYW4pIHtcbiAgICAgICAgICAgIGF3YWl0IGhhbmRsZVJlc3BvbnNlKGFjdGl2ZVNwYW4pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYXdhaXQgdHJhY2VyLndpdGhQcm9wYWdhdGVkQ29udGV4dChyZXEuaGVhZGVycywgKCk9PnRyYWNlci50cmFjZShCYXNlU2VydmVyU3Bhbi5oYW5kbGVSZXF1ZXN0LCB7XG4gICAgICAgICAgICAgICAgICAgIHNwYW5OYW1lOiBgJHttZXRob2R9ICR7cmVxLnVybH1gLFxuICAgICAgICAgICAgICAgICAgICBraW5kOiBTcGFuS2luZC5TRVJWRVIsXG4gICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdodHRwLm1ldGhvZCc6IG1ldGhvZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICdodHRwLnRhcmdldCc6IHJlcS51cmxcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIGhhbmRsZVJlc3BvbnNlKSk7XG4gICAgICAgIH1cbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgaWYgKCEoZXJyIGluc3RhbmNlb2YgTm9GYWxsYmFja0Vycm9yKSkge1xuICAgICAgICAgICAgYXdhaXQgcm91dGVNb2R1bGUub25SZXF1ZXN0RXJyb3IocmVxLCBlcnIsIHtcbiAgICAgICAgICAgICAgICByb3V0ZXJLaW5kOiAnQXBwIFJvdXRlcicsXG4gICAgICAgICAgICAgICAgcm91dGVQYXRoOiBub3JtYWxpemVkU3JjUGFnZSxcbiAgICAgICAgICAgICAgICByb3V0ZVR5cGU6ICdyb3V0ZScsXG4gICAgICAgICAgICAgICAgcmV2YWxpZGF0ZVJlYXNvbjogZ2V0UmV2YWxpZGF0ZVJlYXNvbih7XG4gICAgICAgICAgICAgICAgICAgIGlzUmV2YWxpZGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgaXNPbkRlbWFuZFJldmFsaWRhdGVcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gcmV0aHJvdyBzbyB0aGF0IHdlIGNhbiBoYW5kbGUgc2VydmluZyBlcnJvciBwYWdlXG4gICAgICAgIC8vIElmIHRoaXMgaXMgZHVyaW5nIHN0YXRpYyBnZW5lcmF0aW9uLCB0aHJvdyB0aGUgZXJyb3IgYWdhaW4uXG4gICAgICAgIGlmIChpc0lzcikgdGhyb3cgZXJyO1xuICAgICAgICAvLyBPdGhlcndpc2UsIHNlbmQgYSA1MDAgcmVzcG9uc2UuXG4gICAgICAgIGF3YWl0IHNlbmRSZXNwb25zZShub2RlTmV4dFJlcSwgbm9kZU5leHRSZXMsIG5ldyBSZXNwb25zZShudWxsLCB7XG4gICAgICAgICAgICBzdGF0dXM6IDUwMFxuICAgICAgICB9KSk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbn1cblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcFxuIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/.pnpm/next@15.5.4_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fsales-invoices%2Froute&page=%2Fapi%2Fsales-invoices%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsales-invoices%2Froute.ts&appDir=C%3A%5CAI-BOS%5Caibos-erpBOS%5Capps%5Cbff%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CAI-BOS%5Caibos-erpBOS%5Capps%5Cbff&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D&isGlobalNotFoundEnabled=!\n");

/***/ }),

/***/ "(rsc)/../../node_modules/.pnpm/next@15.5.4_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!*************************************************************************************************************************************************************************************!*\
  !*** ../../node_modules/.pnpm/next@15.5.4_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \*************************************************************************************************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(rsc)/../../packages/adapters/db/src/repo.ts":
/*!**********************************************!*\
  !*** ../../packages/adapters/db/src/repo.ts ***!
  \**********************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DrizzleLedgerRepo: () => (/* binding */ DrizzleLedgerRepo),\n/* harmony export */   DrizzleTxManager: () => (/* binding */ DrizzleTxManager)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm_node_postgres__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! drizzle-orm/node-postgres */ \"(rsc)/../../node_modules/.pnpm/drizzle-orm@0.44.5_@types+pg@8.15.5_pg@8.16.3/node_modules/drizzle-orm/node-postgres/driver.js\");\n/* harmony import */ var _schema__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./schema */ \"(rsc)/../../packages/adapters/db/src/schema.ts\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/../../node_modules/.pnpm/drizzle-orm@0.44.5_@types+pg@8.15.5_pg@8.16.3/node_modules/drizzle-orm/sql/expressions/conditions.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([drizzle_orm_node_postgres__WEBPACK_IMPORTED_MODULE_1__]);\ndrizzle_orm_node_postgres__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\nclass DrizzleTxManager {\n    constructor(pool){\n        this.pool = pool;\n    }\n    async run(fn) {\n        const client = await this.pool.connect();\n        try {\n            await client.query(\"BEGIN\");\n            const res = await fn({\n                client\n            });\n            await client.query(\"COMMIT\");\n            return res;\n        } catch (e) {\n            await client.query(\"ROLLBACK\");\n            throw e;\n        } finally{\n            client.release();\n        }\n    }\n}\nclass DrizzleLedgerRepo {\n    constructor(pool){\n        this.pool = pool;\n        this.db = (0,drizzle_orm_node_postgres__WEBPACK_IMPORTED_MODULE_1__.drizzle)(pool, {\n            schema: _schema__WEBPACK_IMPORTED_MODULE_0__\n        });\n    }\n    dbFrom(tx) {\n        return tx ? (0,drizzle_orm_node_postgres__WEBPACK_IMPORTED_MODULE_1__.drizzle)(tx.client, {\n            schema: _schema__WEBPACK_IMPORTED_MODULE_0__\n        }) : this.db;\n    }\n    async existsByKey(key, tx) {\n        const db = this.dbFrom(tx);\n        const rows = await db.select({\n            id: _schema__WEBPACK_IMPORTED_MODULE_0__.journal.id\n        }).from(_schema__WEBPACK_IMPORTED_MODULE_0__.journal).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_schema__WEBPACK_IMPORTED_MODULE_0__.journal.idempotencyKey, key)).limit(1);\n        return rows.length > 0;\n    }\n    async getIdByKey(key, tx) {\n        const db = this.dbFrom(tx);\n        const rows = await db.select({\n            id: _schema__WEBPACK_IMPORTED_MODULE_0__.journal.id\n        }).from(_schema__WEBPACK_IMPORTED_MODULE_0__.journal).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_schema__WEBPACK_IMPORTED_MODULE_0__.journal.idempotencyKey, key)).limit(1);\n        return rows[0]?.id ?? null;\n    }\n    async insertJournal(j, tx) {\n        const db = this.dbFrom(tx);\n        const id = crypto.randomUUID();\n        await db.insert(_schema__WEBPACK_IMPORTED_MODULE_0__.journal).values({\n            id,\n            companyId: j.company_id,\n            postingDate: new Date(j.posting_date),\n            currency: j.currency,\n            sourceDoctype: j.source_doctype,\n            sourceId: j.source_id,\n            idempotencyKey: j.idempotency_key\n        });\n        for (const l of j.lines){\n            await db.insert(_schema__WEBPACK_IMPORTED_MODULE_0__.journalLine).values({\n                id: crypto.randomUUID(),\n                journalId: id,\n                accountCode: l.account_code,\n                dc: l.dc,\n                amount: l.amount.amount,\n                currency: l.currency,\n                partyType: l.party_type,\n                partyId: l.party_id\n            });\n        }\n        return {\n            id,\n            lines: j.lines\n        };\n    }\n    async trialBalance(companyId, currency, tx) {\n        const db = this.dbFrom(tx);\n        // Query journal lines for the company and currency\n        const lines = await db.select({\n            account_code: _schema__WEBPACK_IMPORTED_MODULE_0__.journalLine.accountCode,\n            dc: _schema__WEBPACK_IMPORTED_MODULE_0__.journalLine.dc,\n            amount: _schema__WEBPACK_IMPORTED_MODULE_0__.journalLine.amount,\n            currency: _schema__WEBPACK_IMPORTED_MODULE_0__.journalLine.currency\n        }).from(_schema__WEBPACK_IMPORTED_MODULE_0__.journalLine).innerJoin(_schema__WEBPACK_IMPORTED_MODULE_0__.journal, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_schema__WEBPACK_IMPORTED_MODULE_0__.journalLine.journalId, _schema__WEBPACK_IMPORTED_MODULE_0__.journal.id)).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_schema__WEBPACK_IMPORTED_MODULE_0__.journal.companyId, companyId), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_2__.eq)(_schema__WEBPACK_IMPORTED_MODULE_0__.journalLine.currency, currency)));\n        // Aggregate by account\n        const acc = new Map();\n        for (const line of lines){\n            const key = line.account_code;\n            const slot = acc.get(key) ?? {\n                d: 0,\n                c: 0\n            };\n            const amt = Number(line.amount);\n            if (line.dc === \"D\") slot.d += amt;\n            else slot.c += amt;\n            acc.set(key, slot);\n        }\n        // Convert to trial balance rows\n        const rows = [];\n        for (const [account_code, v] of acc.entries()){\n            rows.push({\n                account_code,\n                debit: v.d.toFixed(2),\n                credit: v.c.toFixed(2),\n                currency\n            });\n        }\n        // Sort for stable UI\n        rows.sort((a, b)=>a.account_code.localeCompare(b.account_code));\n        return rows;\n    }\n    async enqueueOutbox(event, tx) {\n        const db = this.dbFrom(tx);\n        await db.insert(_schema__WEBPACK_IMPORTED_MODULE_0__.outbox).values({\n            id: crypto.randomUUID(),\n            topic: event?._meta?.name ?? \"Event\",\n            payload: JSON.stringify(event)\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vcGFja2FnZXMvYWRhcHRlcnMvZGIvc3JjL3JlcG8udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBb0Q7QUFFakI7QUFDRztBQUkvQixNQUFNSTtJQUNYLFlBQVksSUFBa0IsQ0FBRTthQUFaQyxPQUFBQTtJQUFjO0lBQ2xDLE1BQU1DLElBQU9DLEVBQTRCLEVBQWM7UUFDckQsTUFBTUMsU0FBUyxNQUFNLElBQUksQ0FBQ0gsSUFBSSxDQUFDSSxPQUFPO1FBQ3RDLElBQUk7WUFDRixNQUFNRCxPQUFPRSxLQUFLLENBQUM7WUFDbkIsTUFBTUMsTUFBTSxNQUFNSixHQUFHO2dCQUFFQztZQUFPO1lBQzlCLE1BQU1BLE9BQU9FLEtBQUssQ0FBQztZQUNuQixPQUFPQztRQUNULEVBQUUsT0FBT0MsR0FBRztZQUNWLE1BQU1KLE9BQU9FLEtBQUssQ0FBQztZQUNuQixNQUFNRTtRQUNSLFNBQVU7WUFDUkosT0FBT0ssT0FBTztRQUNoQjtJQUNGO0FBQ0Y7QUFFTyxNQUFNQztJQUVYLFlBQVksSUFBa0IsQ0FBRTthQUFaVCxPQUFBQTtRQUNsQixJQUFJLENBQUNVLEVBQUUsR0FBR2Ysa0VBQU9BLENBQUNLLE1BQU07WUFBRUosTUFBTUEsc0NBQUFBO1FBQUM7SUFDbkM7SUFFUWUsT0FBT0MsRUFBUyxFQUFFO1FBQ3hCLE9BQU9BLEtBQUtqQixrRUFBT0EsQ0FBQ2lCLEdBQUdULE1BQU0sRUFBRTtZQUFFUCxNQUFNQSxzQ0FBQUE7UUFBQyxLQUFLLElBQUksQ0FBQ2MsRUFBRTtJQUN0RDtJQUVBLE1BQU1HLFlBQVlDLEdBQVcsRUFBRUYsRUFBUyxFQUFvQjtRQUMxRCxNQUFNRixLQUFLLElBQUksQ0FBQ0MsTUFBTSxDQUFDQztRQUN2QixNQUFNRyxPQUFPLE1BQU1MLEdBQUdNLE1BQU0sQ0FBQztZQUFFQyxJQUFJckIsNENBQWMsQ0FBQ3FCLEVBQUU7UUFBQyxHQUNsREUsSUFBSSxDQUFDdkIsNENBQWMsRUFDbkJ3QixLQUFLLENBQUN2QiwrQ0FB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UyxLQUFLVixFQUFFLEtBQUssS0FBS1csS0FBS0UsQ0FBQyxJQUFJRTtpQkFBVUosS0FBS0csQ0FBQyxJQUFJQztZQUNuRFAsSUFBSVMsR0FBRyxDQUFDbkQsS0FBSzZDO1FBQ2Y7UUFFQSxnQ0FBZ0M7UUFDaEMsTUFBTTVDLE9BQXlGLEVBQUU7UUFDakcsS0FBSyxNQUFNLENBQUNnQyxjQUFjbUIsRUFBRSxJQUFJVixJQUFJVyxPQUFPLEdBQUk7WUFDN0NwRCxLQUFLcUQsSUFBSSxDQUFDO2dCQUNSckI7Z0JBQ0FzQixPQUFPSCxFQUFFTCxDQUFDLENBQUNTLE9BQU8sQ0FBQztnQkFDbkJDLFFBQVFMLEVBQUVKLENBQUMsQ0FBQ1EsT0FBTyxDQUFDO2dCQUNwQmxDO1lBQ0Y7UUFDRjtRQUVBLHFCQUFxQjtRQUNyQnJCLEtBQUt5RCxJQUFJLENBQUMsQ0FBQ0MsR0FBR0MsSUFBTUQsRUFBRTFCLFlBQVksQ0FBQzRCLGFBQWEsQ0FBQ0QsRUFBRTNCLFlBQVk7UUFDL0QsT0FBT2hDO0lBQ1Q7SUFFQSxNQUFNNkQsY0FBY0MsS0FBYyxFQUFFakUsRUFBUyxFQUFpQjtRQUM1RCxNQUFNRixLQUFLLElBQUksQ0FBQ0MsTUFBTSxDQUFDQztRQUN2QixNQUFNRixHQUFHbUIsTUFBTSxDQUFDakMsMkNBQWEsRUFBRWtDLE1BQU0sQ0FBQztZQUNwQ2IsSUFBSVUsT0FBT0MsVUFBVTtZQUNyQm1ELE9BQU8sT0FBZ0JDLE9BQU9DLFFBQVE7WUFDdENDLFNBQVNDLEtBQUtDLFNBQVMsQ0FBQ1A7UUFDMUI7SUFDRjtBQUNGIiwic291cmNlcyI6WyJDOlxcQUktQk9TXFxhaWJvcy1lcnBCT1NcXHBhY2thZ2VzXFxhZGFwdGVyc1xcZGJcXHNyY1xccmVwby50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBkcml6emxlIH0gZnJvbSBcImRyaXp6bGUtb3JtL25vZGUtcG9zdGdyZXNcIjtcclxuaW1wb3J0IHsgUG9vbCwgUG9vbENsaWVudCB9IGZyb20gXCJwZ1wiO1xyXG5pbXBvcnQgKiBhcyBzY2hlbWEgZnJvbSBcIi4vc2NoZW1hXCI7XHJcbmltcG9ydCB7IGVxLCBhbmQgfSBmcm9tIFwiZHJpenpsZS1vcm1cIjtcclxuaW1wb3J0IHR5cGUgeyBMZWRnZXJSZXBvLCBSZXBvSm91cm5hbCwgUmVwb0pvdXJuYWxMaW5lLCBUeCwgVHhNYW5hZ2VyIH0gZnJvbSBcIkBhaWJvcy9wb3J0c1wiO1xyXG5cclxuZXhwb3J0IHR5cGUgRGJUeCA9IHsgY2xpZW50OiBQb29sQ2xpZW50IH07XHJcbmV4cG9ydCBjbGFzcyBEcml6emxlVHhNYW5hZ2VyIGltcGxlbWVudHMgVHhNYW5hZ2VyIHtcclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHBvb2w6IFBvb2wpIHsgfVxyXG4gIGFzeW5jIHJ1bjxUPihmbjogKHR4OiBEYlR4KSA9PiBQcm9taXNlPFQ+KTogUHJvbWlzZTxUPiB7XHJcbiAgICBjb25zdCBjbGllbnQgPSBhd2FpdCB0aGlzLnBvb2wuY29ubmVjdCgpO1xyXG4gICAgdHJ5IHtcclxuICAgICAgYXdhaXQgY2xpZW50LnF1ZXJ5KFwiQkVHSU5cIik7XHJcbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZuKHsgY2xpZW50IH0pO1xyXG4gICAgICBhd2FpdCBjbGllbnQucXVlcnkoXCJDT01NSVRcIik7XHJcbiAgICAgIHJldHVybiByZXM7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIGF3YWl0IGNsaWVudC5xdWVyeShcIlJPTExCQUNLXCIpO1xyXG4gICAgICB0aHJvdyBlO1xyXG4gICAgfSBmaW5hbGx5IHtcclxuICAgICAgY2xpZW50LnJlbGVhc2UoKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBEcml6emxlTGVkZ2VyUmVwbyBpbXBsZW1lbnRzIExlZGdlclJlcG8ge1xyXG4gIHByaXZhdGUgZGI7XHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBwb29sOiBQb29sKSB7XHJcbiAgICB0aGlzLmRiID0gZHJpenpsZShwb29sLCB7IHNjaGVtYSB9KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZGJGcm9tKHR4PzogRGJUeCkge1xyXG4gICAgcmV0dXJuIHR4ID8gZHJpenpsZSh0eC5jbGllbnQsIHsgc2NoZW1hIH0pIDogdGhpcy5kYjtcclxuICB9XHJcblxyXG4gIGFzeW5jIGV4aXN0c0J5S2V5KGtleTogc3RyaW5nLCB0eD86IERiVHgpOiBQcm9taXNlPGJvb2xlYW4+IHtcclxuICAgIGNvbnN0IGRiID0gdGhpcy5kYkZyb20odHgpO1xyXG4gICAgY29uc3Qgcm93cyA9IGF3YWl0IGRiLnNlbGVjdCh7IGlkOiBzY2hlbWEuam91cm5hbC5pZCB9KVxyXG4gICAgICAuZnJvbShzY2hlbWEuam91cm5hbClcclxuICAgICAgLndoZXJlKGVxKHNjaGVtYS5qb3VybmFsLmlkZW1wb3RlbmN5S2V5LCBrZXkpKVxyXG4gICAgICAubGltaXQoMSk7XHJcbiAgICByZXR1cm4gcm93cy5sZW5ndGggPiAwO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2V0SWRCeUtleShrZXk6IHN0cmluZywgdHg/OiBEYlR4KTogUHJvbWlzZTxzdHJpbmcgfCBudWxsPiB7XHJcbiAgICBjb25zdCBkYiA9IHRoaXMuZGJGcm9tKHR4KTtcclxuICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBkYi5zZWxlY3QoeyBpZDogc2NoZW1hLmpvdXJuYWwuaWQgfSlcclxuICAgICAgLmZyb20oc2NoZW1hLmpvdXJuYWwpXHJcbiAgICAgIC53aGVyZShlcShzY2hlbWEuam91cm5hbC5pZGVtcG90ZW5jeUtleSwga2V5KSlcclxuICAgICAgLmxpbWl0KDEpO1xyXG4gICAgcmV0dXJuIHJvd3NbMF0/LmlkID8/IG51bGw7XHJcbiAgfVxyXG5cclxuICBhc3luYyBpbnNlcnRKb3VybmFsKGo6IE9taXQ8UmVwb0pvdXJuYWwsIFwiaWRcIj4sIHR4PzogRGJUeCkge1xyXG4gICAgY29uc3QgZGIgPSB0aGlzLmRiRnJvbSh0eCk7XHJcbiAgICBjb25zdCBpZCA9IGNyeXB0by5yYW5kb21VVUlEKCk7XHJcbiAgICBhd2FpdCBkYi5pbnNlcnQoc2NoZW1hLmpvdXJuYWwpLnZhbHVlcyh7XHJcbiAgICAgIGlkLFxyXG4gICAgICBjb21wYW55SWQ6IGouY29tcGFueV9pZCxcclxuICAgICAgcG9zdGluZ0RhdGU6IG5ldyBEYXRlKGoucG9zdGluZ19kYXRlKSxcclxuICAgICAgY3VycmVuY3k6IGouY3VycmVuY3ksXHJcbiAgICAgIHNvdXJjZURvY3R5cGU6IGouc291cmNlX2RvY3R5cGUsXHJcbiAgICAgIHNvdXJjZUlkOiBqLnNvdXJjZV9pZCxcclxuICAgICAgaWRlbXBvdGVuY3lLZXk6IGouaWRlbXBvdGVuY3lfa2V5XHJcbiAgICB9KTtcclxuICAgIGZvciAoY29uc3QgbCBvZiBqLmxpbmVzKSB7XHJcbiAgICAgIGF3YWl0IGRiLmluc2VydChzY2hlbWEuam91cm5hbExpbmUpLnZhbHVlcyh7XHJcbiAgICAgICAgaWQ6IGNyeXB0by5yYW5kb21VVUlEKCksXHJcbiAgICAgICAgam91cm5hbElkOiBpZCxcclxuICAgICAgICBhY2NvdW50Q29kZTogbC5hY2NvdW50X2NvZGUsXHJcbiAgICAgICAgZGM6IGwuZGMsXHJcbiAgICAgICAgYW1vdW50OiBsLmFtb3VudC5hbW91bnQsXHJcbiAgICAgICAgY3VycmVuY3k6IGwuY3VycmVuY3ksXHJcbiAgICAgICAgcGFydHlUeXBlOiBsLnBhcnR5X3R5cGUsXHJcbiAgICAgICAgcGFydHlJZDogbC5wYXJ0eV9pZFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIHJldHVybiB7IGlkLCBsaW5lczogai5saW5lcyB9O1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgdHJpYWxCYWxhbmNlKGNvbXBhbnlJZDogc3RyaW5nLCBjdXJyZW5jeTogc3RyaW5nLCB0eD86IERiVHgpOiBQcm9taXNlPEFycmF5PHsgYWNjb3VudF9jb2RlOiBzdHJpbmcsIGRlYml0OiBzdHJpbmcsIGNyZWRpdDogc3RyaW5nLCBjdXJyZW5jeTogc3RyaW5nIH0+PiB7XHJcbiAgICBjb25zdCBkYiA9IHRoaXMuZGJGcm9tKHR4KTtcclxuXHJcbiAgICAvLyBRdWVyeSBqb3VybmFsIGxpbmVzIGZvciB0aGUgY29tcGFueSBhbmQgY3VycmVuY3lcclxuICAgIGNvbnN0IGxpbmVzID0gYXdhaXQgZGJcclxuICAgICAgLnNlbGVjdCh7XHJcbiAgICAgICAgYWNjb3VudF9jb2RlOiBzY2hlbWEuam91cm5hbExpbmUuYWNjb3VudENvZGUsXHJcbiAgICAgICAgZGM6IHNjaGVtYS5qb3VybmFsTGluZS5kYyxcclxuICAgICAgICBhbW91bnQ6IHNjaGVtYS5qb3VybmFsTGluZS5hbW91bnQsXHJcbiAgICAgICAgY3VycmVuY3k6IHNjaGVtYS5qb3VybmFsTGluZS5jdXJyZW5jeVxyXG4gICAgICB9KVxyXG4gICAgICAuZnJvbShzY2hlbWEuam91cm5hbExpbmUpXHJcbiAgICAgIC5pbm5lckpvaW4oc2NoZW1hLmpvdXJuYWwsIGVxKHNjaGVtYS5qb3VybmFsTGluZS5qb3VybmFsSWQsIHNjaGVtYS5qb3VybmFsLmlkKSlcclxuICAgICAgLndoZXJlKFxyXG4gICAgICAgIGFuZChcclxuICAgICAgICAgIGVxKHNjaGVtYS5qb3VybmFsLmNvbXBhbnlJZCwgY29tcGFueUlkKSxcclxuICAgICAgICAgIGVxKHNjaGVtYS5qb3VybmFsTGluZS5jdXJyZW5jeSwgY3VycmVuY3kpXHJcbiAgICAgICAgKVxyXG4gICAgICApO1xyXG5cclxuICAgIC8vIEFnZ3JlZ2F0ZSBieSBhY2NvdW50XHJcbiAgICBjb25zdCBhY2MgPSBuZXcgTWFwPHN0cmluZywgeyBkOiBudW1iZXI7IGM6IG51bWJlciB9PigpO1xyXG4gICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XHJcbiAgICAgIGNvbnN0IGtleSA9IGxpbmUuYWNjb3VudF9jb2RlO1xyXG4gICAgICBjb25zdCBzbG90ID0gYWNjLmdldChrZXkpID8/IHsgZDogMCwgYzogMCB9O1xyXG4gICAgICBjb25zdCBhbXQgPSBOdW1iZXIobGluZS5hbW91bnQpO1xyXG4gICAgICBpZiAobGluZS5kYyA9PT0gXCJEXCIpIHNsb3QuZCArPSBhbXQ7IGVsc2Ugc2xvdC5jICs9IGFtdDtcclxuICAgICAgYWNjLnNldChrZXksIHNsb3QpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENvbnZlcnQgdG8gdHJpYWwgYmFsYW5jZSByb3dzXHJcbiAgICBjb25zdCByb3dzOiBBcnJheTx7IGFjY291bnRfY29kZTogc3RyaW5nLCBkZWJpdDogc3RyaW5nLCBjcmVkaXQ6IHN0cmluZywgY3VycmVuY3k6IHN0cmluZyB9PiA9IFtdO1xyXG4gICAgZm9yIChjb25zdCBbYWNjb3VudF9jb2RlLCB2XSBvZiBhY2MuZW50cmllcygpKSB7XHJcbiAgICAgIHJvd3MucHVzaCh7XHJcbiAgICAgICAgYWNjb3VudF9jb2RlLFxyXG4gICAgICAgIGRlYml0OiB2LmQudG9GaXhlZCgyKSxcclxuICAgICAgICBjcmVkaXQ6IHYuYy50b0ZpeGVkKDIpLFxyXG4gICAgICAgIGN1cnJlbmN5XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFNvcnQgZm9yIHN0YWJsZSBVSVxyXG4gICAgcm93cy5zb3J0KChhLCBiKSA9PiBhLmFjY291bnRfY29kZS5sb2NhbGVDb21wYXJlKGIuYWNjb3VudF9jb2RlKSk7XHJcbiAgICByZXR1cm4gcm93cztcclxuICB9XHJcblxyXG4gIGFzeW5jIGVucXVldWVPdXRib3goZXZlbnQ6IHVua25vd24sIHR4PzogRGJUeCk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgY29uc3QgZGIgPSB0aGlzLmRiRnJvbSh0eCk7XHJcbiAgICBhd2FpdCBkYi5pbnNlcnQoc2NoZW1hLm91dGJveCkudmFsdWVzKHtcclxuICAgICAgaWQ6IGNyeXB0by5yYW5kb21VVUlEKCksXHJcbiAgICAgIHRvcGljOiAoZXZlbnQgYXMgYW55KT8uX21ldGE/Lm5hbWUgPz8gXCJFdmVudFwiLFxyXG4gICAgICBwYXlsb2FkOiBKU09OLnN0cmluZ2lmeShldmVudClcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG4iXSwibmFtZXMiOlsiZHJpenpsZSIsInNjaGVtYSIsImVxIiwiYW5kIiwiRHJpenpsZVR4TWFuYWdlciIsInBvb2wiLCJydW4iLCJmbiIsImNsaWVudCIsImNvbm5lY3QiLCJxdWVyeSIsInJlcyIsImUiLCJyZWxlYXNlIiwiRHJpenpsZUxlZGdlclJlcG8iLCJkYiIsImRiRnJvbSIsInR4IiwiZXhpc3RzQnlLZXkiLCJrZXkiLCJyb3dzIiwic2VsZWN0IiwiaWQiLCJqb3VybmFsIiwiZnJvbSIsIndoZXJlIiwiaWRlbXBvdGVuY3lLZXkiLCJsaW1pdCIsImxlbmd0aCIsImdldElkQnlLZXkiLCJpbnNlcnRKb3VybmFsIiwiaiIsImNyeXB0byIsInJhbmRvbVVVSUQiLCJpbnNlcnQiLCJ2YWx1ZXMiLCJjb21wYW55SWQiLCJjb21wYW55X2lkIiwicG9zdGluZ0RhdGUiLCJEYXRlIiwicG9zdGluZ19kYXRlIiwiY3VycmVuY3kiLCJzb3VyY2VEb2N0eXBlIiwic291cmNlX2RvY3R5cGUiLCJzb3VyY2VJZCIsInNvdXJjZV9pZCIsImlkZW1wb3RlbmN5X2tleSIsImwiLCJsaW5lcyIsImpvdXJuYWxMaW5lIiwiam91cm5hbElkIiwiYWNjb3VudENvZGUiLCJhY2NvdW50X2NvZGUiLCJkYyIsImFtb3VudCIsInBhcnR5VHlwZSIsInBhcnR5X3R5cGUiLCJwYXJ0eUlkIiwicGFydHlfaWQiLCJ0cmlhbEJhbGFuY2UiLCJpbm5lckpvaW4iLCJhY2MiLCJNYXAiLCJsaW5lIiwic2xvdCIsImdldCIsImQiLCJjIiwiYW10IiwiTnVtYmVyIiwic2V0IiwidiIsImVudHJpZXMiLCJwdXNoIiwiZGViaXQiLCJ0b0ZpeGVkIiwiY3JlZGl0Iiwic29ydCIsImEiLCJiIiwibG9jYWxlQ29tcGFyZSIsImVucXVldWVPdXRib3giLCJldmVudCIsIm91dGJveCIsInRvcGljIiwiX21ldGEiLCJuYW1lIiwicGF5bG9hZCIsIkpTT04iLCJzdHJpbmdpZnkiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/../../packages/adapters/db/src/repo.ts\n");

/***/ }),

/***/ "(rsc)/../../packages/adapters/db/src/schema.ts":
/*!************************************************!*\
  !*** ../../packages/adapters/db/src/schema.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   account: () => (/* binding */ account),\n/* harmony export */   accountingPeriod: () => (/* binding */ accountingPeriod),\n/* harmony export */   apiKey: () => (/* binding */ apiKey),\n/* harmony export */   appUser: () => (/* binding */ appUser),\n/* harmony export */   company: () => (/* binding */ company),\n/* harmony export */   item: () => (/* binding */ item),\n/* harmony export */   itemCosts: () => (/* binding */ itemCosts),\n/* harmony export */   journal: () => (/* binding */ journal),\n/* harmony export */   journalLine: () => (/* binding */ journalLine),\n/* harmony export */   membership: () => (/* binding */ membership),\n/* harmony export */   outbox: () => (/* binding */ outbox),\n/* harmony export */   payment: () => (/* binding */ payment),\n/* harmony export */   paymentAllocation: () => (/* binding */ paymentAllocation),\n/* harmony export */   stockLedger: () => (/* binding */ stockLedger)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! drizzle-orm/pg-core */ \"(rsc)/../../node_modules/.pnpm/drizzle-orm@0.44.5_@types+pg@8.15.5_pg@8.16.3/node_modules/drizzle-orm/pg-core/table.js\");\n/* harmony import */ var drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! drizzle-orm/pg-core */ \"(rsc)/../../node_modules/.pnpm/drizzle-orm@0.44.5_@types+pg@8.15.5_pg@8.16.3/node_modules/drizzle-orm/pg-core/columns/text.js\");\n/* harmony import */ var drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! drizzle-orm/pg-core */ \"(rsc)/../../node_modules/.pnpm/drizzle-orm@0.44.5_@types+pg@8.15.5_pg@8.16.3/node_modules/drizzle-orm/pg-core/columns/char.js\");\n/* harmony import */ var drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! drizzle-orm/pg-core */ \"(rsc)/../../node_modules/.pnpm/drizzle-orm@0.44.5_@types+pg@8.15.5_pg@8.16.3/node_modules/drizzle-orm/pg-core/columns/timestamp.js\");\n/* harmony import */ var drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! drizzle-orm/pg-core */ \"(rsc)/../../node_modules/.pnpm/drizzle-orm@0.44.5_@types+pg@8.15.5_pg@8.16.3/node_modules/drizzle-orm/pg-core/primary-keys.js\");\n/* harmony import */ var drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! drizzle-orm/pg-core */ \"(rsc)/../../node_modules/.pnpm/drizzle-orm@0.44.5_@types+pg@8.15.5_pg@8.16.3/node_modules/drizzle-orm/pg-core/columns/numeric.js\");\n\nconst company = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_0__.pgTable)(\"company\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"id\").primaryKey(),\n    code: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"code\").notNull().unique(),\n    name: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"name\").notNull(),\n    currency: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__.char)(\"currency\", {\n        length: 3\n    }).notNull()\n});\nconst account = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_0__.pgTable)(\"account\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"id\").primaryKey(),\n    companyId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"company_id\").references(()=>company.id).notNull(),\n    code: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"code\").notNull(),\n    name: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"name\").notNull(),\n    type: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"type\").notNull(),\n    normalBalance: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__.char)(\"normal_balance\", {\n        length: 1\n    }).notNull(),\n    parentCode: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"parent_code\")\n});\nconst accountingPeriod = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_0__.pgTable)(\"accounting_period\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"id\").primaryKey(),\n    companyId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"company_id\").references(()=>company.id).notNull(),\n    code: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"code\").notNull(),\n    startDate: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.timestamp)(\"start_date\", {\n        withTimezone: true\n    }).notNull(),\n    endDate: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.timestamp)(\"end_date\", {\n        withTimezone: true\n    }).notNull(),\n    status: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"status\").notNull()\n}, (t)=>({\n        uniq: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.primaryKey)({\n            columns: [\n                t.id\n            ]\n        })\n    }));\nconst journal = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_0__.pgTable)(\"journal\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"id\").primaryKey(),\n    companyId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"company_id\").references(()=>company.id).notNull(),\n    postingDate: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.timestamp)(\"posting_date\", {\n        withTimezone: true\n    }).notNull(),\n    currency: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__.char)(\"currency\", {\n        length: 3\n    }).notNull(),\n    sourceDoctype: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"source_doctype\").notNull(),\n    sourceId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"source_id\").notNull(),\n    idempotencyKey: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"idempotency_key\").notNull().unique(),\n    isReversal: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"is_reversal\").default(\"false\").notNull(),\n    reversesJournalId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"reverses_journal_id\"),\n    autoReverseOn: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.timestamp)(\"auto_reverse_on\", {\n        withTimezone: true\n    })\n});\nconst journalLine = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_0__.pgTable)(\"journal_line\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"id\").primaryKey(),\n    journalId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"journal_id\").references(()=>journal.id, {\n        onDelete: \"cascade\"\n    }).notNull(),\n    accountCode: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"account_code\").notNull(),\n    dc: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__.char)(\"dc\", {\n        length: 1\n    }).notNull(),\n    amount: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.numeric)(\"amount\", {\n        precision: 20,\n        scale: 6\n    }).notNull(),\n    currency: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__.char)(\"currency\", {\n        length: 3\n    }).notNull(),\n    partyType: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"party_type\"),\n    partyId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"party_id\")\n});\nconst outbox = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_0__.pgTable)(\"outbox\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"id\").primaryKey(),\n    topic: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"topic\").notNull(),\n    payload: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"payload\").notNull(),\n    createdAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.timestamp)(\"created_at\", {\n        withTimezone: true\n    }).defaultNow().notNull()\n});\nconst item = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_0__.pgTable)(\"item\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"id\").primaryKey(),\n    code: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"code\").notNull().unique(),\n    name: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"name\").notNull(),\n    uom: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"uom\").notNull()\n});\nconst stockLedger = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_0__.pgTable)(\"stock_ledger\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"id\").primaryKey(),\n    companyId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"company_id\").references(()=>company.id).notNull(),\n    itemId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"item_id\").references(()=>item.id).notNull(),\n    moveId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"move_id\").notNull(),\n    kind: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"kind\").notNull(),\n    qty: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.numeric)(\"qty\", {\n        precision: 20,\n        scale: 6\n    }).notNull(),\n    unitCost: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.numeric)(\"unit_cost\", {\n        precision: 20,\n        scale: 6\n    }).notNull(),\n    totalCost: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.numeric)(\"total_cost\", {\n        precision: 20,\n        scale: 6\n    }).notNull(),\n    createdAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.timestamp)(\"created_at\", {\n        withTimezone: true\n    }).defaultNow().notNull()\n});\nconst itemCosts = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_0__.pgTable)(\"item_costs\", {\n    companyId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"company_id\").references(()=>company.id).notNull(),\n    itemId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"item_id\").references(()=>item.id).notNull(),\n    onHandQty: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.numeric)(\"on_hand_qty\", {\n        precision: 20,\n        scale: 6\n    }).notNull(),\n    movingAvgCost: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.numeric)(\"moving_avg_cost\", {\n        precision: 20,\n        scale: 6\n    }).notNull(),\n    totalValue: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.numeric)(\"total_value\", {\n        precision: 20,\n        scale: 6\n    }).notNull(),\n    updatedAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.timestamp)(\"updated_at\", {\n        withTimezone: true\n    }).defaultNow().notNull()\n}, (t)=>({\n        pk: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.primaryKey)({\n            columns: [\n                t.companyId,\n                t.itemId\n            ]\n        })\n    }));\nconst payment = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_0__.pgTable)(\"payment\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"id\").primaryKey(),\n    companyId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"company_id\").references(()=>company.id).notNull(),\n    kind: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"kind\").notNull(),\n    partyType: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"party_type\").notNull(),\n    partyId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"party_id\").notNull(),\n    docDate: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.timestamp)(\"doc_date\", {\n        withTimezone: true\n    }).notNull(),\n    currency: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__.char)(\"currency\", {\n        length: 3\n    }).notNull(),\n    amount: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.numeric)(\"amount\", {\n        precision: 20,\n        scale: 2\n    }).notNull(),\n    journalId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"journal_id\") // populated once posted\n});\nconst paymentAllocation = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_0__.pgTable)(\"payment_allocation\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"id\").primaryKey(),\n    paymentId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"payment_id\").references(()=>payment.id, {\n        onDelete: \"cascade\"\n    }).notNull(),\n    applyDoctype: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"apply_doctype\").notNull(),\n    applyId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"apply_id\").notNull(),\n    amount: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.numeric)(\"amount\", {\n        precision: 20,\n        scale: 2\n    }).notNull()\n});\n// --- Auth & Multi-Company --------------------------------------------------\nconst appUser = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_0__.pgTable)(\"app_user\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"id\").primaryKey(),\n    email: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"email\").notNull().unique(),\n    name: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"name\").notNull(),\n    createdAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.timestamp)(\"created_at\", {\n        withTimezone: true\n    }).defaultNow().notNull()\n});\nconst membership = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_0__.pgTable)(\"membership\", {\n    userId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"user_id\").references(()=>appUser.id).notNull(),\n    companyId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"company_id\").references(()=>company.id).notNull(),\n    role: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"role\").notNull().default(\"admin\") // 'admin' | 'member'\n}, (t)=>({\n        pk: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.primaryKey)({\n            columns: [\n                t.userId,\n                t.companyId\n            ]\n        })\n    }));\nconst apiKey = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_0__.pgTable)(\"api_key\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"id\").primaryKey(),\n    userId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"user_id\").references(()=>appUser.id).notNull(),\n    companyId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"company_id\").references(()=>company.id).notNull(),\n    name: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"name\").notNull(),\n    hash: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"hash\").notNull(),\n    enabled: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.text)(\"enabled\").notNull().default(\"true\"),\n    createdAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.timestamp)(\"created_at\", {\n        withTimezone: true\n    }).defaultNow().notNull()\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vcGFja2FnZXMvYWRhcHRlcnMvZGIvc3JjL3NjaGVtYS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUEyRztBQUdwRyxNQUFNTSxVQUFVTiw0REFBT0EsQ0FBQyxXQUFXO0lBQ3RDTyxJQUFJTix5REFBSUEsQ0FBQyxNQUFNSSxVQUFVO0lBQ3pCRyxNQUFNUCx5REFBSUEsQ0FBQyxRQUFRUSxPQUFPLEdBQUdDLE1BQU07SUFDbkNDLE1BQU1WLHlEQUFJQSxDQUFDLFFBQVFRLE9BQU87SUFDMUJHLFVBQVVWLHlEQUFJQSxDQUFDLFlBQVk7UUFBRVcsUUFBUTtJQUFFLEdBQUdKLE9BQU87QUFDckQsR0FBRztBQUVJLE1BQU1LLFVBQVVkLDREQUFPQSxDQUFDLFdBQVc7SUFDdENPLElBQUlOLHlEQUFJQSxDQUFDLE1BQU1JLFVBQVU7SUFDekJVLFdBQVdkLHlEQUFJQSxDQUFDLGNBQWNlLFVBQVUsQ0FBQyxJQUFNVixRQUFRQyxFQUFFLEVBQUVFLE9BQU87SUFDbEVELE1BQU1QLHlEQUFJQSxDQUFDLFFBQVFRLE9BQU87SUFDMUJFLE1BQU1WLHlEQUFJQSxDQUFDLFFBQVFRLE9BQU87SUFDMUJRLE1BQU1oQix5REFBSUEsQ0FBQyxRQUFRUSxPQUFPO0lBQzFCUyxlQUFlaEIseURBQUlBLENBQUMsa0JBQWtCO1FBQUVXLFFBQVE7SUFBRSxHQUFHSixPQUFPO0lBQzVEVSxZQUFZbEIseURBQUlBLENBQUM7QUFDckIsR0FBRztBQUVJLE1BQU1tQixtQkFBbUJwQiw0REFBT0EsQ0FBQyxxQkFBcUI7SUFDekRPLElBQUlOLHlEQUFJQSxDQUFDLE1BQU1JLFVBQVU7SUFDekJVLFdBQVdkLHlEQUFJQSxDQUFDLGNBQWNlLFVBQVUsQ0FBQyxJQUFNVixRQUFRQyxFQUFFLEVBQUVFLE9BQU87SUFDbEVELE1BQU1QLHlEQUFJQSxDQUFDLFFBQVFRLE9BQU87SUFDMUJZLFdBQVdsQiw4REFBU0EsQ0FBQyxjQUFjO1FBQUVtQixjQUFj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Vix5REFBSUEsQ0FBQyxRQUFRUSxPQUFPO0lBQzFCc0UsTUFBTTlFLHlEQUFJQSxDQUFDLFFBQVFRLE9BQU87SUFDMUJ1RSxTQUFTL0UseURBQUlBLENBQUMsV0FBV1EsT0FBTyxHQUFHeUIsT0FBTyxDQUFDO0lBQzNDZ0IsV0FBVy9DLDhEQUFTQSxDQUFDLGNBQWM7UUFBRW1CLGNBQWM7SUFBSyxHQUFHNkIsVUFBVSxHQUFHMUMsT0FBTztBQUNuRixHQUFHIiwic291cmNlcyI6WyJDOlxcQUktQk9TXFxhaWJvcy1lcnBCT1NcXHBhY2thZ2VzXFxhZGFwdGVyc1xcZGJcXHNyY1xcc2NoZW1hLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHBnVGFibGUsIHRleHQsIGNoYXIsIHRpbWVzdGFtcCwgbnVtZXJpYywgcGdFbnVtLCBwcmltYXJ5S2V5LCBpbnRlZ2VyIH0gZnJvbSBcImRyaXp6bGUtb3JtL3BnLWNvcmVcIjtcclxuaW1wb3J0IHsgcmVsYXRpb25zIH0gZnJvbSBcImRyaXp6bGUtb3JtXCI7XHJcblxyXG5leHBvcnQgY29uc3QgY29tcGFueSA9IHBnVGFibGUoXCJjb21wYW55XCIsIHtcclxuICAgIGlkOiB0ZXh0KFwiaWRcIikucHJpbWFyeUtleSgpLFxyXG4gICAgY29kZTogdGV4dChcImNvZGVcIikubm90TnVsbCgpLnVuaXF1ZSgpLFxyXG4gICAgbmFtZTogdGV4dChcIm5hbWVcIikubm90TnVsbCgpLFxyXG4gICAgY3VycmVuY3k6IGNoYXIoXCJjdXJyZW5jeVwiLCB7IGxlbmd0aDogMyB9KS5ub3ROdWxsKCksXHJcbn0pO1xyXG5cclxuZXhwb3J0IGNvbnN0IGFjY291bnQgPSBwZ1RhYmxlKFwiYWNjb3VudFwiLCB7XHJcbiAgICBpZDogdGV4dChcImlkXCIpLnByaW1hcnlLZXkoKSxcclxuICAgIGNvbXBhbnlJZDogdGV4dChcImNvbXBhbnlfaWRcIikucmVmZXJlbmNlcygoKSA9PiBjb21wYW55LmlkKS5ub3ROdWxsKCksXHJcbiAgICBjb2RlOiB0ZXh0KFwiY29kZVwiKS5ub3ROdWxsKCksXHJcbiAgICBuYW1lOiB0ZXh0KFwibmFtZVwiKS5ub3ROdWxsKCksXHJcbiAgICB0eXBlOiB0ZXh0KFwidHlwZVwiKS5ub3ROdWxsKCksICAgICAgICAgICAgLy8gQXNzZXQvTGlhYmlsaXR5L0VxdWl0eS9JbmNvbWUvRXhwZW5zZVxyXG4gICAgbm9ybWFsQmFsYW5jZTogY2hhcihcIm5vcm1hbF9iYWxhbmNlXCIsIHsgbGVuZ3RoOiAxIH0pLm5vdE51bGwoKSwgLy8gRC9DXHJcbiAgICBwYXJlbnRDb2RlOiB0ZXh0KFwicGFyZW50X2NvZGVcIiksXHJcbn0pO1xyXG5cclxuZXhwb3J0IGNvbnN0IGFjY291bnRpbmdQZXJpb2QgPSBwZ1RhYmxlKFwiYWNjb3VudGluZ19wZXJpb2RcIiwge1xyXG4gICAgaWQ6IHRleHQoXCJpZFwiKS5wcmltYXJ5S2V5KCksXHJcbiAgICBjb21wYW55SWQ6IHRleHQoXCJjb21wYW55X2lkXCIpLnJlZmVyZW5jZXMoKCkgPT4gY29tcGFueS5pZCkubm90TnVsbCgpLFxyXG4gICAgY29kZTogdGV4dChcImNvZGVcIikubm90TnVsbCgpLFxyXG4gICAgc3RhcnREYXRlOiB0aW1lc3RhbXAoXCJzdGFydF9kYXRlXCIsIHsgd2l0aFRpbWV6b25lOiB0cnVlIH0pLm5vdE51bGwoKSxcclxuICAgIGVuZERhdGU6IHRpbWVzdGFtcChcImVuZF9kYXRlXCIsIHsgd2l0aFRpbWV6b25lOiB0cnVlIH0pLm5vdE51bGwoKSxcclxuICAgIHN0YXR1czogdGV4dChcInN0YXR1c1wiKS5ub3ROdWxsKCksXHJcbn0sICh0KSA9PiAoe1xyXG4gICAgdW5pcTogcHJpbWFyeUtleSh7IGNvbHVtbnM6IFt0LmlkXSB9KVxyXG59KSk7XHJcblxyXG5leHBvcnQgY29uc3Qgam91cm5hbCA9IHBnVGFibGUoXCJqb3VybmFsXCIsIHtcclxuICAgIGlkOiB0ZXh0KFwiaWRcIikucHJpbWFyeUtleSgpLFxyXG4gICAgY29tcGFueUlkOiB0ZXh0KFwiY29tcGFueV9pZFwiKS5yZWZlcmVuY2VzKCgpID0+IGNvbXBhbnkuaWQpLm5vdE51bGwoKSxcclxuICAgIHBvc3RpbmdEYXRlOiB0aW1lc3RhbXAoXCJwb3N0aW5nX2RhdGVcIiwgeyB3aXRoVGltZXpvbmU6IHRydWUgfSkubm90TnVsbCgpLFxyXG4gICAgY3VycmVuY3k6IGNoYXIoXCJjdXJyZW5jeVwiLCB7IGxlbmd0aDogMyB9KS5ub3ROdWxsKCksXHJcbiAgICBzb3VyY2VEb2N0eXBlOiB0ZXh0KFwic291cmNlX2RvY3R5cGVcIikubm90TnVsbCgpLFxyXG4gICAgc291cmNlSWQ6IHRleHQoXCJzb3VyY2VfaWRcIikubm90TnVsbCgpLFxyXG4gICAgaWRlbXBvdGVuY3lLZXk6IHRleHQoXCJpZGVtcG90ZW5jeV9rZXlcIikubm90TnVsbCgpLnVuaXF1ZSgpLFxyXG4gICAgaXNSZXZlcnNhbDogdGV4dChcImlzX3JldmVyc2FsXCIpLmRlZmF1bHQoXCJmYWxzZVwiKS5ub3ROdWxsKCksXHJcbiAgICByZXZlcnNlc0pvdXJuYWxJZDogdGV4dChcInJldmVyc2VzX2pvdXJuYWxfaWRcIiksXHJcbiAgICBhdXRvUmV2ZXJzZU9uOiB0aW1lc3RhbXAoXCJhdXRvX3JldmVyc2Vfb25cIiwgeyB3aXRoVGltZXpvbmU6IHRydWUgfSlcclxufSk7XHJcblxyXG5leHBvcnQgY29uc3Qgam91cm5hbExpbmUgPSBwZ1RhYmxlKFwiam91cm5hbF9saW5lXCIsIHtcclxuICAgIGlkOiB0ZXh0KFwiaWRcIikucHJpbWFyeUtleSgpLFxyXG4gICAgam91cm5hbElkOiB0ZXh0KFwiam91cm5hbF9pZFwiKS5yZWZlcmVuY2VzKCgpID0+IGpvdXJuYWwuaWQsIHsgb25EZWxldGU6IFwiY2FzY2FkZVwiIH0pLm5vdE51bGwoKSxcclxuICAgIGFjY291bnRDb2RlOiB0ZXh0KFwiYWNjb3VudF9jb2RlXCIpLm5vdE51bGwoKSxcclxuICAgIGRjOiBjaGFyKFwiZGNcIiwgeyBsZW5ndGg6IDEgfSkubm90TnVsbCgpLFxyXG4gICAgYW1vdW50OiBudW1lcmljKFwiYW1vdW50XCIsIHsgcHJlY2lzaW9uOiAyMCwgc2NhbGU6IDYgfSkubm90TnVsbCgpLFxyXG4gICAgY3VycmVuY3k6IGNoYXIoXCJjdXJyZW5jeVwiLCB7IGxlbmd0aDogMyB9KS5ub3ROdWxsKCksXHJcbiAgICBwYXJ0eVR5cGU6IHRleHQoXCJwYXJ0eV90eXBlXCIpLFxyXG4gICAgcGFydHlJZDogdGV4dChcInBhcnR5X2lkXCIpLFxyXG59KTtcclxuXHJcbmV4cG9ydCBjb25zdCBvdXRib3ggPSBwZ1RhYmxlKFwib3V0Ym94XCIsIHtcclxuICAgIGlkOiB0ZXh0KFwiaWRcIikucHJpbWFyeUtleSgpLFxyXG4gICAgdG9waWM6IHRleHQoXCJ0b3BpY1wiKS5ub3ROdWxsKCksXHJcbiAgICBwYXlsb2FkOiB0ZXh0KFwicGF5bG9hZFwiKS5ub3ROdWxsKCksIC8vIEpTT04gc3RyaW5nXHJcbiAgICBjcmVhdGVkQXQ6IHRpbWVzdGFtcChcImNyZWF0ZWRfYXRcIiwgeyB3aXRoVGltZXpvbmU6IHRydWUgfSkuZGVmYXVsdE5vdygpLm5vdE51bGwoKSxcclxufSk7XHJcblxyXG5leHBvcnQgY29uc3QgaXRlbSA9IHBnVGFibGUoXCJpdGVtXCIsIHtcclxuICAgIGlkOiB0ZXh0KFwiaWRcIikucHJpbWFyeUtleSgpLFxyXG4gICAgY29kZTogdGV4dChcImNvZGVcIikubm90TnVsbCgpLnVuaXF1ZSgpLFxyXG4gICAgbmFtZTogdGV4dChcIm5hbWVcIikubm90TnVsbCgpLFxyXG4gICAgdW9tOiB0ZXh0KFwidW9tXCIpLm5vdE51bGwoKVxyXG59KTtcclxuXHJcbmV4cG9ydCBjb25zdCBzdG9ja0xlZGdlciA9IHBnVGFibGUoXCJzdG9ja19sZWRnZXJcIiwge1xyXG4gICAgaWQ6IHRleHQoXCJpZFwiKS5wcmltYXJ5S2V5KCksXHJcbiAgICBjb21wYW55SWQ6IHRleHQoXCJjb21wYW55X2lkXCIpLnJlZmVyZW5jZXMoKCkgPT4gY29tcGFueS5pZCkubm90TnVsbCgpLFxyXG4gICAgaXRlbUlkOiB0ZXh0KFwiaXRlbV9pZFwiKS5yZWZlcmVuY2VzKCgpID0+IGl0ZW0uaWQpLm5vdE51bGwoKSxcclxuICAgIG1vdmVJZDogdGV4dChcIm1vdmVfaWRcIikubm90TnVsbCgpLCAgICAgLy8gaWRlbXBvdGVuY3kga2V5IGZvciB0aGUgbW92ZVxyXG4gICAga2luZDogdGV4dChcImtpbmRcIikubm90TnVsbCgpLCAgICAgICAgICAvLyAnaW4nIHwgJ291dCdcclxuICAgIHF0eTogbnVtZXJpYyhcInF0eVwiLCB7IHByZWNpc2lvbjogMjAsIHNjYWxlOiA2IH0pLm5vdE51bGwoKSxcclxuICAgIHVuaXRDb3N0OiBudW1lcmljKFwidW5pdF9jb3N0XCIsIHsgcHJlY2lzaW9uOiAyMCwgc2NhbGU6IDYgfSkubm90TnVsbCgpLCAgLy8gTVlSIHBlciB1bml0XHJcbiAgICB0b3RhbENvc3Q6IG51bWVyaWMoXCJ0b3RhbF9jb3N0XCIsIHsgcHJlY2lzaW9uOiAyMCwgc2NhbGU6IDYgfSkubm90TnVsbCgpLFxyXG4gICAgY3JlYXRlZEF0OiB0aW1lc3RhbXAoXCJjcmVhdGVkX2F0XCIsIHsgd2l0aFRpbWV6b25lOiB0cnVlIH0pLmRlZmF1bHROb3coKS5ub3ROdWxsKClcclxufSk7XHJcblxyXG5leHBvcnQgY29uc3QgaXRlbUNvc3RzID0gcGdUYWJsZShcIml0ZW1fY29zdHNcIiwge1xyXG4gICAgY29tcGFueUlkOiB0ZXh0KFwiY29tcGFueV9pZFwiKS5yZWZlcmVuY2VzKCgpID0+IGNvbXBhbnkuaWQpLm5vdE51bGwoKSxcclxuICAgIGl0ZW1JZDogdGV4dChcIml0ZW1faWRcIikucmVmZXJlbmNlcygoKSA9PiBpdGVtLmlkKS5ub3ROdWxsKCksXHJcbiAgICBvbkhhbmRRdHk6IG51bWVyaWMoXCJvbl9oYW5kX3F0eVwiLCB7IHByZWNpc2lvbjogMjAsIHNjYWxlOiA2IH0pLm5vdE51bGwoKSxcclxuICAgIG1vdmluZ0F2Z0Nvc3Q6IG51bWVyaWMoXCJtb3ZpbmdfYXZnX2Nvc3RcIiwgeyBwcmVjaXNpb246IDIwLCBzY2FsZTogNiB9KS5ub3ROdWxsKCksXHJcbiAgICB0b3RhbFZhbHVlOiBudW1lcmljKFwidG90YWxfdmFsdWVcIiwgeyBwcmVjaXNpb246IDIwLCBzY2FsZTogNiB9KS5ub3ROdWxsKCksXHJcbiAgICB1cGRhdGVkQXQ6IHRpbWVzdGFtcChcInVwZGF0ZWRfYXRcIiwgeyB3aXRoVGltZXpvbmU6IHRydWUgfSkuZGVmYXVsdE5vdygpLm5vdE51bGwoKVxyXG59LCB0ID0+ICh7XHJcbiAgICBwazogcHJpbWFyeUtleSh7IGNvbHVtbnM6IFt0LmNvbXBhbnlJZCwgdC5pdGVtSWRdIH0pXHJcbn0pKTtcclxuXHJcbmV4cG9ydCBjb25zdCBwYXltZW50ID0gcGdUYWJsZShcInBheW1lbnRcIiwge1xyXG4gICAgaWQ6IHRleHQoXCJpZFwiKS5wcmltYXJ5S2V5KCksICAgICAgICAgICAgICAgIC8vIHBheW1lbnQgaWQgKGlkZW1wb3RlbmN5KVxyXG4gICAgY29tcGFueUlkOiB0ZXh0KFwiY29tcGFueV9pZFwiKS5yZWZlcmVuY2VzKCgpID0+IGNvbXBhbnkuaWQpLm5vdE51bGwoKSxcclxuICAgIGtpbmQ6IHRleHQoXCJraW5kXCIpLm5vdE51bGwoKSwgICAgICAgICAgICAgICAvLyAnQVInIHwgJ0FQJ1xyXG4gICAgcGFydHlUeXBlOiB0ZXh0KFwicGFydHlfdHlwZVwiKS5ub3ROdWxsKCksICAgIC8vICdDdXN0b21lcicgfCAnU3VwcGxpZXInXHJcbiAgICBwYXJ0eUlkOiB0ZXh0KFwicGFydHlfaWRcIikubm90TnVsbCgpLFxyXG4gICAgZG9jRGF0ZTogdGltZXN0YW1wKFwiZG9jX2RhdGVcIiwgeyB3aXRoVGltZXpvbmU6IHRydWUgfSkubm90TnVsbCgpLFxyXG4gICAgY3VycmVuY3k6IGNoYXIoXCJjdXJyZW5jeVwiLCB7IGxlbmd0aDogMyB9KS5ub3ROdWxsKCksXHJcbiAgICBhbW91bnQ6IG51bWVyaWMoXCJhbW91bnRcIiwgeyBwcmVjaXNpb246IDIwLCBzY2FsZTogMiB9KS5ub3ROdWxsKCksXHJcbiAgICBqb3VybmFsSWQ6IHRleHQoXCJqb3VybmFsX2lkXCIpICAgICAgICAgICAgICAgLy8gcG9wdWxhdGVkIG9uY2UgcG9zdGVkXHJcbn0pO1xyXG5cclxuZXhwb3J0IGNvbnN0IHBheW1lbnRBbGxvY2F0aW9uID0gcGdUYWJsZShcInBheW1lbnRfYWxsb2NhdGlvblwiLCB7XHJcbiAgICBpZDogdGV4dChcImlkXCIpLnByaW1hcnlLZXkoKSxcclxuICAgIHBheW1lbnRJZDogdGV4dChcInBheW1lbnRfaWRcIikucmVmZXJlbmNlcygoKSA9PiBwYXltZW50LmlkLCB7IG9uRGVsZXRlOiBcImNhc2NhZGVcIiB9KS5ub3ROdWxsKCksXHJcbiAgICBhcHBseURvY3R5cGU6IHRleHQoXCJhcHBseV9kb2N0eXBlXCIpLm5vdE51bGwoKSwgLy8gJ1NhbGVzSW52b2ljZScgfCAnUHVyY2hhc2VJbnZvaWNlJ1xyXG4gICAgYXBwbHlJZDogdGV4dChcImFwcGx5X2lkXCIpLm5vdE51bGwoKSxcclxuICAgIGFtb3VudDogbnVtZXJpYyhcImFtb3VudFwiLCB7IHByZWNpc2lvbjogMjAsIHNjYWxlOiAyIH0pLm5vdE51bGwoKVxyXG59KTtcclxuXHJcbi8vIC0tLSBBdXRoICYgTXVsdGktQ29tcGFueSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5leHBvcnQgY29uc3QgYXBwVXNlciA9IHBnVGFibGUoXCJhcHBfdXNlclwiLCB7XHJcbiAgICBpZDogdGV4dChcImlkXCIpLnByaW1hcnlLZXkoKSxcclxuICAgIGVtYWlsOiB0ZXh0KFwiZW1haWxcIikubm90TnVsbCgpLnVuaXF1ZSgpLFxyXG4gICAgbmFtZTogdGV4dChcIm5hbWVcIikubm90TnVsbCgpLFxyXG4gICAgY3JlYXRlZEF0OiB0aW1lc3RhbXAoXCJjcmVhdGVkX2F0XCIsIHsgd2l0aFRpbWV6b25lOiB0cnVlIH0pLmRlZmF1bHROb3coKS5ub3ROdWxsKClcclxufSk7XHJcblxyXG5leHBvcnQgY29uc3QgbWVtYmVyc2hpcCA9IHBnVGFibGUoXCJtZW1iZXJzaGlwXCIsIHtcclxuICAgIHVzZXJJZDogdGV4dChcInVzZXJfaWRcIikucmVmZXJlbmNlcygoKSA9PiBhcHBVc2VyLmlkKS5ub3ROdWxsKCksXHJcbiAgICBjb21wYW55SWQ6IHRleHQoXCJjb21wYW55X2lkXCIpLnJlZmVyZW5jZXMoKCkgPT4gY29tcGFueS5pZCkubm90TnVsbCgpLFxyXG4gICAgcm9sZTogdGV4dChcInJvbGVcIikubm90TnVsbCgpLmRlZmF1bHQoXCJhZG1pblwiKSAvLyAnYWRtaW4nIHwgJ21lbWJlcidcclxufSwgdCA9PiAoe1xyXG4gICAgcGs6IHByaW1hcnlLZXkoeyBjb2x1bW5zOiBbdC51c2VySWQsIHQuY29tcGFueUlkXSB9KVxyXG59KSk7XHJcblxyXG5leHBvcnQgY29uc3QgYXBpS2V5ID0gcGdUYWJsZShcImFwaV9rZXlcIiwge1xyXG4gICAgaWQ6IHRleHQoXCJpZFwiKS5wcmltYXJ5S2V5KCksICAgICAgICAgICAgICAvLyBwdWJsaWMgaWQgKHByZWZpeCAnYWtfLi4uJylcclxuICAgIHVzZXJJZDogdGV4dChcInVzZXJfaWRcIikucmVmZXJlbmNlcygoKSA9PiBhcHBVc2VyLmlkKS5ub3ROdWxsKCksXHJcbiAgICBjb21wYW55SWQ6IHRleHQoXCJjb21wYW55X2lkXCIpLnJlZmVyZW5jZXMoKCkgPT4gY29tcGFueS5pZCkubm90TnVsbCgpLFxyXG4gICAgbmFtZTogdGV4dChcIm5hbWVcIikubm90TnVsbCgpLFxyXG4gICAgaGFzaDogdGV4dChcImhhc2hcIikubm90TnVsbCgpLCAgICAgICAgICAgICAvLyBTSEEyNTYgb2Ygc2VjcmV0XHJcbiAgICBlbmFibGVkOiB0ZXh0KFwiZW5hYmxlZFwiKS5ub3ROdWxsKCkuZGVmYXVsdChcInRydWVcIiksXHJcbiAgICBjcmVhdGVkQXQ6IHRpbWVzdGFtcChcImNyZWF0ZWRfYXRcIiwgeyB3aXRoVGltZXpvbmU6IHRydWUgfSkuZGVmYXVsdE5vdygpLm5vdE51bGwoKVxyXG59KTtcclxuIl0sIm5hbWVzIjpbInBnVGFibGUiLCJ0ZXh0IiwiY2hhciIsInRpbWVzdGFtcCIsIm51bWVyaWMiLCJwcmltYXJ5S2V5IiwiY29tcGFueSIsImlkIiwiY29kZSIsIm5vdE51bGwiLCJ1bmlxdWUiLCJuYW1lIiwiY3VycmVuY3kiLCJsZW5ndGgiLCJhY2NvdW50IiwiY29tcGFueUlkIiwicmVmZXJlbmNlcyIsInR5cGUiLCJub3JtYWxCYWxhbmNlIiwicGFyZW50Q29kZSIsImFjY291bnRpbmdQZXJpb2QiLCJzdGFydERhdGUiLCJ3aXRoVGltZXpvbmUiLCJlbmREYXRlIiwic3RhdHVzIiwidCIsInVuaXEiLCJjb2x1bW5zIiwiam91cm5hbCIsInBvc3RpbmdEYXRlIiwic291cmNlRG9jdHlwZSIsInNvdXJjZUlkIiwiaWRlbXBvdGVuY3lLZXkiLCJpc1JldmVyc2FsIiwiZGVmYXVsdCIsInJldmVyc2VzSm91cm5hbElkIiwiYXV0b1JldmVyc2VPbiIsImpvdXJuYWxMaW5lIiwiam91cm5hbElkIiwib25EZWxldGUiLCJhY2NvdW50Q29kZSIsImRjIiwiYW1vdW50IiwicHJlY2lzaW9uIiwic2NhbGUiLCJwYXJ0eVR5cGUiLCJwYXJ0eUlkIiwib3V0Ym94IiwidG9waWMiLCJwYXlsb2FkIiwiY3JlYXRlZEF0IiwiZGVmYXVsdE5vdyIsIml0ZW0iLCJ1b20iLCJzdG9ja0xlZGdlciIsIml0ZW1JZCIsIm1vdmVJZCIsImtpbmQiLCJxdHkiLCJ1bml0Q29zdCIsInRvdGFsQ29zdCIsIml0ZW1Db3N0cyIsIm9uSGFuZFF0eSIsIm1vdmluZ0F2Z0Nvc3QiLCJ0b3RhbFZhbHVlIiwidXBkYXRlZEF0IiwicGsiLCJwYXltZW50IiwiZG9jRGF0ZSIsInBheW1lbnRBbGxvY2F0aW9uIiwicGF5bWVudElkIiwiYXBwbHlEb2N0eXBlIiwiYXBwbHlJZCIsImFwcFVzZXIiLCJlbWFpbCIsIm1lbWJlcnNoaXAiLCJ1c2VySWQiLCJyb2xlIiwiYXBpS2V5IiwiaGFzaCIsImVuYWJsZWQiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/../../packages/adapters/db/src/schema.ts\n");

/***/ }),

/***/ "(rsc)/../../packages/contracts/http/sales/sales-invoice.schema.ts":
/*!*******************************************************************!*\
  !*** ../../packages/contracts/http/sales/sales-invoice.schema.ts ***!
  \*******************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SalesInvoice: () => (/* binding */ SalesInvoice),\n/* harmony export */   SalesInvoiceLine: () => (/* binding */ SalesInvoiceLine)\n/* harmony export */ });\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/.pnpm/zod@3.25.76/node_modules/zod/v3/types.js\");\n/* harmony import */ var _shared_primitives__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../shared/primitives */ \"(rsc)/../../packages/contracts/http/shared/primitives.ts\");\n\n\nconst SalesInvoiceLine = zod__WEBPACK_IMPORTED_MODULE_1__.object({\n    description: zod__WEBPACK_IMPORTED_MODULE_1__.string().min(1),\n    qty: zod__WEBPACK_IMPORTED_MODULE_1__.number().positive(),\n    unit_price: _shared_primitives__WEBPACK_IMPORTED_MODULE_0__.Money,\n    tax_code: zod__WEBPACK_IMPORTED_MODULE_1__.string().optional()\n});\nconst SalesInvoice = zod__WEBPACK_IMPORTED_MODULE_1__.object({\n    id: zod__WEBPACK_IMPORTED_MODULE_1__.string(),\n    company_id: zod__WEBPACK_IMPORTED_MODULE_1__.string(),\n    customer_id: zod__WEBPACK_IMPORTED_MODULE_1__.string(),\n    doc_date: _shared_primitives__WEBPACK_IMPORTED_MODULE_0__.ISODate,\n    currency: _shared_primitives__WEBPACK_IMPORTED_MODULE_0__.Currency,\n    lines: zod__WEBPACK_IMPORTED_MODULE_1__.array(SalesInvoiceLine).min(1),\n    totals: zod__WEBPACK_IMPORTED_MODULE_1__.object({\n        total: _shared_primitives__WEBPACK_IMPORTED_MODULE_0__.Money,\n        tax_total: _shared_primitives__WEBPACK_IMPORTED_MODULE_0__.Money,\n        grand_total: _shared_primitives__WEBPACK_IMPORTED_MODULE_0__.Money\n    })\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vcGFja2FnZXMvY29udHJhY3RzL2h0dHAvc2FsZXMvc2FsZXMtaW52b2ljZS5zY2hlbWEudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUF3QjtBQUN3QztBQUV6RCxNQUFNSSxtQkFBbUJKLHVDQUFRLENBQUM7SUFDdkNNLGFBQWFOLHVDQUFRLEdBQUdRLEdBQUcsQ0FBQztJQUM1QkMsS0FBS1QsdUNBQVEsR0FBR1csUUFBUTtJQUN4QkMsWUFBWVQscURBQUtBO0lBQ2pCVSxVQUFVYix1Q0FBUSxHQUFHYyxRQUFRO0FBQy9CLEdBQUc7QUFFSSxNQUFNQyxlQUFlZix1Q0FBUSxDQUFDO0lBQ25DZ0IsSUFBSWhCLHVDQUFRO0lBQ1ppQixZQUFZakIsdUNBQVE7SUFDcEJrQixhQUFhbEIsdUNBQVE7SUFDckJtQixVQUFVbEIsdURBQU9BO0lBQ2pCbUIsVUFBVWxCLHdEQUFRQTtJQUNsQm1CLE9BQU9yQixzQ0FBTyxDQUFDSSxrQkFBa0JJLEdBQUcsQ0FBQztJQUNyQ2UsUUFBUXZCLHVDQUFRLENBQUM7UUFDZndCLE9BQU9yQixxREFBS0E7UUFDWnNCLFdBQVd0QixxREFBS0E7UUFDaEJ1QixhQUFhdkIscURBQUtBO0lBQ3BCO0FBQ0YsR0FBRyIsInNvdXJjZXMiOlsiQzpcXEFJLUJPU1xcYWlib3MtZXJwQk9TXFxwYWNrYWdlc1xcY29udHJhY3RzXFxodHRwXFxzYWxlc1xcc2FsZXMtaW52b2ljZS5zY2hlbWEudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgeiB9IGZyb20gXCJ6b2RcIjtcclxuaW1wb3J0IHsgSVNPRGF0ZSwgQ3VycmVuY3ksIE1vbmV5IH0gZnJvbSBcIi4uL3NoYXJlZC9wcmltaXRpdmVzXCI7XHJcblxyXG5leHBvcnQgY29uc3QgU2FsZXNJbnZvaWNlTGluZSA9IHoub2JqZWN0KHtcclxuICBkZXNjcmlwdGlvbjogei5zdHJpbmcoKS5taW4oMSksXHJcbiAgcXR5OiB6Lm51bWJlcigpLnBvc2l0aXZlKCksXHJcbiAgdW5pdF9wcmljZTogTW9uZXksXHJcbiAgdGF4X2NvZGU6IHouc3RyaW5nKCkub3B0aW9uYWwoKVxyXG59KTtcclxuXHJcbmV4cG9ydCBjb25zdCBTYWxlc0ludm9pY2UgPSB6Lm9iamVjdCh7XHJcbiAgaWQ6IHouc3RyaW5nKCksICAgICAgICAgICAgLy8gVUxJRCBwcmVmZXJyZWQ7IGtlZXAgc3RyaW5nIGZvciBNVlBcclxuICBjb21wYW55X2lkOiB6LnN0cmluZygpLFxyXG4gIGN1c3RvbWVyX2lkOiB6LnN0cmluZygpLFxyXG4gIGRvY19kYXRlOiBJU09EYXRlLFxyXG4gIGN1cnJlbmN5OiBDdXJyZW5jeSxcclxuICBsaW5lczogei5hcnJheShTYWxlc0ludm9pY2VMaW5lKS5taW4oMSksXHJcbiAgdG90YWxzOiB6Lm9iamVjdCh7XHJcbiAgICB0b3RhbDogTW9uZXksXHJcbiAgICB0YXhfdG90YWw6IE1vbmV5LFxyXG4gICAgZ3JhbmRfdG90YWw6IE1vbmV5XHJcbiAgfSlcclxufSk7XHJcbmV4cG9ydCB0eXBlIFNhbGVzSW52b2ljZSA9IHouaW5mZXI8dHlwZW9mIFNhbGVzSW52b2ljZT47XHJcbiJdLCJuYW1lcyI6WyJ6IiwiSVNPRGF0ZSIsIkN1cnJlbmN5IiwiTW9uZXkiLCJTYWxlc0ludm9pY2VMaW5lIiwib2JqZWN0IiwiZGVzY3JpcHRpb24iLCJzdHJpbmciLCJtaW4iLCJxdHkiLCJudW1iZXIiLCJwb3NpdGl2ZSIsInVuaXRfcHJpY2UiLCJ0YXhfY29kZSIsIm9wdGlvbmFsIiwiU2FsZXNJbnZvaWNlIiwiaWQiLCJjb21wYW55X2lkIiwiY3VzdG9tZXJfaWQiLCJkb2NfZGF0ZSIsImN1cnJlbmN5IiwibGluZXMiLCJhcnJheSIsInRvdGFscyIsInRvdGFsIiwidGF4X3RvdGFsIiwiZ3JhbmRfdG90YWwiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/../../packages/contracts/http/sales/sales-invoice.schema.ts\n");

/***/ }),

/***/ "(rsc)/../../packages/contracts/http/shared/primitives.ts":
/*!**********************************************************!*\
  !*** ../../packages/contracts/http/shared/primitives.ts ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Currency: () => (/* binding */ Currency),\n/* harmony export */   Decimal: () => (/* binding */ Decimal),\n/* harmony export */   ISODate: () => (/* binding */ ISODate),\n/* harmony export */   Money: () => (/* binding */ Money),\n/* harmony export */   ULID: () => (/* binding */ ULID)\n/* harmony export */ });\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! zod */ \"(rsc)/../../node_modules/.pnpm/zod@3.25.76/node_modules/zod/v3/types.js\");\n\nconst ULID = zod__WEBPACK_IMPORTED_MODULE_0__.string().regex(/^[0-9A-HJKMNP-TV-Z]{26}$/, \"ULID\");\nconst ISODate = zod__WEBPACK_IMPORTED_MODULE_0__.string().datetime({\n    offset: true\n});\nconst Currency = zod__WEBPACK_IMPORTED_MODULE_0__.string().length(3).transform((s)=>s.toUpperCase());\nconst Decimal = zod__WEBPACK_IMPORTED_MODULE_0__.string().regex(/^-?\\d+(\\.\\d+)?$/);\nconst Money = zod__WEBPACK_IMPORTED_MODULE_0__.object({\n    amount: Decimal,\n    currency: Currency\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vcGFja2FnZXMvY29udHJhY3RzL2h0dHAvc2hhcmVkL3ByaW1pdGl2ZXMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQXdCO0FBQ2pCLE1BQU1DLE9BQU9ELHVDQUFRLEdBQUdHLEtBQUssQ0FBQyw0QkFBMkIsUUFBUTtBQUNqRSxNQUFNQyxVQUFVSix1Q0FBUSxHQUFHSyxRQUFRLENBQUM7SUFBRUMsUUFBUTtBQUFLLEdBQUc7QUFDdEQsTUFBTUMsV0FBV1AsdUNBQVEsR0FBR1EsTUFBTSxDQUFDLEdBQUdDLFNBQVMsQ0FBQ0MsQ0FBQUEsSUFBS0EsRUFBRUMsV0FBVyxJQUFJO0FBQ3RFLE1BQU1DLFVBQVVaLHVDQUFRLEdBQUdHLEtBQUssQ0FBQyxtQkFBbUI7QUFDcEQsTUFBTVUsUUFBUWIsdUNBQVEsQ0FBQztJQUFFZSxRQUFRSDtJQUFTSSxVQUFVVDtBQUFTLEdBQUciLCJzb3VyY2VzIjpbIkM6XFxBSS1CT1NcXGFpYm9zLWVycEJPU1xccGFja2FnZXNcXGNvbnRyYWN0c1xcaHR0cFxcc2hhcmVkXFxwcmltaXRpdmVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHogfSBmcm9tIFwiem9kXCI7XHJcbmV4cG9ydCBjb25zdCBVTElEID0gei5zdHJpbmcoKS5yZWdleCgvXlswLTlBLUhKS01OUC1UVi1aXXsyNn0kLyxcIlVMSURcIik7XHJcbmV4cG9ydCBjb25zdCBJU09EYXRlID0gei5zdHJpbmcoKS5kYXRldGltZSh7IG9mZnNldDogdHJ1ZSB9KTtcclxuZXhwb3J0IGNvbnN0IEN1cnJlbmN5ID0gei5zdHJpbmcoKS5sZW5ndGgoMykudHJhbnNmb3JtKHMgPT4gcy50b1VwcGVyQ2FzZSgpKTtcclxuZXhwb3J0IGNvbnN0IERlY2ltYWwgPSB6LnN0cmluZygpLnJlZ2V4KC9eLT9cXGQrKFxcLlxcZCspPyQvKTtcclxuZXhwb3J0IGNvbnN0IE1vbmV5ID0gei5vYmplY3QoeyBhbW91bnQ6IERlY2ltYWwsIGN1cnJlbmN5OiBDdXJyZW5jeSB9KTtcclxuIl0sIm5hbWVzIjpbInoiLCJVTElEIiwic3RyaW5nIiwicmVnZXgiLCJJU09EYXRlIiwiZGF0ZXRpbWUiLCJvZmZzZXQiLCJDdXJyZW5jeSIsImxlbmd0aCIsInRyYW5zZm9ybSIsInMiLCJ0b1VwcGVyQ2FzZSIsIkRlY2ltYWwiLCJNb25leSIsIm9iamVjdCIsImFtb3VudCIsImN1cnJlbmN5Il0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/../../packages/contracts/http/shared/primitives.ts\n");

/***/ }),

/***/ "(rsc)/../../packages/posting-rules/src/index.ts":
/*!*************************************************!*\
  !*** ../../packages/posting-rules/src/index.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   get: () => (/* binding */ get),\n/* harmony export */   loadRule: () => (/* binding */ loadRule)\n/* harmony export */ });\n/* harmony import */ var node_fs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! node:fs */ \"node:fs\");\n/* harmony import */ var node_fs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(node_fs__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var node_path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! node:path */ \"node:path\");\n/* harmony import */ var node_path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(node_path__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var node_url__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! node:url */ \"node:url\");\n/* harmony import */ var node_url__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(node_url__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var json5__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! json5 */ \"(rsc)/../../node_modules/.pnpm/json5@2.2.3/node_modules/json5/dist/index.mjs\");\n\n\n\n\nconst cache = new Map();\nconst __dirname = node_path__WEBPACK_IMPORTED_MODULE_1___default().dirname((0,node_url__WEBPACK_IMPORTED_MODULE_2__.fileURLToPath)(\"file:///C:/AI-BOS/aibos-erpBOS/packages/posting-rules/src/index.ts\"));\nfunction loadRule(name) {\n    if (cache.has(name)) return cache.get(name);\n    const file = node_path__WEBPACK_IMPORTED_MODULE_1___default().join(__dirname, `${name}.json5`);\n    const raw = node_fs__WEBPACK_IMPORTED_MODULE_0___default().readFileSync(file, \"utf8\");\n    const parsed = json5__WEBPACK_IMPORTED_MODULE_3__[\"default\"].parse(raw);\n    cache.set(name, parsed);\n    return parsed;\n}\nfunction get(obj, dot) {\n    return dot.split(\".\").reduce((a, k)=>a == null ? undefined : a[k], obj);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vcGFja2FnZXMvcG9zdGluZy1ydWxlcy9zcmMvaW5kZXgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQXlCO0FBQ0k7QUFDWTtBQUNmO0FBYzFCLE1BQU1JLFFBQVEsSUFBSUM7QUFDbEIsTUFBTUMsWUFBWUwsd0RBQVksQ0FBQ0MsdURBQWFBLENBQUMsb0VBQWU7QUFFckQsU0FBU08sU0FBU0MsSUFBWTtJQUNuQyxJQUFJTixNQUFNTyxHQUFHLENBQUNELE9BQU8sT0FBT04sTUFBTVEsR0FBRyxDQUFDRjtJQUN0QyxNQUFNRyxPQUFPWixxREFBUyxDQUFDSyxXQUFXLEdBQUdJLEtBQUssTUFBTSxDQUFDO0lBQ2pELE1BQU1LLE1BQU1mLDJEQUFlLENBQUNhLE1BQU07SUFDbEMsTUFBTUksU0FBU2QsNkNBQUtBLENBQUNlLEtBQUssQ0FBQ0g7SUFDM0JYLE1BQU1lLEdBQUcsQ0FBQ1QsTUFBTU87SUFDaEIsT0FBT0E7QUFDVDtBQUVPLFNBQVNMLElBQUlRLEdBQVEsRUFBRUMsR0FBVztJQUN2QyxPQUFPQSxJQUFJQyxLQUFLLENBQUMsS0FBS0MsTUFBTSxDQUFDLENBQUNDLEdBQUdDLElBQU9ELEtBQUssT0FBT0UsWUFBWUYsQ0FBQyxDQUFDQyxFQUFFLEVBQUdMO0FBQ3pFIiwic291cmNlcyI6WyJDOlxcQUktQk9TXFxhaWJvcy1lcnBCT1NcXHBhY2thZ2VzXFxwb3N0aW5nLXJ1bGVzXFxzcmNcXGluZGV4LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBmcyBmcm9tIFwibm9kZTpmc1wiO1xyXG5pbXBvcnQgcGF0aCBmcm9tIFwibm9kZTpwYXRoXCI7XHJcbmltcG9ydCB7IGZpbGVVUkxUb1BhdGggfSBmcm9tIFwibm9kZTp1cmxcIjtcclxuaW1wb3J0IEpTT041IGZyb20gXCJqc29uNVwiO1xyXG5cclxuZXhwb3J0IHR5cGUgUnVsZUxpbmUgPSB7XHJcbiAgYWNjb3VudDogc3RyaW5nO1xyXG4gIGFtb3VudEZpZWxkOiBzdHJpbmc7XHJcbiAgcGFydHk/OiB7IHR5cGU6IFwiQ3VzdG9tZXJcIiB8IFwiU3VwcGxpZXJcIjsgZmllbGQ6IHN0cmluZyB9O1xyXG59O1xyXG5leHBvcnQgdHlwZSBQb3N0aW5nUnVsZSA9IHtcclxuICBkb2N0eXBlOiBzdHJpbmc7XHJcbiAgaWRlbXBvdGVuY3lLZXk6IHN0cmluZ1tdO1xyXG4gIGRlYml0czogUnVsZUxpbmVbXTtcclxuICBjcmVkaXRzOiBSdWxlTGluZVtdO1xyXG59O1xyXG5cclxuY29uc3QgY2FjaGUgPSBuZXcgTWFwPHN0cmluZywgUG9zdGluZ1J1bGU+KCk7XHJcbmNvbnN0IF9fZGlybmFtZSA9IHBhdGguZGlybmFtZShmaWxlVVJMVG9QYXRoKGltcG9ydC5tZXRhLnVybCkpO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGxvYWRSdWxlKG5hbWU6IHN0cmluZyk6IFBvc3RpbmdSdWxlIHtcclxuICBpZiAoY2FjaGUuaGFzKG5hbWUpKSByZXR1cm4gY2FjaGUuZ2V0KG5hbWUpITtcclxuICBjb25zdCBmaWxlID0gcGF0aC5qb2luKF9fZGlybmFtZSwgYCR7bmFtZX0uanNvbjVgKTtcclxuICBjb25zdCByYXcgPSBmcy5yZWFkRmlsZVN5bmMoZmlsZSwgXCJ1dGY4XCIpO1xyXG4gIGNvbnN0IHBhcnNlZCA9IEpTT041LnBhcnNlKHJhdykgYXMgUG9zdGluZ1J1bGU7XHJcbiAgY2FjaGUuc2V0KG5hbWUsIHBhcnNlZCk7XHJcbiAgcmV0dXJuIHBhcnNlZDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldChvYmo6IGFueSwgZG90OiBzdHJpbmcpOiBhbnkge1xyXG4gIHJldHVybiBkb3Quc3BsaXQoXCIuXCIpLnJlZHVjZSgoYSwgaykgPT4gKGEgPT0gbnVsbCA/IHVuZGVmaW5lZCA6IGFba10pLCBvYmopO1xyXG59XHJcbiJdLCJuYW1lcyI6WyJmcyIsInBhdGgiLCJmaWxlVVJMVG9QYXRoIiwiSlNPTjUiLCJjYWNoZSIsIk1hcCIsIl9fZGlybmFtZSIsImRpcm5hbWUiLCJ1cmwiLCJsb2FkUnVsZSIsIm5hbWUiLCJoYXMiLCJnZXQiLCJmaWxlIiwiam9pbiIsInJhdyIsInJlYWRGaWxlU3luYyIsInBhcnNlZCIsInBhcnNlIiwic2V0Iiwib2JqIiwiZG90Iiwic3BsaXQiLCJyZWR1Y2UiLCJhIiwiayIsInVuZGVmaW5lZCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/../../packages/posting-rules/src/index.ts\n");

/***/ }),

/***/ "(rsc)/../../packages/services/src/ledger.ts":
/*!*********************************************!*\
  !*** ../../packages/services/src/ledger.ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   LedgerService: () => (/* binding */ LedgerService),\n/* harmony export */   genId: () => (/* binding */ genId),\n/* harmony export */   getJournal: () => (/* binding */ getJournal),\n/* harmony export */   insertJournal: () => (/* binding */ insertJournal),\n/* harmony export */   trialBalance: () => (/* binding */ trialBalance)\n/* harmony export */ });\nconst journals = new Map(); // key = idempotency key OR journal_id\nconst byId = new Map(); // quick lookup by journal_id\nfunction genId(prefix = \"JRN\") {\n    return `${prefix}-${Math.random().toString(36).slice(2, 10)}`;\n}\nasync function insertJournal(j, idempotencyKey) {\n    const existing = journals.get(idempotencyKey);\n    if (existing) return existing;\n    const id = j.id ?? genId();\n    const journal = {\n        id,\n        ...j\n    };\n    journals.set(idempotencyKey, journal);\n    byId.set(id, journal);\n    return journal;\n}\nasync function getJournal(journalId) {\n    return byId.get(journalId) ?? null;\n}\nasync function trialBalance(company_id, currency) {\n    // Aggregate all lines for the company/currency\n    const acc = new Map();\n    for (const j of byId.values()){\n        if (j.company_id !== company_id || j.currency !== currency) continue;\n        for (const l of j.lines){\n            const key = `${l.account_code}:${l.currency}`;\n            const slot = acc.get(key) ?? {\n                d: 0,\n                c: 0\n            };\n            const amt = Number(l.amount.amount); // demo only; real impl should use decimal lib\n            if (l.dc === \"D\") slot.d += amt;\n            else slot.c += amt;\n            acc.set(key, slot);\n        }\n    }\n    const rows = [];\n    for (const [key, v] of acc.entries()){\n        const [account_code, curr] = key.split(\":\");\n        rows.push({\n            account_code: account_code || \"\",\n            debit: v.d.toFixed(2),\n            credit: v.c.toFixed(2),\n            currency: curr || \"\"\n        });\n    }\n    // sort for stable UI\n    rows.sort((a, b)=>a.account_code.localeCompare(b.account_code));\n    return rows;\n}\n// Service class that can use either database or in-memory implementation\nclass LedgerService {\n    constructor(ledgerRepo, txManager){\n        this.ledgerRepo = ledgerRepo;\n        this.txManager = txManager;\n    }\n    async insertJournal(journal) {\n        if (this.ledgerRepo && this.txManager) {\n            // Use database implementation\n            return await this.txManager.run(async (tx)=>{\n                // Check for existing journal by idempotency key\n                const exists = await this.ledgerRepo.existsByKey(journal.idempotency_key, tx);\n                if (exists) {\n                    throw new Error(`Journal with idempotency key ${journal.idempotency_key} already exists`);\n                }\n                // Insert journal and lines\n                const result = await this.ledgerRepo.insertJournal(journal, tx);\n                // Enqueue outbox event\n                await this.ledgerRepo.enqueueOutbox({\n                    type: \"JournalCreated\",\n                    payload: {\n                        journalId: result.id,\n                        companyId: journal.company_id\n                    },\n                    timestamp: new Date(),\n                    aggregateId: journal.company_id\n                }, tx);\n                return result;\n            });\n        } else {\n            // Fallback to in-memory implementation\n            const idempotencyKey = journal.idempotency_key;\n            const existing = journals.get(idempotencyKey);\n            if (existing) {\n                return {\n                    id: existing.id,\n                    lines: existing.lines.map((l)=>({\n                            id: l.id,\n                            account_code: l.account_code,\n                            dc: l.dc,\n                            amount: l.amount,\n                            currency: l.currency,\n                            ...l.party_type && {\n                                party_type: l.party_type\n                            },\n                            ...l.party_id && {\n                                party_id: l.party_id\n                            }\n                        }))\n                };\n            }\n            const id = genId();\n            const journalWithId = {\n                id,\n                company_id: journal.company_id,\n                posting_date: journal.posting_date,\n                currency: journal.currency,\n                source: {\n                    doctype: journal.source_doctype,\n                    id: journal.source_id\n                },\n                lines: journal.lines.map((l)=>({\n                        id: genId(\"JRL\"),\n                        account_code: l.account_code,\n                        dc: l.dc,\n                        amount: l.amount,\n                        currency: l.currency,\n                        ...l.party_type && {\n                            party_type: l.party_type\n                        },\n                        ...l.party_id && {\n                            party_id: l.party_id\n                        }\n                    }))\n            };\n            journals.set(idempotencyKey, journalWithId);\n            byId.set(id, journalWithId);\n            return {\n                id,\n                lines: journalWithId.lines.map((l)=>({\n                        id: l.id,\n                        account_code: l.account_code,\n                        dc: l.dc,\n                        amount: l.amount,\n                        currency: l.currency,\n                        ...l.party_type && {\n                            party_type: l.party_type\n                        },\n                        ...l.party_id && {\n                            party_id: l.party_id\n                        }\n                    }))\n            };\n        }\n    }\n    async getJournal(journalId) {\n        if (this.ledgerRepo) {\n        // Database implementation would go here\n        // For now, fallback to in-memory\n        }\n        return byId.get(journalId) ?? null;\n    }\n    async trialBalance(companyId, currency) {\n        if (this.ledgerRepo && this.txManager) {\n            // Database implementation\n            return await this.txManager.run(async (tx)=>{\n                if (!this.ledgerRepo?.trialBalance) {\n                    throw new Error(\"Trial balance not supported by this repository\");\n                }\n                const rows = await this.ledgerRepo.trialBalance(companyId, currency, tx);\n                return rows.map((r)=>({\n                        account_code: r.account_code,\n                        debit: r.debit,\n                        credit: r.credit,\n                        currency: r.currency\n                    }));\n            });\n        } else {\n            // Fallback to in-memory implementation\n            return trialBalance(companyId, currency);\n        }\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vcGFja2FnZXMvc2VydmljZXMvc3JjL2xlZGdlci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQXdCQSxNQUFNQSxXQUFXLElBQUlDLE9BQWlDLHNDQUFzQztBQUM1RixNQUFNQyxPQUFPLElBQUlELE9BQXFDLDZCQUE2QjtBQUU1RSxTQUFTRSxNQUFNQyxTQUFTLEtBQUs7SUFDbEMsT0FBTyxHQUFHQSxPQUFPLENBQUMsRUFBRUMsS0FBS0MsTUFBTSxHQUFHQyxRQUFRLENBQUMsSUFBSUMsS0FBSyxDQUFDLEdBQUcsS0FBSztBQUMvRDtBQUVPLGVBQWVDLGNBQWNDLENBQXdDLEVBQUVDLGNBQXNCO0lBQ2xHLE1BQU1DLFdBQVdaLFNBQVNhLEdBQUcsQ0FBQ0Y7SUFDOUIsSUFBSUMsVUFBVSxPQUFPQTtJQUNyQixNQUFNRSxLQUFLSixFQUFFSSxFQUFFLElBQUlYO0lBQ25CLE1BQU1ZLFVBQW1CO1FBQUVEO1FBQUksR0FBR0osQ0FBQztJQUFDO0lBQ3BDVixTQUFTZ0IsR0FBRyxDQUFDTCxnQkFBZ0JJO0lBQzdCYixLQUFLYyxHQUFHLENBQUNGLElBQUlDO0lBQ2IsT0FBT0E7QUFDVDtBQUVPLGVBQWVFLFdBQVdDLFNBQWlCO0lBQ2hELE9BQU9oQixLQUFLVyxHQUFHLENBQUNLLGNBQWM7QUFDaEM7QUFTTyxlQUFlQyxhQUFhQyxVQUFrQixFQUFFQyxRQUFnQjtJQUNyRSwrQ0FBK0M7SUFDL0MsTUFBTUMsTUFBTSxJQUFJckI7SUFDaEIsS0FBSyxNQUFNUyxLQUFLUixLQUFLcUIsTUFBTSxHQUFJO1FBQzdCLElBQUliLEVBQUVVLFVBQVUsS0FBS0EsY0FBY1YsRUFBRVcsUUFBUSxLQUFLQSxVQUFVO1FBQzVELEtBQUssTUFBTUcsS0FBS2QsRUFBRWUsS0FBSyxDQUFFO1lBQ3ZCLE1BQU1DLE1BQU0sR0FBR0YsRUFBRUcsWUFBWSxDQUFDLENBQUMsRUFBRUgsRUFBRUgsUUFBUSxFQUFFO1lBQzdDLE1BQU1PLE9BQU9OLElBQUlULEdBQUcsQ0FB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Q0FBQztvQkFDNUM7WUFDRjtRQUNGO0lBQ0Y7SUFFQSxNQUFNbEQsV0FBV0MsU0FBaUIsRUFBMkI7UUFDM0QsSUFBSSxJQUFJLENBQUMrQixVQUFVLEVBQUU7UUFDbkIsd0NBQXdDO1FBQ3hDLGlDQUFpQztRQUNuQztRQUNBLE9BQU8vQyxLQUFLVyxHQUFHLENBQUNLLGNBQWM7SUFDaEM7SUFFQSxNQUFNQyxhQUFhMEMsU0FBaUIsRUFBRXhDLFFBQWdCLEVBQThCO1FBQ2xGLElBQUksSUFBSSxDQUFDNEIsVUFBVSxJQUFJLElBQUksQ0FBQ0MsU0FBUyxFQUFFO1lBQ3JDLDBCQUEwQjtZQUMxQixPQUFPLE1BQU0sSUFBSSxDQUFDQSxTQUFTLENBQUNDLEdBQUcsQ0FBQyxPQUFPQztnQkFDckMsSUFBSSxDQUFDLElBQUksQ0FBQ0gsVUFBVSxFQUFFOUIsY0FBYztvQkFDbEMsTUFBTSxJQUFJcUMsTUFBTTtnQkFDbEI7Z0JBQ0EsTUFBTXJCLE9BQU8sTUFBTSxJQUFJLENBQUNjLFVBQVUsQ0FBQzlCLFlBQVksQ0FBQzBDLFdBQVd4QyxVQUFVK0I7Z0JBQ3JFLE9BQU9qQixLQUFLOEIsR0FBRyxDQUFDLENBQUNTLElBQVk7d0JBQzNCL0MsY0FBYytDLEVBQUUvQyxZQUFZO3dCQUM1QmMsT0FBT2lDLEVBQUVqQyxLQUFLO3dCQUNkRSxRQUFRK0IsRUFBRS9CLE1BQU07d0JBQ2hCdEIsVUFBVXFELEVBQUVyRCxRQUFRO29CQUN0QjtZQUNGO1FBQ0YsT0FBTztZQUNMLHVDQUF1QztZQUN2QyxPQUFPRixhQUFhMEMsV0FBV3hDO1FBQ2pDO0lBQ0Y7QUFDRiIsInNvdXJjZXMiOlsiQzpcXEFJLUJPU1xcYWlib3MtZXJwQk9TXFxwYWNrYWdlc1xcc2VydmljZXNcXHNyY1xcbGVkZ2VyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgTGVkZ2VyUmVwbywgUmVwb0pvdXJuYWwsIFJlcG9Kb3VybmFsTGluZSwgVHgsIFR4TWFuYWdlciB9IGZyb20gXCJAYWlib3MvcG9ydHNcIjtcclxuXHJcbi8vIE1pbmltYWwgaW4tbWVtb3J5IGxlZGdlciArIHRyaWFsIGJhbGFuY2UgZm9yIGRlbW8gKGZhbGxiYWNrIGltcGxlbWVudGF0aW9uKVxyXG50eXBlIE1vbmV5ID0geyBhbW91bnQ6IHN0cmluZzsgY3VycmVuY3k6IHN0cmluZyB9O1xyXG5cclxuZXhwb3J0IHR5cGUgSm91cm5hbExpbmUgPSB7XHJcbiAgaWQ6IHN0cmluZztcclxuICBhY2NvdW50X2NvZGU6IHN0cmluZztcclxuICBkYzogXCJEXCIgfCBcIkNcIjtcclxuICBhbW91bnQ6IE1vbmV5OyAvLyBzdHJpbmcgZGVjaW1hbFxyXG4gIGN1cnJlbmN5OiBzdHJpbmc7XHJcbiAgcGFydHlfdHlwZT86IFwiQ3VzdG9tZXJcIiB8IFwiU3VwcGxpZXJcIjtcclxuICBwYXJ0eV9pZD86IHN0cmluZztcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIEpvdXJuYWwgPSB7XHJcbiAgaWQ6IHN0cmluZztcclxuICBjb21wYW55X2lkOiBzdHJpbmc7XHJcbiAgcG9zdGluZ19kYXRlOiBzdHJpbmc7IC8vIElTT1xyXG4gIGN1cnJlbmN5OiBzdHJpbmc7XHJcbiAgc291cmNlOiB7IGRvY3R5cGU6IHN0cmluZzsgaWQ6IHN0cmluZyB9O1xyXG4gIGxpbmVzOiBKb3VybmFsTGluZVtdO1xyXG59O1xyXG5cclxuY29uc3Qgam91cm5hbHMgPSBuZXcgTWFwPHN0cmluZywgSm91cm5hbD4oKTsgICAgICAgICAgLy8ga2V5ID0gaWRlbXBvdGVuY3kga2V5IE9SIGpvdXJuYWxfaWRcclxuY29uc3QgYnlJZCA9IG5ldyBNYXA8c3RyaW5nLCBKb3VybmFsPigpOyAgICAgICAgICAgICAgLy8gcXVpY2sgbG9va3VwIGJ5IGpvdXJuYWxfaWRcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZW5JZChwcmVmaXggPSBcIkpSTlwiKTogc3RyaW5nIHtcclxuICByZXR1cm4gYCR7cHJlZml4fS0ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIsIDEwKX1gO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaW5zZXJ0Sm91cm5hbChqOiBPbWl0PEpvdXJuYWwsIFwiaWRcIj4gJiB7IGlkPzogc3RyaW5nIH0sIGlkZW1wb3RlbmN5S2V5OiBzdHJpbmcpOiBQcm9taXNlPEpvdXJuYWw+IHtcclxuICBjb25zdCBleGlzdGluZyA9IGpvdXJuYWxzLmdldChpZGVtcG90ZW5jeUtleSk7XHJcbiAgaWYgKGV4aXN0aW5nKSByZXR1cm4gZXhpc3Rpbmc7XHJcbiAgY29uc3QgaWQgPSBqLmlkID8/IGdlbklkKCk7XHJcbiAgY29uc3Qgam91cm5hbDogSm91cm5hbCA9IHsgaWQsIC4uLmogfTtcclxuICBqb3VybmFscy5zZXQoaWRlbXBvdGVuY3lLZXksIGpvdXJuYWwpO1xyXG4gIGJ5SWQuc2V0KGlkLCBqb3VybmFsKTtcclxuICByZXR1cm4gam91cm5hbDtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEpvdXJuYWwoam91cm5hbElkOiBzdHJpbmcpOiBQcm9taXNlPEpvdXJuYWwgfCBudWxsPiB7XHJcbiAgcmV0dXJuIGJ5SWQuZ2V0KGpvdXJuYWxJZCkgPz8gbnVsbDtcclxufVxyXG5cclxuZXhwb3J0IHR5cGUgVHJpYWxCYWxhbmNlUm93ID0ge1xyXG4gIGFjY291bnRfY29kZTogc3RyaW5nO1xyXG4gIGRlYml0OiBzdHJpbmc7ICAgLy8gZGVjaW1hbCBzdHJpbmdcclxuICBjcmVkaXQ6IHN0cmluZzsgIC8vIGRlY2ltYWwgc3RyaW5nXHJcbiAgY3VycmVuY3k6IHN0cmluZztcclxufTtcclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB0cmlhbEJhbGFuY2UoY29tcGFueV9pZDogc3RyaW5nLCBjdXJyZW5jeTogc3RyaW5nKTogUHJvbWlzZTxUcmlhbEJhbGFuY2VSb3dbXT4ge1xyXG4gIC8vIEFnZ3JlZ2F0ZSBhbGwgbGluZXMgZm9yIHRoZSBjb21wYW55L2N1cnJlbmN5XHJcbiAgY29uc3QgYWNjID0gbmV3IE1hcDxzdHJpbmcsIHsgZDogbnVtYmVyOyBjOiBudW1iZXIgfT4oKTtcclxuICBmb3IgKGNvbnN0IGogb2YgYnlJZC52YWx1ZXMoKSkge1xyXG4gICAgaWYgKGouY29tcGFueV9pZCAhPT0gY29tcGFueV9pZCB8fCBqLmN1cnJlbmN5ICE9PSBjdXJyZW5jeSkgY29udGludWU7XHJcbiAgICBmb3IgKGNvbnN0IGwgb2Ygai5saW5lcykge1xyXG4gICAgICBjb25zdCBrZXkgPSBgJHtsLmFjY291bnRfY29kZX06JHtsLmN1cnJlbmN5fWA7XHJcbiAgICAgIGNvbnN0IHNsb3QgPSBhY2MuZ2V0KGtleSkgPz8geyBkOiAwLCBjOiAwIH07XHJcbiAgICAgIGNvbnN0IGFtdCA9IE51bWJlcihsLmFtb3VudC5hbW91bnQpOyAvLyBkZW1vIG9ubHk7IHJlYWwgaW1wbCBzaG91bGQgdXNlIGRlY2ltYWwgbGliXHJcbiAgICAgIGlmIChsLmRjID09PSBcIkRcIikgc2xvdC5kICs9IGFtdDsgZWxzZSBzbG90LmMgKz0gYW10O1xyXG4gICAgICBhY2Muc2V0KGtleSwgc2xvdCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIGNvbnN0IHJvd3M6IFRyaWFsQmFsYW5jZVJvd1tdID0gW107XHJcbiAgZm9yIChjb25zdCBba2V5LCB2XSBvZiBhY2MuZW50cmllcygpKSB7XHJcbiAgICBjb25zdCBbYWNjb3VudF9jb2RlLCBjdXJyXSA9IGtleS5zcGxpdChcIjpcIik7XHJcbiAgICByb3dzLnB1c2goe1xyXG4gICAgICBhY2NvdW50X2NvZGU6IGFjY291bnRfY29kZSB8fCBcIlwiLFxyXG4gICAgICBkZWJpdDogdi5kLnRvRml4ZWQoMiksXHJcbiAgICAgIGNyZWRpdDogdi5jLnRvRml4ZWQoMiksXHJcbiAgICAgIGN1cnJlbmN5OiBjdXJyIHx8IFwiXCIsXHJcbiAgICB9KTtcclxuICB9XHJcbiAgLy8gc29ydCBmb3Igc3RhYmxlIFVJXHJcbiAgcm93cy5zb3J0KChhLCBiKSA9PiBhLmFjY291bnRfY29kZS5sb2NhbGVDb21wYXJlKGIuYWNjb3VudF9jb2RlKSk7XHJcbiAgcmV0dXJuIHJvd3M7XHJcbn1cclxuXHJcbi8vIFNlcnZpY2UgY2xhc3MgdGhhdCBjYW4gdXNlIGVpdGhlciBkYXRhYmFzZSBvciBpbi1tZW1vcnkgaW1wbGVtZW50YXRpb25cclxuZXhwb3J0IGNsYXNzIExlZGdlclNlcnZpY2Uge1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBsZWRnZXJSZXBvPzogTGVkZ2VyUmVwbyxcclxuICAgIHByaXZhdGUgdHhNYW5hZ2VyPzogVHhNYW5hZ2VyXHJcbiAgKSB7IH1cclxuXHJcbiAgYXN5bmMgaW5zZXJ0Sm91cm5hbChqb3VybmFsOiBPbWl0PFJlcG9Kb3VybmFsLCBcImlkXCI+KTogUHJvbWlzZTx7IGlkOiBzdHJpbmc7IGxpbmVzOiBSZXBvSm91cm5hbExpbmVbXSB9PiB7XHJcbiAgICBpZiAodGhpcy5sZWRnZXJSZXBvICYmIHRoaXMudHhNYW5hZ2VyKSB7XHJcbiAgICAgIC8vIFVzZSBkYXRhYmFzZSBpbXBsZW1lbnRhdGlvblxyXG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy50eE1hbmFnZXIucnVuKGFzeW5jICh0eCkgPT4ge1xyXG4gICAgICAgIC8vIENoZWNrIGZvciBleGlzdGluZyBqb3VybmFsIGJ5IGlkZW1wb3RlbmN5IGtleVxyXG4gICAgICAgIGNvbnN0IGV4aXN0cyA9IGF3YWl0IHRoaXMubGVkZ2VyUmVwbyEuZXhpc3RzQnlLZXkoam91cm5hbC5pZGVtcG90ZW5jeV9rZXksIHR4KTtcclxuICAgICAgICBpZiAoZXhpc3RzKSB7XHJcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEpvdXJuYWwgd2l0aCBpZGVtcG90ZW5jeSBrZXkgJHtqb3VybmFsLmlkZW1wb3RlbmN5X2tleX0gYWxyZWFkeSBleGlzdHNgKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIEluc2VydCBqb3VybmFsIGFuZCBsaW5lc1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMubGVkZ2VyUmVwbyEuaW5zZXJ0Sm91cm5hbChqb3VybmFsLCB0eCk7XHJcblxyXG4gICAgICAgIC8vIEVucXVldWUgb3V0Ym94IGV2ZW50XHJcbiAgICAgICAgYXdhaXQgdGhpcy5sZWRnZXJSZXBvIS5lbnF1ZXVlT3V0Ym94KHtcclxuICAgICAgICAgIHR5cGU6IFwiSm91cm5hbENyZWF0ZWRcIixcclxuICAgICAgICAgIHBheWxvYWQ6IHsgam91cm5hbElkOiByZXN1bHQuaWQsIGNvbXBhbnlJZDogam91cm5hbC5jb21wYW55X2lkIH0sXHJcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXHJcbiAgICAgICAgICBhZ2dyZWdhdGVJZDogam91cm5hbC5jb21wYW55X2lkXHJcbiAgICAgICAgfSwgdHgpO1xyXG5cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIC8vIEZhbGxiYWNrIHRvIGluLW1lbW9yeSBpbXBsZW1lbnRhdGlvblxyXG4gICAgICBjb25zdCBpZGVtcG90ZW5jeUtleSA9IGpvdXJuYWwuaWRlbXBvdGVuY3lfa2V5O1xyXG4gICAgICBjb25zdCBleGlzdGluZyA9IGpvdXJuYWxzLmdldChpZGVtcG90ZW5jeUtleSk7XHJcbiAgICAgIGlmIChleGlzdGluZykge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICBpZDogZXhpc3RpbmcuaWQsXHJcbiAgICAgICAgICBsaW5lczogZXhpc3RpbmcubGluZXMubWFwKGwgPT4gKHtcclxuICAgICAgICAgICAgaWQ6IGwuaWQsXHJcbiAgICAgICAgICAgIGFjY291bnRfY29kZTogbC5hY2NvdW50X2NvZGUsXHJcbiAgICAgICAgICAgIGRjOiBsLmRjLFxyXG4gICAgICAgICAgICBhbW91bnQ6IGwuYW1vdW50LFxyXG4gICAgICAgICAgICBjdXJyZW5jeTogbC5jdXJyZW5jeSxcclxuICAgICAgICAgICAgLi4uKGwucGFydHlfdHlwZSAmJiB7IHBhcnR5X3R5cGU6IGwucGFydHlfdHlwZSB9KSxcclxuICAgICAgICAgICAgLi4uKGwucGFydHlfaWQgJiYgeyBwYXJ0eV9pZDogbC5wYXJ0eV9pZCB9KVxyXG4gICAgICAgICAgfSkpXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgaWQgPSBnZW5JZCgpO1xyXG4gICAgICBjb25zdCBqb3VybmFsV2l0aElkOiBKb3VybmFsID0ge1xyXG4gICAgICAgIGlkLFxyXG4gICAgICAgIGNvbXBhbnlfaWQ6IGpvdXJuYWwuY29tcGFueV9pZCxcclxuICAgICAgICBwb3N0aW5nX2RhdGU6IGpvdXJuYWwucG9zdGluZ19kYXRlLFxyXG4gICAgICAgIGN1cnJlbmN5OiBqb3VybmFsLmN1cnJlbmN5LFxyXG4gICAgICAgIHNvdXJjZTogeyBkb2N0eXBlOiBqb3VybmFsLnNvdXJjZV9kb2N0eXBlLCBpZDogam91cm5hbC5zb3VyY2VfaWQgfSxcclxuICAgICAgICBsaW5lczogam91cm5hbC5saW5lcy5tYXAobCA9PiAoe1xyXG4gICAgICAgICAgaWQ6IGdlbklkKFwiSlJMXCIpLFxyXG4gICAgICAgICAgYWNjb3VudF9jb2RlOiBsLmFjY291bnRfY29kZSxcclxuICAgICAgICAgIGRjOiBsLmRjLFxyXG4gICAgICAgICAgYW1vdW50OiBsLmFtb3VudCxcclxuICAgICAgICAgIGN1cnJlbmN5OiBsLmN1cnJlbmN5LFxyXG4gICAgICAgICAgLi4uKGwucGFydHlfdHlwZSAmJiB7IHBhcnR5X3R5cGU6IGwucGFydHlfdHlwZSB9KSxcclxuICAgICAgICAgIC4uLihsLnBhcnR5X2lkICYmIHsgcGFydHlfaWQ6IGwucGFydHlfaWQgfSlcclxuICAgICAgICB9KSlcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGpvdXJuYWxzLnNldChpZGVtcG90ZW5jeUtleSwgam91cm5hbFdpdGhJZCk7XHJcbiAgICAgIGJ5SWQuc2V0KGlkLCBqb3VybmFsV2l0aElkKTtcclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgaWQsXHJcbiAgICAgICAgbGluZXM6IGpvdXJuYWxXaXRoSWQubGluZXMubWFwKGwgPT4gKHtcclxuICAgICAgICAgIGlkOiBsLmlkLFxyXG4gICAgICAgICAgYWNjb3VudF9jb2RlOiBsLmFjY291bnRfY29kZSxcclxuICAgICAgICAgIGRjOiBsLmRjLFxyXG4gICAgICAgICAgYW1vdW50OiBsLmFtb3VudCxcclxuICAgICAgICAgIGN1cnJlbmN5OiBsLmN1cnJlbmN5LFxyXG4gICAgICAgICAgLi4uKGwucGFydHlfdHlwZSAmJiB7IHBhcnR5X3R5cGU6IGwucGFydHlfdHlwZSB9KSxcclxuICAgICAgICAgIC4uLihsLnBhcnR5X2lkICYmIHsgcGFydHlfaWQ6IGwucGFydHlfaWQgfSlcclxuICAgICAgICB9KSlcclxuICAgICAgfTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGFzeW5jIGdldEpvdXJuYWwoam91cm5hbElkOiBzdHJpbmcpOiBQcm9taXNlPEpvdXJuYWwgfCBudWxsPiB7XHJcbiAgICBpZiAodGhpcy5sZWRnZXJSZXBvKSB7XHJcbiAgICAgIC8vIERhdGFiYXNlIGltcGxlbWVudGF0aW9uIHdvdWxkIGdvIGhlcmVcclxuICAgICAgLy8gRm9yIG5vdywgZmFsbGJhY2sgdG8gaW4tbWVtb3J5XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYnlJZC5nZXQoam91cm5hbElkKSA/PyBudWxsO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgdHJpYWxCYWxhbmNlKGNvbXBhbnlJZDogc3RyaW5nLCBjdXJyZW5jeTogc3RyaW5nKTogUHJvbWlzZTxUcmlhbEJhbGFuY2VSb3dbXT4ge1xyXG4gICAgaWYgKHRoaXMubGVkZ2VyUmVwbyAmJiB0aGlzLnR4TWFuYWdlcikge1xyXG4gICAgICAvLyBEYXRhYmFzZSBpbXBsZW1lbnRhdGlvblxyXG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy50eE1hbmFnZXIucnVuKGFzeW5jICh0eDogVHgpID0+IHtcclxuICAgICAgICBpZiAoIXRoaXMubGVkZ2VyUmVwbz8udHJpYWxCYWxhbmNlKSB7XHJcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUcmlhbCBiYWxhbmNlIG5vdCBzdXBwb3J0ZWQgYnkgdGhpcyByZXBvc2l0b3J5XCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCByb3dzID0gYXdhaXQgdGhpcy5sZWRnZXJSZXBvLnRyaWFsQmFsYW5jZShjb21wYW55SWQsIGN1cnJlbmN5LCB0eCk7XHJcbiAgICAgICAgcmV0dXJuIHJvd3MubWFwKChyOiBhbnkpID0+ICh7XHJcbiAgICAgICAgICBhY2NvdW50X2NvZGU6IHIuYWNjb3VudF9jb2RlLFxyXG4gICAgICAgICAgZGViaXQ6IHIuZGViaXQsXHJcbiAgICAgICAgICBjcmVkaXQ6IHIuY3JlZGl0LFxyXG4gICAgICAgICAgY3VycmVuY3k6IHIuY3VycmVuY3lcclxuICAgICAgICB9KSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gRmFsbGJhY2sgdG8gaW4tbWVtb3J5IGltcGxlbWVudGF0aW9uXHJcbiAgICAgIHJldHVybiB0cmlhbEJhbGFuY2UoY29tcGFueUlkLCBjdXJyZW5jeSk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdLCJuYW1lcyI6WyJqb3VybmFscyIsIk1hcCIsImJ5SWQiLCJnZW5JZCIsInByZWZpeCIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInNsaWNlIiwiaW5zZXJ0Sm91cm5hbCIsImoiLCJpZGVtcG90ZW5jeUtleSIsImV4aXN0aW5nIiwiZ2V0IiwiaWQiLCJqb3VybmFsIiwic2V0IiwiZ2V0Sm91cm5hbCIsImpvdXJuYWxJZCIsInRyaWFsQmFsYW5jZSIsImNvbXBhbnlfaWQiLCJjdXJyZW5jeSIsImFjYyIsInZhbHVlcyIsImwiLCJsaW5lcyIsImtleSIsImFjY291bnRfY29kZSIsInNsb3QiLCJkIiwiYyIsImFtdCIsIk51bWJlciIsImFtb3VudCIsImRjIiwicm93cyIsInYiLCJlbnRyaWVzIiwiY3VyciIsInNwbGl0IiwicHVzaCIsImRlYml0IiwidG9GaXhlZCIsImNyZWRpdCIsInNvcnQiLCJhIiwiYiIsImxvY2FsZUNvbXBhcmUiLCJMZWRnZXJTZXJ2aWNlIiwibGVkZ2VyUmVwbyIsInR4TWFuYWdlciIsInJ1biIsInR4IiwiZXhpc3RzIiwiZXhpc3RzQnlLZXkiLCJpZGVtcG90ZW5jeV9rZXkiLCJFcnJvciIsInJlc3VsdCIsImVucXVldWVPdXRib3giLCJ0eXBlIiwicGF5bG9hZCIsImNvbXBhbnlJZCIsInRpbWVzdGFtcCIsIkRhdGUiLCJhZ2dyZWdhdGVJZCIsIm1hcCIsInBhcnR5X3R5cGUiLCJwYXJ0eV9pZCIsImpvdXJuYWxXaXRoSWQiLCJwb3N0aW5nX2RhdGUiLCJzb3VyY2UiLCJkb2N0eXBlIiwic291cmNlX2RvY3R5cGUiLCJzb3VyY2VfaWQiLCJyIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/../../packages/services/src/ledger.ts\n");

/***/ }),

/***/ "(rsc)/../../packages/services/src/posting.ts":
/*!**********************************************!*\
  !*** ../../packages/services/src/posting.ts ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   postSalesInvoice: () => (/* binding */ postSalesInvoice)\n/* harmony export */ });\n/* harmony import */ var _ledger__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./ledger */ \"(rsc)/../../packages/services/src/ledger.ts\");\n/* harmony import */ var _aibos_posting_rules__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @aibos/posting-rules */ \"(rsc)/../../packages/posting-rules/src/index.ts\");\n\n\n// map rule lines  JournalLine using SI doc\nfunction mapLines(si, kind) {\n    const rule = (0,_aibos_posting_rules__WEBPACK_IMPORTED_MODULE_1__.loadRule)(\"sales-invoice\");\n    const lines = rule[kind].map((l)=>{\n        const money = (0,_aibos_posting_rules__WEBPACK_IMPORTED_MODULE_1__.get)(si, l.amountField);\n        if (!money) throw new Error(`Missing amountField ${l.amountField}`);\n        const jl = {\n            id: (0,_ledger__WEBPACK_IMPORTED_MODULE_0__.genId)(\"JRL\"),\n            account_code: l.account,\n            dc: kind === \"debits\" ? \"D\" : \"C\",\n            amount: money,\n            currency: si.currency\n        };\n        if (l.party?.type && l.party.field) {\n            const partyId = (0,_aibos_posting_rules__WEBPACK_IMPORTED_MODULE_1__.get)(si, l.party.field);\n            if (partyId) {\n                jl.party_type = l.party.type;\n                jl.party_id = partyId;\n            }\n        }\n        return jl;\n    });\n    return lines;\n}\nasync function postSalesInvoice(si, deps = {}) {\n    // derive idempotency key per rule\n    const rule = (0,_aibos_posting_rules__WEBPACK_IMPORTED_MODULE_1__.loadRule)(\"sales-invoice\");\n    const idParts = rule.idempotencyKey.map((k)=>k === \"doctype\" ? \"SalesInvoice\" : k === \"id\" ? si.id : k === \"version\" ? \"v1\" : (0,_aibos_posting_rules__WEBPACK_IMPORTED_MODULE_1__.get)(si, k) ?? String((0,_aibos_posting_rules__WEBPACK_IMPORTED_MODULE_1__.get)(si, k)));\n    const key = idParts.join(\":\");\n    const lines = [\n        ...mapLines(si, \"debits\"),\n        ...mapLines(si, \"credits\")\n    ];\n    if (deps.repo && deps.tx) {\n        const id = await deps.tx.run(async (t)=>{\n            const existing = await deps.repo.getIdByKey(key, t);\n            if (existing) return existing;\n            const res = await deps.repo.insertJournal({\n                company_id: si.company_id,\n                posting_date: si.doc_date,\n                currency: si.currency,\n                source_doctype: \"SalesInvoice\",\n                source_id: si.id,\n                idempotency_key: key,\n                lines\n            }, t);\n            await deps.repo.enqueueOutbox({\n                _meta: {\n                    name: \"JournalPosted\",\n                    version: 1,\n                    occurredAt: new Date().toISOString()\n                },\n                journal_id: res.id\n            }, t);\n            return res.id;\n        });\n        return {\n            id\n        };\n    } else {\n        const j = await (0,_ledger__WEBPACK_IMPORTED_MODULE_0__.insertJournal)({\n            company_id: si.company_id,\n            posting_date: si.doc_date,\n            currency: si.currency,\n            source: {\n                doctype: \"SalesInvoice\",\n                id: si.id\n            },\n            lines\n        }, key);\n        return {\n            id: j.id\n        };\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vcGFja2FnZXMvc2VydmljZXMvc3JjL3Bvc3RpbmcudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBRWtFO0FBQ2I7QUFFckQsNENBQTRDO0FBQzVDLFNBQVNJLFNBQVNDLEVBQWdCLEVBQUVDLElBQTBCO0lBQzVELE1BQU1DLE9BQU9MLDhEQUFRQSxDQUFDO0lBQ3RCLE1BQU1NLFFBQVFELElBQUksQ0FBQ0QsS0FBSyxDQUFDRyxHQUFHLENBQUMsQ0FBQ0M7UUFDNUIsTUFBTUMsUUFBUVIseURBQUdBLENBQUNFLElBQUlLLEVBQUVFLFdBQVc7UUFDbkMsSUFBSSxDQUFDRCxPQUFPLE1BQU0sSUFBSUUsTUFBTSxDQUFDLG9CQUFvQixFQUFFSCxFQUFFRSxXQUFXLEVBQUU7UUFDbEUsTUFBTUUsS0FBa0I7WUFDdEJDLElBQUlmLDhDQUFLQSxDQUFDO1lBQ1ZnQixjQUFjTixFQUFFTyxPQUFPO1lBQ3ZCQyxJQUFJWixTQUFTLFdBQVcsTUFBTTtZQUM5QmEsUUFBUVI7WUFDUlMsVUFBVWYsR0FBR2UsUUFBUTtRQUN2QjtRQUNBLElBQUlWLEVBQUVXLEtBQUssRUFBRUMsUUFBUVosRUFBRVcsS0FBSyxDQUFDRSxLQUFLLEVBQUU7WUFDbEMsTUFBTUMsVUFBVXJCLHlEQUFHQSxDQUFDRSxJQUFJSyxFQUFFVyxLQUFLLENBQUNFLEtBQUs7WUFDckMsSUFBSUMsU0FBUztnQkFDWFYsR0FBR1csVUFBVSxHQUFHZixFQUFFVyxLQUFLLENBQUNDLElBQUk7Z0JBQzVCUixHQUFHWSxRQUFRLEdBQUdGO1lBQ2hCO1FBQ0Y7UUFDQSxPQUFPVjtJQUNUO0lBQ0EsT0FBT047QUFDVDtBQUlPLGVBQWVtQixpQkFBaUJ0QixFQUFnQixFQUFFdUIsT0FBYSxDQUFDLENBQUM7SUFDdEUsa0NBQWtDO0lBQ2xDLE1BQU1yQixPQUFPTCw4REFBUUEsQ0FBQztJQUN0QixNQUFNMkIsVUFBVXRCLEtBQUt1QixjQUFjLENBQUNyQixHQUFHLENBQUMsQ0FBQ3NCLElBQ3ZDQSxNQUFNLFlBQVksaUJBQ2hCQSxNQUFNLE9BQU8xQixHQUFHVSxFQUFFLEdBQ2hCZ0IsTUFBTSxZQUFZLE9BQ2Y1Qix5REFBR0EsQ0FBQ0UsSUFBSTBCLE1BQU1DLE9BQU83Qix5REFBR0EsQ0FBQ0UsSUFBVzBCO0lBRTdDLE1BQU1FLE1BQU1KLFFBQVFLLElBQUksQ0FBQztJQUV6QixNQUFNMUIsUUFBUTtXQUFJSixTQUFTQyxJQUFJO1dBQWNELFNBQVNDLElBQUk7S0FBVztJQUVyRSxJQUFJdUIsS0FBS08sSUFBSSxJQUFJUCxLQUFLUSxFQUFFLEVBQUU7UUFDeEIsTUFBTXJCLEtBQUssTUFBTWEsS0FBS1EsRUFBRSxDQUFDQyxHQUFHLENBQUMsT0FBT0M7WUFDbEMsTUFBTUMsV0FBVyxNQUFNWCxLQUFLTyxJQUFJLENBQUVLLFVBQVUsQ0FBQ1AsS0FBS0s7WUFDbEQsSUFBSUMsVUFBVSxPQUFPQTtZQUNyQixNQUFNRSxNQUFNLE1BQU1iLEtBQUtPLElBQUksQ0FBRWxDLGFBQWEsQ0FBQztnQkFDekN5QyxZQUFZckMsR0FBR3FDLFVBQVU7Z0JBQ3pCQyxjQUFjdEMsR0FBR3VDLFFBQVE7Z0JBQ3pCeEIsVUFBVWYsR0FBR2UsUUFBUTtnQkFDckJ5QixnQkFBZ0I7Z0JBQ2hCQyxXQUFXekMsR0FBR1UsRUFBRTtnQkFDaEJnQyxpQkFBaUJkO2dCQUNqQnpCO1lBQ0YsR0FBRzhCO1lBQ0gsTUFBTVYsS0FBS08sSUFBSSxDQUFFYSxhQUFhLENBQUM7Z0JBQzdCQyxPQUFPO29CQUFFQyxNQUFNO29CQUFpQkMsU0FBUztvQkFBR0MsWUFBWSxJQUFJQyxPQUFPQyxXQUFXO2dCQUFHO2dCQUNqRkMsWUFBWWQsSUFBSTFCLEVBQUU7WUFDcEIsR0FBR3VCO1lBQ0gsT0FBT0csSUFBSTFCLEVBQUU7UUFDZjtRQUNBLE9BQU87WUFBRUE7UUFBRztJQUNkLE9BQU87UUFDTCxNQUFNeUMsSUFBSSxNQUFNdkQsc0RBQWFBLENBQUM7WUFDNUJ5QyxZQUFZckMsR0FBR3FDLFVBQVU7WUFDekJDLGNBQWN0QyxHQUFHdUMsUUFBUTtZQUN6QnhCLFVBQVVmLEdBQUdlLFFBQVE7WUFDckJxQyxRQUFRO2dCQUFFQyxTQUFTO2dCQUFnQjNDLElBQUlWLEdBQUdVLEVBQUU7WUFBQztZQUM3Q1A7UUFDRixHQUFHeUI7UUFDSCxPQUFPO1lBQUVsQixJQUFJeUMsRUFBRXpDLEVBQUU7UUFBQztJQUNwQjtBQUNGIiwic291cmNlcyI6WyJDOlxcQUktQk9TXFxhaWJvcy1lcnBCT1NcXHBhY2thZ2VzXFxzZXJ2aWNlc1xcc3JjXFxwb3N0aW5nLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgU2FsZXNJbnZvaWNlIH0gZnJvbSBcIkBhaWJvcy9jb250cmFjdHMvaHR0cC9zYWxlcy9zYWxlcy1pbnZvaWNlLnNjaGVtYVwiO1xyXG5pbXBvcnQgdHlwZSB7IExlZGdlclJlcG8sIFR4TWFuYWdlciB9IGZyb20gXCJAYWlib3MvcG9ydHNcIjtcclxuaW1wb3J0IHsgZ2VuSWQsIHR5cGUgSm91cm5hbExpbmUsIGluc2VydEpvdXJuYWwgfSBmcm9tIFwiLi9sZWRnZXJcIjtcclxuaW1wb3J0IHsgbG9hZFJ1bGUsIGdldCB9IGZyb20gXCJAYWlib3MvcG9zdGluZy1ydWxlc1wiO1xyXG5cclxuLy8gbWFwIHJ1bGUgbGluZXMg4oaSIEpvdXJuYWxMaW5lIHVzaW5nIFNJIGRvY1xyXG5mdW5jdGlvbiBtYXBMaW5lcyhzaTogU2FsZXNJbnZvaWNlLCBraW5kOiBcImRlYml0c1wiIHwgXCJjcmVkaXRzXCIpOiBKb3VybmFsTGluZVtdIHtcclxuICBjb25zdCBydWxlID0gbG9hZFJ1bGUoXCJzYWxlcy1pbnZvaWNlXCIpO1xyXG4gIGNvbnN0IGxpbmVzID0gcnVsZVtraW5kXS5tYXAoKGw6IGFueSkgPT4ge1xyXG4gICAgY29uc3QgbW9uZXkgPSBnZXQoc2ksIGwuYW1vdW50RmllbGQpO1xyXG4gICAgaWYgKCFtb25leSkgdGhyb3cgbmV3IEVycm9yKGBNaXNzaW5nIGFtb3VudEZpZWxkICR7bC5hbW91bnRGaWVsZH1gKTtcclxuICAgIGNvbnN0IGpsOiBKb3VybmFsTGluZSA9IHtcclxuICAgICAgaWQ6IGdlbklkKFwiSlJMXCIpLFxyXG4gICAgICBhY2NvdW50X2NvZGU6IGwuYWNjb3VudCxcclxuICAgICAgZGM6IGtpbmQgPT09IFwiZGViaXRzXCIgPyBcIkRcIiA6IFwiQ1wiLFxyXG4gICAgICBhbW91bnQ6IG1vbmV5LFxyXG4gICAgICBjdXJyZW5jeTogc2kuY3VycmVuY3ksXHJcbiAgICB9O1xyXG4gICAgaWYgKGwucGFydHk/LnR5cGUgJiYgbC5wYXJ0eS5maWVsZCkge1xyXG4gICAgICBjb25zdCBwYXJ0eUlkID0gZ2V0KHNpLCBsLnBhcnR5LmZpZWxkKTtcclxuICAgICAgaWYgKHBhcnR5SWQpIHtcclxuICAgICAgICBqbC5wYXJ0eV90eXBlID0gbC5wYXJ0eS50eXBlIGFzIGFueTtcclxuICAgICAgICBqbC5wYXJ0eV9pZCA9IHBhcnR5SWQ7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBqbDtcclxuICB9KTtcclxuICByZXR1cm4gbGluZXM7XHJcbn1cclxuXHJcbnR5cGUgRGVwcyA9IHsgcmVwbz86IExlZGdlclJlcG87IHR4PzogVHhNYW5hZ2VyIH07XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcG9zdFNhbGVzSW52b2ljZShzaTogU2FsZXNJbnZvaWNlLCBkZXBzOiBEZXBzID0ge30pIHtcclxuICAvLyBkZXJpdmUgaWRlbXBvdGVuY3kga2V5IHBlciBydWxlXHJcbiAgY29uc3QgcnVsZSA9IGxvYWRSdWxlKFwic2FsZXMtaW52b2ljZVwiKTtcclxuICBjb25zdCBpZFBhcnRzID0gcnVsZS5pZGVtcG90ZW5jeUtleS5tYXAoKGs6IHN0cmluZykgPT5cclxuICAgIGsgPT09IFwiZG9jdHlwZVwiID8gXCJTYWxlc0ludm9pY2VcIiA6XHJcbiAgICAgIGsgPT09IFwiaWRcIiA/IHNpLmlkIDpcclxuICAgICAgICBrID09PSBcInZlcnNpb25cIiA/IFwidjFcIiA6XHJcbiAgICAgICAgICAoZ2V0KHNpLCBrKSA/PyBTdHJpbmcoZ2V0KHNpIGFzIGFueSwgaykpKVxyXG4gICk7XHJcbiAgY29uc3Qga2V5ID0gaWRQYXJ0cy5qb2luKFwiOlwiKTtcclxuXHJcbiAgY29uc3QgbGluZXMgPSBbLi4ubWFwTGluZXMoc2ksIFwiZGViaXRzXCIpLCAuLi5tYXBMaW5lcyhzaSwgXCJjcmVkaXRzXCIpXTtcclxuXHJcbiAgaWYgKGRlcHMucmVwbyAmJiBkZXBzLnR4KSB7XHJcbiAgICBjb25zdCBpZCA9IGF3YWl0IGRlcHMudHgucnVuKGFzeW5jICh0OiBhbnkpID0+IHtcclxuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBkZXBzLnJlcG8hLmdldElkQnlLZXkoa2V5LCB0IGFzIGFueSk7XHJcbiAgICAgIGlmIChleGlzdGluZykgcmV0dXJuIGV4aXN0aW5nO1xyXG4gICAgICBjb25zdCByZXMgPSBhd2FpdCBkZXBzLnJlcG8hLmluc2VydEpvdXJuYWwoe1xyXG4gICAgICAgIGNvbXBhbnlfaWQ6IHNpLmNvbXBhbnlfaWQsXHJcbiAgICAgICAgcG9zdGluZ19kYXRlOiBzaS5kb2NfZGF0ZSxcclxuICAgICAgICBjdXJyZW5jeTogc2kuY3VycmVuY3ksXHJcbiAgICAgICAgc291cmNlX2RvY3R5cGU6IFwiU2FsZXNJbnZvaWNlXCIsXHJcbiAgICAgICAgc291cmNlX2lkOiBzaS5pZCxcclxuICAgICAgICBpZGVtcG90ZW5jeV9rZXk6IGtleSxcclxuICAgICAgICBsaW5lc1xyXG4gICAgICB9LCB0IGFzIGFueSk7XHJcbiAgICAgIGF3YWl0IGRlcHMucmVwbyEuZW5xdWV1ZU91dGJveCh7XHJcbiAgICAgICAgX21ldGE6IHsgbmFtZTogXCJKb3VybmFsUG9zdGVkXCIsIHZlcnNpb246IDEsIG9jY3VycmVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSB9LFxyXG4gICAgICAgIGpvdXJuYWxfaWQ6IHJlcy5pZFxyXG4gICAgICB9LCB0IGFzIGFueSk7XHJcbiAgICAgIHJldHVybiByZXMuaWQ7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiB7IGlkIH07XHJcbiAgfSBlbHNlIHtcclxuICAgIGNvbnN0IGogPSBhd2FpdCBpbnNlcnRKb3VybmFsKHtcclxuICAgICAgY29tcGFueV9pZDogc2kuY29tcGFueV9pZCxcclxuICAgICAgcG9zdGluZ19kYXRlOiBzaS5kb2NfZGF0ZSxcclxuICAgICAgY3VycmVuY3k6IHNpLmN1cnJlbmN5LFxyXG4gICAgICBzb3VyY2U6IHsgZG9jdHlwZTogXCJTYWxlc0ludm9pY2VcIiwgaWQ6IHNpLmlkIH0sXHJcbiAgICAgIGxpbmVzXHJcbiAgICB9LCBrZXkpO1xyXG4gICAgcmV0dXJuIHsgaWQ6IGouaWQgfTtcclxuICB9XHJcbn0iXSwibmFtZXMiOlsiZ2VuSWQiLCJpbnNlcnRKb3VybmFsIiwibG9hZFJ1bGUiLCJnZXQiLCJtYXBMaW5lcyIsInNpIiwia2luZCIsInJ1bGUiLCJsaW5lcyIsIm1hcCIsImwiLCJtb25leSIsImFtb3VudEZpZWxkIiwiRXJyb3IiLCJqbCIsImlkIiwiYWNjb3VudF9jb2RlIiwiYWNjb3VudCIsImRjIiwiYW1vdW50IiwiY3VycmVuY3kiLCJwYXJ0eSIsInR5cGUiLCJmaWVsZCIsInBhcnR5SWQiLCJwYXJ0eV90eXBlIiwicGFydHlfaWQiLCJwb3N0U2FsZXNJbnZvaWNlIiwiZGVwcyIsImlkUGFydHMiLCJpZGVtcG90ZW5jeUtleSIsImsiLCJTdHJpbmciLCJrZXkiLCJqb2luIiwicmVwbyIsInR4IiwicnVuIiwidCIsImV4aXN0aW5nIiwiZ2V0SWRCeUtleSIsInJlcyIsImNvbXBhbnlfaWQiLCJwb3N0aW5nX2RhdGUiLCJkb2NfZGF0ZSIsInNvdXJjZV9kb2N0eXBlIiwic291cmNlX2lkIiwiaWRlbXBvdGVuY3lfa2V5IiwiZW5xdWV1ZU91dGJveCIsIl9tZXRhIiwibmFtZSIsInZlcnNpb24iLCJvY2N1cnJlZEF0IiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwiam91cm5hbF9pZCIsImoiLCJzb3VyY2UiLCJkb2N0eXBlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/../../packages/services/src/posting.ts\n");

/***/ }),

/***/ "(rsc)/./app/api/sales-invoices/route.ts":
/*!*****************************************!*\
  !*** ./app/api/sales-invoices/route.ts ***!
  \*****************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   OPTIONS: () => (/* binding */ OPTIONS),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var _aibos_contracts_http_sales_sales_invoice_schema__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @aibos/contracts/http/sales/sales-invoice.schema */ \"(rsc)/../../packages/contracts/http/sales/sales-invoice.schema.ts\");\n/* harmony import */ var _aibos_services_src_posting__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @aibos/services/src/posting */ \"(rsc)/../../packages/services/src/posting.ts\");\n/* harmony import */ var _lib_db__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../lib/db */ \"(rsc)/./app/lib/db.ts\");\n/* harmony import */ var _lib_policy__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../lib/policy */ \"(rsc)/./app/lib/policy.ts\");\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../lib/auth */ \"(rsc)/./app/lib/auth.ts\");\n/* harmony import */ var _lib_route_utils__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../lib/route-utils */ \"(rsc)/./app/lib/route-utils.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_db__WEBPACK_IMPORTED_MODULE_2__, _lib_policy__WEBPACK_IMPORTED_MODULE_3__, _lib_auth__WEBPACK_IMPORTED_MODULE_4__]);\n([_lib_db__WEBPACK_IMPORTED_MODULE_2__, _lib_policy__WEBPACK_IMPORTED_MODULE_3__, _lib_auth__WEBPACK_IMPORTED_MODULE_4__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\nconst POST = (0,_lib_route_utils__WEBPACK_IMPORTED_MODULE_5__.withRouteErrors)(async (req)=>{\n    const authResult = await (0,_lib_auth__WEBPACK_IMPORTED_MODULE_4__.requireAuth)(req);\n    if ((0,_lib_route_utils__WEBPACK_IMPORTED_MODULE_5__.isResponse)(authResult)) return authResult;\n    const capCheck = (0,_lib_auth__WEBPACK_IMPORTED_MODULE_4__.requireCapability)(authResult, \"journals:post\");\n    if ((0,_lib_route_utils__WEBPACK_IMPORTED_MODULE_5__.isResponse)(capCheck)) return capCheck;\n    const input = _aibos_contracts_http_sales_sales_invoice_schema__WEBPACK_IMPORTED_MODULE_0__.SalesInvoice.parse(await req.json());\n    const companyMatchResult = (0,_lib_auth__WEBPACK_IMPORTED_MODULE_4__.enforceCompanyMatch)(authResult, input.company_id);\n    if ((0,_lib_route_utils__WEBPACK_IMPORTED_MODULE_5__.isResponse)(companyMatchResult)) return companyMatchResult;\n    const postingCheck = await (0,_lib_policy__WEBPACK_IMPORTED_MODULE_3__.ensurePostingAllowed)(authResult.company_id, input.doc_date);\n    if ((0,_lib_route_utils__WEBPACK_IMPORTED_MODULE_5__.isResponse)(postingCheck)) return postingCheck;\n    // Check for existing journal by idempotency key\n    const rule = await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! @aibos/posting-rules */ \"(rsc)/../../packages/posting-rules/src/index.ts\")).then((m)=>m.loadRule(\"sales-invoice\"));\n    const idParts = rule.idempotencyKey.map((k)=>k === \"doctype\" ? \"SalesInvoice\" : k === \"id\" ? input.id : k === \"version\" ? \"v1\" : input[k] ?? String(input[k]));\n    const key = idParts.join(\":\");\n    const existingId = await _lib_db__WEBPACK_IMPORTED_MODULE_2__.repo.getIdByKey(key);\n    if (existingId) {\n        return Response.json({\n            journal_id: existingId\n        }, {\n            status: 200,\n            headers: {\n                'Access-Control-Allow-Origin': '*',\n                'Access-Control-Allow-Methods': 'POST, OPTIONS',\n                'Access-Control-Allow-Headers': 'Content-Type',\n                'X-Idempotent-Replay': 'true'\n            }\n        });\n    }\n    const journal = await (0,_aibos_services_src_posting__WEBPACK_IMPORTED_MODULE_1__.postSalesInvoice)({\n        ...input,\n        company_id: authResult.company_id\n    }, {\n        repo: _lib_db__WEBPACK_IMPORTED_MODULE_2__.repo,\n        tx: _lib_db__WEBPACK_IMPORTED_MODULE_2__.tx\n    });\n    return Response.json({\n        journal_id: journal.id\n    }, {\n        status: 201,\n        headers: {\n            'Access-Control-Allow-Origin': '*',\n            'Access-Control-Allow-Methods': 'POST, OPTIONS',\n            'Access-Control-Allow-Headers': 'Content-Type'\n        }\n    });\n});\nasync function OPTIONS(req) {\n    return new Response(null, {\n        status: 204,\n        headers: {\n            'Access-Control-Allow-Origin': '*',\n            'Access-Control-Allow-Methods': 'POST, OPTIONS',\n            'Access-Control-Allow-Headers': 'Content-Type'\n        }\n    });\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL3NhbGVzLWludm9pY2VzL3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQWdGO0FBQ2pCO0FBQ3ZCO0FBQ2dCO0FBQzZCO0FBQ2pCO0FBRTdELE1BQU1VLE9BQU9GLGlFQUFlQSxDQUFDLE9BQU9HO0lBQ3pDLE1BQU1DLGFBQWEsTUFBTVAsc0RBQVdBLENBQUNNO0lBQ3JDLElBQUlGLDREQUFVQSxDQUFDRyxhQUFhLE9BQU9BO0lBRW5DLE1BQU1DLFdBQVdOLDREQUFpQkEsQ0FBQ0ssWUFBWTtJQUMvQyxJQUFJSCw0REFBVUEsQ0FBQ0ksV0FBVyxPQUFPQTtJQUVqQyxNQUFNQyxRQUFRZCwwRkFBWUEsQ0FBQ2UsS0FBSyxDQUFDLE1BQU1KLElBQUlLLElBQUk7SUFFL0MsTUFBTUMscUJBQXFCWCw4REFBbUJBLENBQUNNLFlBQVlFLE1BQU1JLFVBQVU7SUFDM0UsSUFBSVQsNERBQVVBLENBQUNRLHFCQUFxQixPQUFPQTtJQUUzQyxNQUFNRSxlQUFlLE1BQU1mLGlFQUFvQkEsQ0FBQ1EsV0FBV00sVUFBVSxFQUFFSixNQUFNTSxRQUFRO0lBQ3JGLElBQUlYLDREQUFVQSxDQUFDVSxlQUFlLE9BQU9BO0lBRXJDLGdEQUFnRDtJQUNoRCxNQUFNRSxPQUFPLE1BQU0sbUtBQThCLENBQUNDLElBQUksQ0FBQ0MsQ0FBQUEsSUFBS0EsRUFBRUMsUUFBUSxDQUFDO0lBQ3ZFLE1BQU1DLFVBQVVKLEtBQUtLLGNBQWMsQ0FBQ0MsR0FBRyxDQUFDLENBQUNDLElBQ3ZDQSxNQUFNLFlBQVksaUJBQ2hCQSxNQUFNLE9BQU9kLE1BQU1lLEVBQUUsR0FDbkJELE1BQU0sWUFBWSxPQUNoQixLQUFjLENBQUNBLEVBQUUsSUFBSUUsT0FBTyxLQUFjLENBQUNGLEVBQUU7SUFFckQsTUFBTUcsTUFBTU4sUUFBUU8sSUFBSSxDQUFDO0lBRXpCLE1BQU1DLGFBQWEsTUFBTS9CLHlDQUFJQSxDQUFDZ0MsVUFBVSxDQUFDSDtJQUN6QyxJQUFJRSxZQUFZO1FBQ2QsT0FBT0UsU0FBU25CLElBQUksQ0FBQztZQUFFb0IsWUFBWUg7UUFBVyxHQUFHO1lBQy9DSSxRQUFRO1lBQ1JDLFNBQVM7Z0JBQ1AsK0JBQStCO2dCQUMvQixnQ0FBZ0M7Z0JBQ2hDLGdDQUFnQztnQkFDaEMsdUJBQXVCO1lBQ3pCO1FBQ0Y7SUFDRjtJQUVBLE1BQU1DLFVBQVUsTUFBTXRDLDZFQUFnQkEsQ0FBQztRQUFFLEdBQUdhLEtBQUs7UUFBRUksWUFBWU4sV0FBV00sVUFBVTtJQUFDLEdBQUc7UUFBRWhCLElBQUlBLDJDQUFBQTtRQUFFQyxFQUFFQSx5Q0FBQUE7SUFBQztJQUNuRyxPQUFPZ0MsU0FBU25CLElBQUksQ0FBQztRQUFFb0IsWUFBWUcsUUFBUVYsRUFBRTtJQUFDLEdBQUc7UUFDL0NRLFFBQVE7UUFDUkMsU0FBUztZQUNQLCtCQUErQjtZQUMvQixnQ0FBZ0M7WUFDaEMsZ0NBQWdDO1FBQ2xDO0lBQ0Y7QUFDRixHQUFHO0FBRUksZUFBZUUsUUFBUTdCLEdBQVk7SUFDeEMsT0FBTyxJQUFJd0IsU0FBUyxNQUFNO1FBQ3hCRSxRQUFRO1FBQ1JDLFNBQVM7WUFDUCwrQkFBK0I7WUFDL0IsZ0NBQWdDO1lBQ2hDLGdDQUFnQztRQUNsQztJQUNGO0FBQ0YiLCJzb3VyY2VzIjpbIkM6XFxBSS1CT1NcXGFpYm9zLWVycEJPU1xcYXBwc1xcYmZmXFxhcHBcXGFwaVxcc2FsZXMtaW52b2ljZXNcXHJvdXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFNhbGVzSW52b2ljZSB9IGZyb20gXCJAYWlib3MvY29udHJhY3RzL2h0dHAvc2FsZXMvc2FsZXMtaW52b2ljZS5zY2hlbWFcIjtcclxuaW1wb3J0IHsgcG9zdFNhbGVzSW52b2ljZSB9IGZyb20gXCJAYWlib3Mvc2VydmljZXMvc3JjL3Bvc3RpbmdcIjtcclxuaW1wb3J0IHsgcmVwbywgdHggfSBmcm9tIFwiLi4vLi4vbGliL2RiXCI7XHJcbmltcG9ydCB7IGVuc3VyZVBvc3RpbmdBbGxvd2VkIH0gZnJvbSBcIi4uLy4uL2xpYi9wb2xpY3lcIjtcclxuaW1wb3J0IHsgcmVxdWlyZUF1dGgsIGVuZm9yY2VDb21wYW55TWF0Y2gsIHJlcXVpcmVDYXBhYmlsaXR5IH0gZnJvbSBcIi4uLy4uL2xpYi9hdXRoXCI7XHJcbmltcG9ydCB7IHdpdGhSb3V0ZUVycm9ycywgaXNSZXNwb25zZSB9IGZyb20gXCIuLi8uLi9saWIvcm91dGUtdXRpbHNcIjtcclxuXHJcbmV4cG9ydCBjb25zdCBQT1NUID0gd2l0aFJvdXRlRXJyb3JzKGFzeW5jIChyZXE6IFJlcXVlc3QpID0+IHtcclxuICBjb25zdCBhdXRoUmVzdWx0ID0gYXdhaXQgcmVxdWlyZUF1dGgocmVxKTtcclxuICBpZiAoaXNSZXNwb25zZShhdXRoUmVzdWx0KSkgcmV0dXJuIGF1dGhSZXN1bHQ7XHJcblxyXG4gIGNvbnN0IGNhcENoZWNrID0gcmVxdWlyZUNhcGFiaWxpdHkoYXV0aFJlc3VsdCwgXCJqb3VybmFsczpwb3N0XCIpO1xyXG4gIGlmIChpc1Jlc3BvbnNlKGNhcENoZWNrKSkgcmV0dXJuIGNhcENoZWNrO1xyXG5cclxuICBjb25zdCBpbnB1dCA9IFNhbGVzSW52b2ljZS5wYXJzZShhd2FpdCByZXEuanNvbigpKTtcclxuXHJcbiAgY29uc3QgY29tcGFueU1hdGNoUmVzdWx0ID0gZW5mb3JjZUNvbXBhbnlNYXRjaChhdXRoUmVzdWx0LCBpbnB1dC5jb21wYW55X2lkKTtcclxuICBpZiAoaXNSZXNwb25zZShjb21wYW55TWF0Y2hSZXN1bHQpKSByZXR1cm4gY29tcGFueU1hdGNoUmVzdWx0O1xyXG5cclxuICBjb25zdCBwb3N0aW5nQ2hlY2sgPSBhd2FpdCBlbnN1cmVQb3N0aW5nQWxsb3dlZChhdXRoUmVzdWx0LmNvbXBhbnlfaWQsIGlucHV0LmRvY19kYXRlKTtcclxuICBpZiAoaXNSZXNwb25zZShwb3N0aW5nQ2hlY2spKSByZXR1cm4gcG9zdGluZ0NoZWNrO1xyXG5cclxuICAvLyBDaGVjayBmb3IgZXhpc3Rpbmcgam91cm5hbCBieSBpZGVtcG90ZW5jeSBrZXlcclxuICBjb25zdCBydWxlID0gYXdhaXQgaW1wb3J0KFwiQGFpYm9zL3Bvc3RpbmctcnVsZXNcIikudGhlbihtID0+IG0ubG9hZFJ1bGUoXCJzYWxlcy1pbnZvaWNlXCIpKTtcclxuICBjb25zdCBpZFBhcnRzID0gcnVsZS5pZGVtcG90ZW5jeUtleS5tYXAoKGs6IHN0cmluZykgPT5cclxuICAgIGsgPT09IFwiZG9jdHlwZVwiID8gXCJTYWxlc0ludm9pY2VcIiA6XHJcbiAgICAgIGsgPT09IFwiaWRcIiA/IGlucHV0LmlkIDpcclxuICAgICAgICBrID09PSBcInZlcnNpb25cIiA/IFwidjFcIiA6XHJcbiAgICAgICAgICAoaW5wdXQgYXMgYW55KVtrXSA/PyBTdHJpbmcoKGlucHV0IGFzIGFueSlba10pXHJcbiAgKTtcclxuICBjb25zdCBrZXkgPSBpZFBhcnRzLmpvaW4oXCI6XCIpO1xyXG5cclxuICBjb25zdCBleGlzdGluZ0lkID0gYXdhaXQgcmVwby5nZXRJZEJ5S2V5KGtleSk7XHJcbiAgaWYgKGV4aXN0aW5nSWQpIHtcclxuICAgIHJldHVybiBSZXNwb25zZS5qc29uKHsgam91cm5hbF9pZDogZXhpc3RpbmdJZCB9LCB7XHJcbiAgICAgIHN0YXR1czogMjAwLFxyXG4gICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbic6ICcqJyxcclxuICAgICAgICAnQWNjZXNzLUNvbnRyb2wtQWxsb3ctTWV0aG9kcyc6ICdQT1NULCBPUFRJT05TJyxcclxuICAgICAgICAnQWNjZXNzLUNvbnRyb2wtQWxsb3ctSGVhZGVycyc6ICdDb250ZW50LVR5cGUnLFxyXG4gICAgICAgICdYLUlkZW1wb3RlbnQtUmVwbGF5JzogJ3RydWUnLFxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGNvbnN0IGpvdXJuYWwgPSBhd2FpdCBwb3N0U2FsZXNJbnZvaWNlKHsgLi4uaW5wdXQsIGNvbXBhbnlfaWQ6IGF1dGhSZXN1bHQuY29tcGFueV9pZCB9LCB7IHJlcG8sIHR4IH0pO1xyXG4gIHJldHVybiBSZXNwb25zZS5qc29uKHsgam91cm5hbF9pZDogam91cm5hbC5pZCB9LCB7XHJcbiAgICBzdGF0dXM6IDIwMSxcclxuICAgIGhlYWRlcnM6IHtcclxuICAgICAgJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbic6ICcqJyxcclxuICAgICAgJ0FjY2Vzcy1Db250cm9sLUFsbG93LU1ldGhvZHMnOiAnUE9TVCwgT1BUSU9OUycsXHJcbiAgICAgICdBY2Nlc3MtQ29udHJvbC1BbGxvdy1IZWFkZXJzJzogJ0NvbnRlbnQtVHlwZScsXHJcbiAgICB9XHJcbiAgfSk7XHJcbn0pO1xyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIE9QVElPTlMocmVxOiBSZXF1ZXN0KSB7XHJcbiAgcmV0dXJuIG5ldyBSZXNwb25zZShudWxsLCB7XHJcbiAgICBzdGF0dXM6IDIwNCxcclxuICAgIGhlYWRlcnM6IHtcclxuICAgICAgJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbic6ICcqJyxcclxuICAgICAgJ0FjY2Vzcy1Db250cm9sLUFsbG93LU1ldGhvZHMnOiAnUE9TVCwgT1BUSU9OUycsXHJcbiAgICAgICdBY2Nlc3MtQ29udHJvbC1BbGxvdy1IZWFkZXJzJzogJ0NvbnRlbnQtVHlwZScsXHJcbiAgICB9XHJcbiAgfSk7XHJcbn1cclxuIl0sIm5hbWVzIjpbIlNhbGVzSW52b2ljZSIsInBvc3RTYWxlc0ludm9pY2UiLCJyZXBvIiwidHgiLCJlbnN1cmVQb3N0aW5nQWxsb3dlZCIsInJlcXVpcmVBdXRoIiwiZW5mb3JjZUNvbXBhbnlNYXRjaCIsInJlcXVpcmVDYXBhYmlsaXR5Iiwid2l0aFJvdXRlRXJyb3JzIiwiaXNSZXNwb25zZSIsIlBPU1QiLCJyZXEiLCJhdXRoUmVzdWx0IiwiY2FwQ2hlY2siLCJpbnB1dCIsInBhcnNlIiwianNvbiIsImNvbXBhbnlNYXRjaFJlc3VsdCIsImNvbXBhbnlfaWQiLCJwb3N0aW5nQ2hlY2siLCJkb2NfZGF0ZSIsInJ1bGUiLCJ0aGVuIiwibSIsImxvYWRSdWxlIiwiaWRQYXJ0cyIsImlkZW1wb3RlbmN5S2V5IiwibWFwIiwiayIsImlkIiwiU3RyaW5nIiwia2V5Iiwiam9pbiIsImV4aXN0aW5nSWQiLCJnZXRJZEJ5S2V5IiwiUmVzcG9uc2UiLCJqb3VybmFsX2lkIiwic3RhdHVzIiwiaGVhZGVycyIsImpvdXJuYWwiLCJPUFRJT05TIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/sales-invoices/route.ts\n");

/***/ }),

/***/ "(rsc)/./app/lib/auth.ts":
/*!*************************!*\
  !*** ./app/lib/auth.ts ***!
  \*************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   enforceCompanyMatch: () => (/* binding */ enforceCompanyMatch),\n/* harmony export */   parseKeyIdFromHeader: () => (/* binding */ parseKeyIdFromHeader),\n/* harmony export */   requireAuth: () => (/* binding */ requireAuth),\n/* harmony export */   requireCapability: () => (/* binding */ requireCapability)\n/* harmony export */ });\n/* harmony import */ var node_crypto__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! node:crypto */ \"node:crypto\");\n/* harmony import */ var node_crypto__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(node_crypto__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./db */ \"(rsc)/./app/lib/db.ts\");\n/* harmony import */ var _rbac__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./rbac */ \"(rsc)/./app/lib/rbac.ts\");\n/* harmony import */ var _ratelimit__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./ratelimit */ \"(rsc)/./app/lib/ratelimit.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_db__WEBPACK_IMPORTED_MODULE_1__]);\n_db__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\nfunction sha256(x) {\n    return node_crypto__WEBPACK_IMPORTED_MODULE_0___default().createHash(\"sha256\").update(x, \"utf8\").digest(\"hex\");\n}\nasync function requireAuth(req) {\n    const raw = req.headers.get(\"x-api-key\");\n    if (!raw) return new Response(JSON.stringify({\n        ok: false,\n        message: \"Missing X-API-Key\"\n    }), {\n        status: 401,\n        headers: {\n            \"content-type\": \"application/json\"\n        }\n    });\n    const [id, secret] = raw.split(\":\");\n    if (!id || !secret) return new Response(JSON.stringify({\n        ok: false,\n        message: \"Invalid API key format\"\n    }), {\n        status: 401,\n        headers: {\n            \"content-type\": \"application/json\"\n        }\n    });\n    // rate limit per key id (even before DB lookup)\n    if (!(0,_ratelimit__WEBPACK_IMPORTED_MODULE_3__.rateLimitCheck)(id)) {\n        const ra = (0,_ratelimit__WEBPACK_IMPORTED_MODULE_3__.retryAfterSecs)(id);\n        const headers = new Headers({\n            \"Retry-After\": String(ra),\n            \"Content-Type\": \"application/json\"\n        });\n        return new Response(JSON.stringify({\n            ok: false,\n            message: \"rate limited\"\n        }), {\n            status: 429,\n            headers\n        });\n    }\n    const { rows } = await _db__WEBPACK_IMPORTED_MODULE_1__.pool.query(`select k.user_id, k.company_id, k.enabled, k.hash, k.scopes, k.prefix, m.role\n       from api_key k\n       join membership m on m.user_id = k.user_id and m.company_id = k.company_id\n      where k.id = $1\n      limit 1`, [\n        id\n    ]);\n    const k = rows[0];\n    if (!k || k.enabled !== \"true\") return new Response(JSON.stringify({\n        ok: false,\n        message: \"API key disabled or not found\"\n    }), {\n        status: 401,\n        headers: {\n            \"content-type\": \"application/json\"\n        }\n    });\n    if (sha256(secret) !== k.hash) return new Response(JSON.stringify({\n        ok: false,\n        message: \"Invalid API key secret\"\n    }), {\n        status: 401,\n        headers: {\n            \"content-type\": \"application/json\"\n        }\n    });\n    // touch last_used_at asynchronously (don't block path)\n    _db__WEBPACK_IMPORTED_MODULE_1__.pool.query(`update api_key set last_used_at = now() where id = $1`, [\n        id\n    ]).catch(()=>{});\n    const role = k.role ?? \"ops\";\n    const reqScopes = Array.isArray(k.scopes) ? k.scopes : [];\n    const scopes = (0,_rbac__WEBPACK_IMPORTED_MODULE_2__.normalizeScopes)(role, reqScopes);\n    return {\n        user_id: k.user_id,\n        company_id: k.company_id,\n        role,\n        scopes\n    };\n}\n/** Ensure any provided company_id matches auth */ function enforceCompanyMatch(auth, provided) {\n    if (!provided) return;\n    if (provided !== auth.company_id) {\n        return new Response(JSON.stringify({\n            ok: false,\n            message: \"company_id mismatch\"\n        }), {\n            status: 403,\n            headers: {\n                \"content-type\": \"application/json\"\n            }\n        });\n    }\n}\nfunction parseKeyIdFromHeader(req) {\n    const raw = req.headers.get(\"x-api-key\");\n    if (!raw) return null;\n    const [id] = raw.split(\":\");\n    return id || null;\n}\nfunction requireCapability(auth, cap) {\n    if (!auth.scopes.includes(cap)) {\n        return new Response(JSON.stringify({\n            ok: false,\n            message: `forbidden: missing scope ${cap}`\n        }), {\n            status: 403,\n            headers: {\n                \"content-type\": \"application/json\"\n            }\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QW1CO1FBQUU7SUFDcEo7QUFDRjtBQUVPLFNBQVM4QixxQkFBcUJoQyxHQUFZO0lBQy9DLE1BQU1DLE1BQU1ELElBQUlFLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDO0lBQzVCLElBQUksQ0FBQ0YsS0FBSyxPQUFPO0lBQ2pCLE1BQU0sQ0FBQ1MsR0FBRyxHQUFHVCxJQUFJVyxLQUFLLENBQUM7SUFDdkIsT0FBT0YsTUFBTTtBQUNmO0FBRU8sU0FBU3VCLGtCQUFrQkgsSUFBYSxFQUFFSSxHQUFlO0lBQzlELElBQUksQ0FBQ0osS0FBS0osTUFBTSxDQUFDUyxRQUFRLENBQUNELE1BQU07UUFDOUIsT0FBTyxJQUFJOUIsU0FBU0MsS0FBS0MsU0FBUyxDQUFDO1lBQUVDLElBQUk7WUFBT0MsU0FBUyxDQUFDLHlCQUF5QixFQUFFMEIsS0FBSztRQUFDLElBQUk7WUFBRXpCLFFBQVE7WUFBS1AsU0FBUztnQkFBRSxnQkFBZ0I7WUFBbUI7UUFBRTtJQUNoSztBQUNGIiwic291cmNlcyI6WyJDOlxcQUktQk9TXFxhaWJvcy1lcnBCT1NcXGFwcHNcXGJmZlxcYXBwXFxsaWJcXGF1dGgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGNyeXB0byBmcm9tIFwibm9kZTpjcnlwdG9cIjtcclxuaW1wb3J0IHsgcG9vbCB9IGZyb20gXCIuL2RiXCI7XHJcbmltcG9ydCB7IENhcGFiaWxpdHksIG5vcm1hbGl6ZVNjb3BlcyB9IGZyb20gXCIuL3JiYWNcIjtcclxuaW1wb3J0IHsgcmF0ZUxpbWl0Q2hlY2ssIHJldHJ5QWZ0ZXJTZWNzIH0gZnJvbSBcIi4vcmF0ZWxpbWl0XCI7XHJcbmltcG9ydCB7IGxvZ0xpbmUgfSBmcm9tIFwiLi9sb2dcIjtcclxuXHJcbmV4cG9ydCB0eXBlIEF1dGhDdHggPSB7XHJcbiAgdXNlcl9pZDogc3RyaW5nO1xyXG4gIGNvbXBhbnlfaWQ6IHN0cmluZztcclxuICByb2xlOiBcImFkbWluXCIgfCBcImFjY291bnRhbnRcIiB8IFwib3BzXCI7XHJcbiAgc2NvcGVzOiBDYXBhYmlsaXR5W107XHJcbn07XHJcblxyXG5mdW5jdGlvbiBzaGEyNTYoeDogc3RyaW5nKSB7XHJcbiAgcmV0dXJuIGNyeXB0by5jcmVhdGVIYXNoKFwic2hhMjU2XCIpLnVwZGF0ZSh4LCBcInV0ZjhcIikuZGlnZXN0KFwiaGV4XCIpO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVxdWlyZUF1dGgocmVxOiBSZXF1ZXN0KTogUHJvbWlzZTxBdXRoQ3R4IHwgUmVzcG9uc2U+IHtcclxuICBjb25zdCByYXcgPSByZXEuaGVhZGVycy5nZXQoXCJ4LWFwaS1rZXlcIik7XHJcbiAgaWYgKCFyYXcpIHJldHVybiBuZXcgUmVzcG9uc2UoSlNPTi5zdHJpbmdpZnkoeyBvazogZmFsc2UsIG1lc3NhZ2U6IFwiTWlzc2luZyBYLUFQSS1LZXlcIiB9KSwgeyBzdGF0dXM6IDQwMSwgaGVhZGVyczogeyBcImNvbnRlbnQtdHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIiB9IH0pO1xyXG5cclxuICBjb25zdCBbaWQsIHNlY3JldF0gPSByYXcuc3BsaXQoXCI6XCIpO1xyXG4gIGlmICghaWQgfHwgIXNlY3JldCkgcmV0dXJuIG5ldyBSZXNwb25zZShKU09OLnN0cmluZ2lmeSh7IG9rOiBmYWxzZSwgbWVzc2FnZTogXCJJbnZhbGlkIEFQSSBrZXkgZm9ybWF0XCIgfSksIHsgc3RhdHVzOiA0MDEsIGhlYWRlcnM6IHsgXCJjb250ZW50LXR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIgfSB9KTtcclxuXHJcbiAgLy8gcmF0ZSBsaW1pdCBwZXIga2V5IGlkIChldmVuIGJlZm9yZSBEQiBsb29rdXApXHJcbiAgaWYgKCFyYXRlTGltaXRDaGVjayhpZCkpIHtcclxuICAgIGNvbnN0IHJhID0gcmV0cnlBZnRlclNlY3MoaWQpO1xyXG4gICAgY29uc3QgaGVhZGVycyA9IG5ldyBIZWFkZXJzKHsgXCJSZXRyeS1BZnRlclwiOiBTdHJpbmcocmEpLCBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIiB9KTtcclxuICAgIHJldHVybiBuZXcgUmVzcG9uc2UoSlNPTi5zdHJpbmdpZnkoeyBvazogZmFsc2UsIG1lc3NhZ2U6IFwicmF0ZSBsaW1pdGVkXCIgfSksIHsgc3RhdHVzOiA0MjksIGhlYWRlcnMgfSk7XHJcbiAgfVxyXG5cclxuICBjb25zdCB7IHJvd3MgfSA9IGF3YWl0IHBvb2wucXVlcnkoXHJcbiAgICBgc2VsZWN0IGsudXNlcl9pZCwgay5jb21wYW55X2lkLCBrLmVuYWJsZWQsIGsuaGFzaCwgay5zY29wZXMsIGsucHJlZml4LCBtLnJvbGVcclxuICAgICAgIGZyb20gYXBpX2tleSBrXHJcbiAgICAgICBqb2luIG1lbWJlcnNoaXAgbSBvbiBtLnVzZXJfaWQgPSBrLnVzZXJfaWQgYW5kIG0uY29tcGFueV9pZCA9IGsuY29tcGFueV9pZFxyXG4gICAgICB3aGVyZSBrLmlkID0gJDFcclxuICAgICAgbGltaXQgMWAsXHJcbiAgICBbaWRdXHJcbiAgKTtcclxuICBjb25zdCBrID0gcm93c1swXTtcclxuICBpZiAoIWsgfHwgay5lbmFibGVkICE9PSBcInRydWVcIikgcmV0dXJuIG5ldyBSZXNwb25zZShKU09OLnN0cmluZ2lmeSh7IG9rOiBmYWxzZSwgbWVzc2FnZTogXCJBUEkga2V5IGRpc2FibGVkIG9yIG5vdCBmb3VuZFwiIH0pLCB7IHN0YXR1czogNDAxLCBoZWFkZXJzOiB7IFwiY29udGVudC10eXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiIH0gfSk7XHJcbiAgaWYgKHNoYTI1NihzZWNyZXQpICE9PSBrLmhhc2gpIHJldHVybiBuZXcgUmVzcG9uc2UoSlNPTi5zdHJpbmdpZnkoeyBvazogZmFsc2UsIG1lc3NhZ2U6IFwiSW52YWxpZCBBUEkga2V5IHNlY3JldFwiIH0pLCB7IHN0YXR1czogNDAxLCBoZWFkZXJzOiB7IFwiY29udGVudC10eXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiIH0gfSk7XHJcblxyXG4gIC8vIHRvdWNoIGxhc3RfdXNlZF9hdCBhc3luY2hyb25vdXNseSAoZG9uJ3QgYmxvY2sgcGF0aClcclxuICBwb29sLnF1ZXJ5KGB1cGRhdGUgYXBpX2tleSBzZXQgbGFzdF91c2VkX2F0ID0gbm93KCkgd2hlcmUgaWQgPSAkMWAsIFtpZF0pLmNhdGNoKCgpID0+IHsgfSk7XHJcblxyXG4gIGNvbnN0IHJvbGUgPSAoay5yb2xlIGFzIFwiYWRtaW5cIiB8IFwiYWNjb3VudGFudFwiIHwgXCJvcHNcIikgPz8gXCJvcHNcIjtcclxuICBjb25zdCByZXFTY29wZXM6IHN0cmluZ1tdID0gQXJyYXkuaXNBcnJheShrLnNjb3BlcykgPyBrLnNjb3BlcyA6IFtdO1xyXG4gIGNvbnN0IHNjb3BlcyA9IG5vcm1hbGl6ZVNjb3Blcyhyb2xlLCByZXFTY29wZXMpO1xyXG5cclxuICByZXR1cm4geyB1c2VyX2lkOiBrLnVzZXJfaWQsIGNvbXBhbnlfaWQ6IGsuY29tcGFueV9pZCwgcm9sZSwgc2NvcGVzIH07XHJcbn1cclxuXHJcbi8qKiBFbnN1cmUgYW55IHByb3ZpZGVkIGNvbXBhbnlfaWQgbWF0Y2hlcyBhdXRoICovXHJcbmV4cG9ydCBmdW5jdGlvbiBlbmZvcmNlQ29tcGFueU1hdGNoKGF1dGg6IEF1dGhDdHgsIHByb3ZpZGVkPzogc3RyaW5nIHwgbnVsbCk6IFJlc3BvbnNlIHwgdm9pZCB7XHJcbiAgaWYgKCFwcm92aWRlZCkgcmV0dXJuO1xyXG4gIGlmIChwcm92aWRlZCAhPT0gYXV0aC5jb21wYW55X2lkKSB7XHJcbiAgICByZXR1cm4gbmV3IFJlc3BvbnNlKEpTT04uc3RyaW5naWZ5KHsgb2s6IGZhbHNlLCBtZXNzYWdlOiBcImNvbXBhbnlfaWQgbWlzbWF0Y2hcIiB9KSwgeyBzdGF0dXM6IDQwMywgaGVhZGVyczogeyBcImNvbnRlbnQtdHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIiB9IH0pO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlS2V5SWRGcm9tSGVhZGVyKHJlcTogUmVxdWVzdCk6IHN0cmluZyB8IG51bGwge1xyXG4gIGNvbnN0IHJhdyA9IHJlcS5oZWFkZXJzLmdldChcIngtYXBpLWtleVwiKTtcclxuICBpZiAoIXJhdykgcmV0dXJuIG51bGw7XHJcbiAgY29uc3QgW2lkXSA9IHJhdy5zcGxpdChcIjpcIik7XHJcbiAgcmV0dXJuIGlkIHx8IG51bGw7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiByZXF1aXJlQ2FwYWJpbGl0eShhdXRoOiBBdXRoQ3R4LCBjYXA6IENhcGFiaWxpdHkpOiBSZXNwb25zZSB8IHZvaWQge1xyXG4gIGlmICghYXV0aC5zY29wZXMuaW5jbHVkZXMoY2FwKSkge1xyXG4gICAgcmV0dXJuIG5ldyBSZXNwb25zZShKU09OLnN0cmluZ2lmeSh7IG9rOiBmYWxzZSwgbWVzc2FnZTogYGZvcmJpZGRlbjogbWlzc2luZyBzY29wZSAke2NhcH1gIH0pLCB7IHN0YXR1czogNDAzLCBoZWFkZXJzOiB7IFwiY29udGVudC10eXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiIH0gfSk7XHJcbiAgfVxyXG59XHJcbiJdLCJuYW1lcyI6WyJjcnlwdG8iLCJwb29sIiwibm9ybWFsaXplU2NvcGVzIiwicmF0ZUxpbWl0Q2hlY2siLCJyZXRyeUFmdGVyU2VjcyIsInNoYTI1NiIsIngiLCJjcmVhdGVIYXNoIiwidXBkYXRlIiwiZGlnZXN0IiwicmVxdWlyZUF1dGgiLCJyZXEiLCJyYXciLCJoZWFkZXJzIiwiZ2V0IiwiUmVzcG9uc2UiLCJKU09OIiwic3RyaW5naWZ5Iiwib2siLCJtZXNzYWdlIiwic3RhdHVzIiwiaWQiLCJzZWNyZXQiLCJzcGxpdCIsInJhIiwiSGVhZGVycyIsIlN0cmluZyIsInJvd3MiLCJxdWVyeSIsImsiLCJlbmFibGVkIiwiaGFzaCIsImNhdGNoIiwicm9sZSIsInJlcVNjb3BlcyIsIkFycmF5IiwiaXNBcnJheSIsInNjb3BlcyIsInVzZXJfaWQiLCJjb21wYW55X2lkIiwiZW5mb3JjZUNvbXBhbnlNYXRjaCIsImF1dGgiLCJwcm92aWRlZCIsInBhcnNlS2V5SWRGcm9tSGVhZGVyIiwicmVxdWlyZUNhcGFiaWxpdHkiLCJjYXAiLCJpbmNsdWRlcyJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/lib/auth.ts\n");

/***/ }),

/***/ "(rsc)/./app/lib/db.ts":
/*!***********************!*\
  !*** ./app/lib/db.ts ***!
  \***********************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   pool: () => (/* binding */ pool),\n/* harmony export */   repo: () => (/* binding */ repo),\n/* harmony export */   tx: () => (/* binding */ tx)\n/* harmony export */ });\n/* harmony import */ var pg__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! pg */ \"pg\");\n/* harmony import */ var _packages_adapters_db_src_repo__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../packages/adapters/db/src/repo */ \"(rsc)/../../packages/adapters/db/src/repo.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([pg__WEBPACK_IMPORTED_MODULE_0__, _packages_adapters_db_src_repo__WEBPACK_IMPORTED_MODULE_1__]);\n([pg__WEBPACK_IMPORTED_MODULE_0__, _packages_adapters_db_src_repo__WEBPACK_IMPORTED_MODULE_1__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\nconst pool = new pg__WEBPACK_IMPORTED_MODULE_0__.Pool({\n    connectionString: process.env.DATABASE_URL || \"postgresql://aibos:aibos@localhost:5432/aibos\"\n});\nconst tx = new _packages_adapters_db_src_repo__WEBPACK_IMPORTED_MODULE_1__.DrizzleTxManager(pool);\nconst repo = new _packages_adapters_db_src_repo__WEBPACK_IMPORTED_MODULE_1__.DrizzleLedgerRepo(pool);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvbGliL2RiLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQTBCO0FBQ3NFO0FBRXpGLE1BQU1HLE9BQU8sSUFBSUgsb0NBQUlBLENBQUM7SUFDekJJLGtCQUFrQkMsUUFBUUMsR0FBRyxDQUFDQyxZQUFZLElBQUk7QUFDbEQsR0FBRztBQUNJLE1BQU1DLEtBQUssSUFBSU4sNEVBQWdCQSxDQUFDQyxNQUFNO0FBQ3RDLE1BQU1NLE9BQU8sSUFBSVIsNkVBQWlCQSxDQUFDRSxNQUFNIiwic291cmNlcyI6WyJDOlxcQUktQk9TXFxhaWJvcy1lcnBCT1NcXGFwcHNcXGJmZlxcYXBwXFxsaWJcXGRiLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBvb2wgfSBmcm9tIFwicGdcIjtcclxuaW1wb3J0IHsgRHJpenpsZUxlZGdlclJlcG8sIERyaXp6bGVUeE1hbmFnZXIgfSBmcm9tIFwiLi4vLi4vLi4vLi4vcGFja2FnZXMvYWRhcHRlcnMvZGIvc3JjL3JlcG9cIjtcclxuXHJcbmV4cG9ydCBjb25zdCBwb29sID0gbmV3IFBvb2woe1xyXG4gICAgY29ubmVjdGlvblN0cmluZzogcHJvY2Vzcy5lbnYuREFUQUJBU0VfVVJMIHx8IFwicG9zdGdyZXNxbDovL2FpYm9zOmFpYm9zQGxvY2FsaG9zdDo1NDMyL2FpYm9zXCJcclxufSk7XHJcbmV4cG9ydCBjb25zdCB0eCA9IG5ldyBEcml6emxlVHhNYW5hZ2VyKHBvb2wpO1xyXG5leHBvcnQgY29uc3QgcmVwbyA9IG5ldyBEcml6emxlTGVkZ2VyUmVwbyhwb29sKTtcclxuIl0sIm5hbWVzIjpbIlBvb2wiLCJEcml6emxlTGVkZ2VyUmVwbyIsIkRyaXp6bGVUeE1hbmFnZXIiLCJwb29sIiwiY29ubmVjdGlvblN0cmluZyIsInByb2Nlc3MiLCJlbnYiLCJEQVRBQkFTRV9VUkwiLCJ0eCIsInJlcG8iXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/lib/db.ts\n");

/***/ }),

/***/ "(rsc)/./app/lib/policy.ts":
/*!***************************!*\
  !*** ./app/lib/policy.ts ***!
  \***************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ensurePostingAllowed: () => (/* binding */ ensurePostingAllowed)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./db */ \"(rsc)/./app/lib/db.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_db__WEBPACK_IMPORTED_MODULE_0__]);\n_db__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n/** Returns Response with 422/423 if posting forbidden, void if allowed */ async function ensurePostingAllowed(company_id, postingISO) {\n    const { rows } = await _db__WEBPACK_IMPORTED_MODULE_0__.pool.query(`select id, status, start_date, end_date\n       from accounting_period\n      where company_id=$1\n        and start_date <= $2::timestamptz\n        and end_date   >= $2::timestamptz\n      order by start_date desc\n      limit 1`, [\n        company_id,\n        postingISO\n    ]);\n    if (!rows.length) {\n        return new Response(JSON.stringify({\n            ok: false,\n            message: \"No open period for posting date\"\n        }), {\n            status: 422,\n            headers: {\n                \"content-type\": \"application/json\"\n            }\n        });\n    }\n    const p = rows[0];\n    if (String(p.status).toUpperCase() !== \"OPEN\") {\n        return new Response(JSON.stringify({\n            ok: false,\n            message: \"Period is closed/locked\"\n        }), {\n            status: 423,\n            headers: {\n                \"content-type\": \"application/json\"\n            }\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvbGliL3BvbGljeS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUE0QjtBQUU1Qix3RUFBd0UsR0FDakUsZUFBZUMscUJBQXFCQyxVQUFrQixFQUFFQyxVQUFrQjtJQUM3RSxNQUFNLEVBQUVDLElBQUksRUFBRSxHQUFHLE1BQU1KLHFDQUFJQSxDQUFDSyxLQUFLLENBQzdCLENBQUM7Ozs7OzthQU1JLENBQUMsRUFDTjtRQUFDSDtRQUFZQztLQUFXO0lBRTVCLElBQUksQ0FBQ0MsS0FBS0UsTUFBTSxFQUFFO1FBQ2QsT0FBTyxJQUFJQyxTQUFTQyxLQUFLQyxTQUFTLENBQUM7WUFBRUMsSUFBSTtZQUFPQyxTQUFTO1FBQWtDLElBQUk7WUFBRUMsUUFBUTtZQUFLQyxTQUFTO2dCQUFFLGdCQUFnQjtZQUFtQjtRQUFFO0lBQ2xLO0lBQ0EsTUFBTUMsSUFBSVYsSUFBSSxDQUFDLEVBQUU7SUFDakIsSUFBSVcsT0FBT0QsRUFBRUYsTUFBTSxFQUFFSSxXQUFXLE9BQU8sUUFBUTtRQUMzQyxPQUFPLElBQUlULFNBQVNDLEtBQUtDLFNBQVMsQ0FBQztZQUFFQyxJQUFJO1lBQU9DLFNBQVM7UUFBMEIsSUFBSTtZQUFFQyxRQUFRO1lBQUtDLFNBQVM7Z0JBQUUsZ0JBQWdCO1lBQW1CO1FBQUU7SUFDMUo7QUFDSiIsInNvdXJjZXMiOlsiQzpcXEFJLUJPU1xcYWlib3MtZXJwQk9TXFxhcHBzXFxiZmZcXGFwcFxcbGliXFxwb2xpY3kudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcG9vbCB9IGZyb20gXCIuL2RiXCI7XHJcblxyXG4vKiogUmV0dXJucyBSZXNwb25zZSB3aXRoIDQyMi80MjMgaWYgcG9zdGluZyBmb3JiaWRkZW4sIHZvaWQgaWYgYWxsb3dlZCAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZW5zdXJlUG9zdGluZ0FsbG93ZWQoY29tcGFueV9pZDogc3RyaW5nLCBwb3N0aW5nSVNPOiBzdHJpbmcpOiBQcm9taXNlPFJlc3BvbnNlIHwgdm9pZD4ge1xyXG4gICAgY29uc3QgeyByb3dzIH0gPSBhd2FpdCBwb29sLnF1ZXJ5KFxyXG4gICAgICAgIGBzZWxlY3QgaWQsIHN0YXR1cywgc3RhcnRfZGF0ZSwgZW5kX2RhdGVcclxuICAgICAgIGZyb20gYWNjb3VudGluZ19wZXJpb2RcclxuICAgICAgd2hlcmUgY29tcGFueV9pZD0kMVxyXG4gICAgICAgIGFuZCBzdGFydF9kYXRlIDw9ICQyOjp0aW1lc3RhbXB0elxyXG4gICAgICAgIGFuZCBlbmRfZGF0ZSAgID49ICQyOjp0aW1lc3RhbXB0elxyXG4gICAgICBvcmRlciBieSBzdGFydF9kYXRlIGRlc2NcclxuICAgICAgbGltaXQgMWAsXHJcbiAgICAgICAgW2NvbXBhbnlfaWQsIHBvc3RpbmdJU09dXHJcbiAgICApO1xyXG4gICAgaWYgKCFyb3dzLmxlbmd0aCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UoSlNPTi5zdHJpbmdpZnkoeyBvazogZmFsc2UsIG1lc3NhZ2U6IFwiTm8gb3BlbiBwZXJpb2QgZm9yIHBvc3RpbmcgZGF0ZVwiIH0pLCB7IHN0YXR1czogNDIyLCBoZWFkZXJzOiB7IFwiY29udGVudC10eXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiIH0gfSk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBwID0gcm93c1swXTtcclxuICAgIGlmIChTdHJpbmcocC5zdGF0dXMpLnRvVXBwZXJDYXNlKCkgIT09IFwiT1BFTlwiKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShKU09OLnN0cmluZ2lmeSh7IG9rOiBmYWxzZSwgbWVzc2FnZTogXCJQZXJpb2QgaXMgY2xvc2VkL2xvY2tlZFwiIH0pLCB7IHN0YXR1czogNDIzLCBoZWFkZXJzOiB7IFwiY29udGVudC10eXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiIH0gfSk7XHJcbiAgICB9XHJcbn1cclxuIl0sIm5hbWVzIjpbInBvb2wiLCJlbnN1cmVQb3N0aW5nQWxsb3dlZCIsImNvbXBhbnlfaWQiLCJwb3N0aW5nSVNPIiwicm93cyIsInF1ZXJ5IiwibGVuZ3RoIiwiUmVzcG9uc2UiLCJKU09OIiwic3RyaW5naWZ5Iiwib2siLCJtZXNzYWdlIiwic3RhdHVzIiwiaGVhZGVycyIsInAiLCJTdHJpbmciLCJ0b1VwcGVyQ2FzZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/lib/policy.ts\n");

/***/ }),

/***/ "(rsc)/./app/lib/ratelimit.ts":
/*!******************************!*\
  !*** ./app/lib/ratelimit.ts ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   rateLimitCheck: () => (/* binding */ rateLimitCheck),\n/* harmony export */   retryAfterSecs: () => (/* binding */ retryAfterSecs)\n/* harmony export */ });\nconst buckets = new Map();\n// defaults: 60 req/min, burst 30\nconst DEFAULT_RATE = {\n    refillPerSec: 60 / 60,\n    capacity: 30\n};\nfunction rateLimitCheck(keyId, now = Date.now(), rate = DEFAULT_RATE) {\n    const b = buckets.get(keyId) ?? {\n        tokens: rate.capacity,\n        updated: now\n    };\n    const elapsed = (now - b.updated) / 1000;\n    const refill = elapsed * rate.refillPerSec;\n    b.tokens = Math.min(rate.capacity, b.tokens + refill);\n    b.updated = now;\n    if (b.tokens < 1) {\n        buckets.set(keyId, b);\n        return false;\n    }\n    b.tokens -= 1;\n    buckets.set(keyId, b);\n    return true;\n}\n/** Seconds until next token */ function retryAfterSecs(keyId, now = Date.now(), rate = DEFAULT_RATE) {\n    const b = buckets.get(keyId);\n    if (!b) return 0;\n    if (b.tokens >= 1) return 0;\n    const deficit = 1 - b.tokens;\n    return Math.ceil(deficit / rate.refillPerSec);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvbGliL3JhdGVsaW1pdC50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUNBLE1BQU1BLFVBQVUsSUFBSUM7QUFFcEIsaUNBQWlDO0FBQ2pDLE1BQU1DLGVBQWU7SUFBRUMsY0FBYyxLQUFLO0lBQUlDLFVBQVU7QUFBRztBQUVwRCxTQUFTQyxlQUFlQyxLQUFhLEVBQUVDLE1BQU1DLEtBQUtELEdBQUcsRUFBRSxFQUFFRSxPQUFPUCxZQUFZO0lBQy9FLE1BQU1RLElBQUlWLFFBQVFXLEdBQUcsQ0FBQ0wsVUFBVTtRQUFFTSxRQUFRSCxLQUFLTCxRQUFRO1FBQUVTLFNBQVNOO0lBQUk7SUFDdEUsTUFBTU8sVUFBVSxDQUFDUCxNQUFNRyxFQUFFRyxPQUFPLElBQUk7SUFDcEMsTUFBTUUsU0FBU0QsVUFBVUwsS0FBS04sWUFBWTtJQUMxQ08sRUFBRUUsTUFBTSxHQUFHSSxLQUFLQyxHQUFHLENBQUNSLEtBQUtMLFFBQVEsRUFBRU0sRUFBRUUsTUFBTSxHQUFHRztJQUM5Q0wsRUFBRUcsT0FBTyxHQUFHTjtJQUNaLElBQUlHLEVBQUVFLE1BQU0sR0FBRyxHQUFHO1FBQ2RaLFFBQVFrQixHQUFHLENBQUNaLE9BQU9JO1FBQ25CLE9BQU87SUFDWDtJQUNBQSxFQUFFRSxNQUFNLElBQUk7SUFDWlosUUFBUWtCLEdBQUcsQ0FBQ1osT0FBT0k7SUFDbkIsT0FBTztBQUNYO0FBRUEsNkJBQTZCLEdBQ3RCLFNBQVNTLGVBQWViLEtBQWEsRUFBRUMsTUFBTUMsS0FBS0QsR0FBRyxFQUFFLEVBQUVFLE9BQU9QLFlBQVk7SUFDL0UsTUFBTVEsSUFBSVYsUUFBUVcsR0FBRyxDQUFDTDtJQUN0QixJQUFJLENBQUNJLEdBQUcsT0FBTztJQUNmLElBQUlBLEVBQUVFLE1BQU0sSUFBSSxHQUFHLE9BQU87SUFDMUIsTUFBTVEsVUFBVSxJQUFJVixFQUFFRSxNQUFNO0lBQzVCLE9BQU9JLEtBQUtLLElBQUksQ0FBQ0QsVUFBVVgsS0FBS04sWUFBWTtBQUNoRCIsInNvdXJjZXMiOlsiQzpcXEFJLUJPU1xcYWlib3MtZXJwQk9TXFxhcHBzXFxiZmZcXGFwcFxcbGliXFxyYXRlbGltaXQudHMiXSwic291cmNlc0NvbnRlbnQiOlsidHlwZSBCdWNrZXQgPSB7IHRva2VuczogbnVtYmVyOyB1cGRhdGVkOiBudW1iZXIgfTtcclxuY29uc3QgYnVja2V0cyA9IG5ldyBNYXA8c3RyaW5nLCBCdWNrZXQ+KCk7XHJcblxyXG4vLyBkZWZhdWx0czogNjAgcmVxL21pbiwgYnVyc3QgMzBcclxuY29uc3QgREVGQVVMVF9SQVRFID0geyByZWZpbGxQZXJTZWM6IDYwIC8gNjAsIGNhcGFjaXR5OiAzMCB9O1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHJhdGVMaW1pdENoZWNrKGtleUlkOiBzdHJpbmcsIG5vdyA9IERhdGUubm93KCksIHJhdGUgPSBERUZBVUxUX1JBVEUpOiBib29sZWFuIHtcclxuICAgIGNvbnN0IGIgPSBidWNrZXRzLmdldChrZXlJZCkgPz8geyB0b2tlbnM6IHJhdGUuY2FwYWNpdHksIHVwZGF0ZWQ6IG5vdyB9O1xyXG4gICAgY29uc3QgZWxhcHNlZCA9IChub3cgLSBiLnVwZGF0ZWQpIC8gMTAwMDtcclxuICAgIGNvbnN0IHJlZmlsbCA9IGVsYXBzZWQgKiByYXRlLnJlZmlsbFBlclNlYztcclxuICAgIGIudG9rZW5zID0gTWF0aC5taW4ocmF0ZS5jYXBhY2l0eSwgYi50b2tlbnMgKyByZWZpbGwpO1xyXG4gICAgYi51cGRhdGVkID0gbm93O1xyXG4gICAgaWYgKGIudG9rZW5zIDwgMSkge1xyXG4gICAgICAgIGJ1Y2tldHMuc2V0KGtleUlkLCBiKTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBiLnRva2VucyAtPSAxO1xyXG4gICAgYnVja2V0cy5zZXQoa2V5SWQsIGIpO1xyXG4gICAgcmV0dXJuIHRydWU7XHJcbn1cclxuXHJcbi8qKiBTZWNvbmRzIHVudGlsIG5leHQgdG9rZW4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHJldHJ5QWZ0ZXJTZWNzKGtleUlkOiBzdHJpbmcsIG5vdyA9IERhdGUubm93KCksIHJhdGUgPSBERUZBVUxUX1JBVEUpOiBudW1iZXIge1xyXG4gICAgY29uc3QgYiA9IGJ1Y2tldHMuZ2V0KGtleUlkKTtcclxuICAgIGlmICghYikgcmV0dXJuIDA7XHJcbiAgICBpZiAoYi50b2tlbnMgPj0gMSkgcmV0dXJuIDA7XHJcbiAgICBjb25zdCBkZWZpY2l0ID0gMSAtIGIudG9rZW5zO1xyXG4gICAgcmV0dXJuIE1hdGguY2VpbChkZWZpY2l0IC8gcmF0ZS5yZWZpbGxQZXJTZWMpO1xyXG59XHJcbiJdLCJuYW1lcyI6WyJidWNrZXRzIiwiTWFwIiwiREVGQVVMVF9SQVRFIiwicmVmaWxsUGVyU2VjIiwiY2FwYWNpdHkiLCJyYXRlTGltaXRDaGVjayIsImtleUlkIiwibm93IiwiRGF0ZSIsInJhdGUiLCJiIiwiZ2V0IiwidG9rZW5zIiwidXBkYXRlZCIsImVsYXBzZWQiLCJyZWZpbGwiLCJNYXRoIiwibWluIiwic2V0IiwicmV0cnlBZnRlclNlY3MiLCJkZWZpY2l0IiwiY2VpbCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/lib/ratelimit.ts\n");

/***/ }),

/***/ "(rsc)/./app/lib/rbac.ts":
/*!*************************!*\
  !*** ./app/lib/rbac.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ROLE_CAPS: () => (/* binding */ ROLE_CAPS),\n/* harmony export */   normalizeScopes: () => (/* binding */ normalizeScopes)\n/* harmony export */ });\nconst ROLE_CAPS = {\n    admin: [\n        \"reports:read\",\n        \"journals:post\",\n        \"reversal:create\",\n        \"inventory:move\",\n        \"payments:post\",\n        \"periods:manage\",\n        \"keys:manage\",\n        \"audit:read\"\n    ],\n    accountant: [\n        \"reports:read\",\n        \"journals:post\",\n        \"reversal:create\",\n        \"inventory:move\",\n        \"payments:post\",\n        \"audit:read\"\n    ],\n    ops: [\n        \"reports:read\",\n        \"inventory:move\",\n        \"audit:read\"\n    ]\n};\n/** Validate requested scopes are within role's caps */ function normalizeScopes(role, requested) {\n    const roleCaps = new Set(ROLE_CAPS[role]);\n    if (!requested || !requested.length) return Array.from(roleCaps);\n    return requested.filter((s)=>roleCaps.has(s));\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvbGliL3JiYWMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFVTyxNQUFNQSxZQUFrRTtJQUMzRUMsT0FBTztRQUNIO1FBQWdCO1FBQWlCO1FBQW1CO1FBQ3BEO1FBQWlCO1FBQWtCO1FBQWU7S0FDckQ7SUFDREMsWUFBWTtRQUNSO1FBQWdCO1FBQWlCO1FBQW1CO1FBQ3BEO1FBQWlCO0tBQ3BCO0lBQ0RDLEtBQUs7UUFDRDtRQUFnQjtRQUFrQjtLQUNyQztBQUNMLEVBQUU7QUFFRixxREFBcUQsR0FDOUMsU0FBU0MsZ0JBQWdCQyxJQUFvQyxFQUFFQyxTQUFvQjtJQUN0RixNQUFNQyxXQUFXLElBQUlDLElBQUlSLFNBQVMsQ0FBQ0ssS0FBSztJQUN4QyxJQUFJLENBQUNDLGFBQWEsQ0FBQ0EsVUFBVUcsTUFBTSxFQUFFLE9BQU9DLE1BQU1DLElBQUksQ0FBQ0o7SUFDdkQsT0FBT0QsVUFBVU0sTUFBTSxDQUFDLENBQUNDLElBQXVCTixTQUFTTyxHQUFHLENBQUNEO0FBQ2pFIiwic291cmNlcyI6WyJDOlxcQUktQk9TXFxhaWJvcy1lcnBCT1NcXGFwcHNcXGJmZlxcYXBwXFxsaWJcXHJiYWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IHR5cGUgQ2FwYWJpbGl0eSA9XHJcbiAgICB8IFwicmVwb3J0czpyZWFkXCJcclxuICAgIHwgXCJqb3VybmFsczpwb3N0XCJcclxuICAgIHwgXCJyZXZlcnNhbDpjcmVhdGVcIlxyXG4gICAgfCBcImludmVudG9yeTptb3ZlXCJcclxuICAgIHwgXCJwYXltZW50czpwb3N0XCJcclxuICAgIHwgXCJwZXJpb2RzOm1hbmFnZVwiXHJcbiAgICB8IFwia2V5czptYW5hZ2VcIlxyXG4gICAgfCBcImF1ZGl0OnJlYWRcIjtcclxuXHJcbmV4cG9ydCBjb25zdCBST0xFX0NBUFM6IFJlY29yZDxcImFkbWluXCIgfCBcImFjY291bnRhbnRcIiB8IFwib3BzXCIsIENhcGFiaWxpdHlbXT4gPSB7XHJcbiAgICBhZG1pbjogW1xyXG4gICAgICAgIFwicmVwb3J0czpyZWFkXCIsIFwiam91cm5hbHM6cG9zdFwiLCBcInJldmVyc2FsOmNyZWF0ZVwiLCBcImludmVudG9yeTptb3ZlXCIsXHJcbiAgICAgICAgXCJwYXltZW50czpwb3N0XCIsIFwicGVyaW9kczptYW5hZ2VcIiwgXCJrZXlzOm1hbmFnZVwiLCBcImF1ZGl0OnJlYWRcIlxyXG4gICAgXSxcclxuICAgIGFjY291bnRhbnQ6IFtcclxuICAgICAgICBcInJlcG9ydHM6cmVhZFwiLCBcImpvdXJuYWxzOnBvc3RcIiwgXCJyZXZlcnNhbDpjcmVhdGVcIiwgXCJpbnZlbnRvcnk6bW92ZVwiLFxyXG4gICAgICAgIFwicGF5bWVudHM6cG9zdFwiLCBcImF1ZGl0OnJlYWRcIlxyXG4gICAgXSxcclxuICAgIG9wczogW1xyXG4gICAgICAgIFwicmVwb3J0czpyZWFkXCIsIFwiaW52ZW50b3J5Om1vdmVcIiwgXCJhdWRpdDpyZWFkXCJcclxuICAgIF0sXHJcbn07XHJcblxyXG4vKiogVmFsaWRhdGUgcmVxdWVzdGVkIHNjb3BlcyBhcmUgd2l0aGluIHJvbGUncyBjYXBzICovXHJcbmV4cG9ydCBmdW5jdGlvbiBub3JtYWxpemVTY29wZXMocm9sZTogXCJhZG1pblwiIHwgXCJhY2NvdW50YW50XCIgfCBcIm9wc1wiLCByZXF1ZXN0ZWQ/OiBzdHJpbmdbXSk6IENhcGFiaWxpdHlbXSB7XHJcbiAgICBjb25zdCByb2xlQ2FwcyA9IG5ldyBTZXQoUk9MRV9DQVBTW3JvbGVdKTtcclxuICAgIGlmICghcmVxdWVzdGVkIHx8ICFyZXF1ZXN0ZWQubGVuZ3RoKSByZXR1cm4gQXJyYXkuZnJvbShyb2xlQ2Fwcyk7XHJcbiAgICByZXR1cm4gcmVxdWVzdGVkLmZpbHRlcigocyk6IHMgaXMgQ2FwYWJpbGl0eSA9PiByb2xlQ2Fwcy5oYXMocyBhcyBDYXBhYmlsaXR5KSk7XHJcbn1cclxuIl0sIm5hbWVzIjpbIlJPTEVfQ0FQUyIsImFkbWluIiwiYWNjb3VudGFudCIsIm9wcyIsIm5vcm1hbGl6ZVNjb3BlcyIsInJvbGUiLCJyZXF1ZXN0ZWQiLCJyb2xlQ2FwcyIsIlNldCIsImxlbmd0aCIsIkFycmF5IiwiZnJvbSIsImZpbHRlciIsInMiLCJoYXMiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/lib/rbac.ts\n");

/***/ }),

/***/ "(rsc)/./app/lib/route-utils.ts":
/*!********************************!*\
  !*** ./app/lib/route-utils.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   isResponse: () => (/* binding */ isResponse),\n/* harmony export */   withRouteErrors: () => (/* binding */ withRouteErrors)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/../../node_modules/.pnpm/next@15.5.4_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/api/server.js\");\n\n/**\r\n * Type guard to check if a value is a Response object\r\n */ function isResponse(x) {\n    return x instanceof Response;\n}\n/**\r\n * Error boundary wrapper to catch truly unexpected exceptions\r\n * Use this to wrap route handlers for consistent error handling\r\n */ function withRouteErrors(fn) {\n    return async (req, ...args)=>{\n        try {\n            return await fn(req, ...args);\n        } catch (err) {\n            console.error(\"Unhandled route error:\", err);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                ok: false,\n                error: \"InternalServerError\",\n                message: \"Internal Server Error\"\n            }, {\n                status: 500\n            });\n        }\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvbGliL3JvdXRlLXV0aWxzLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUEyQztBQUUzQzs7Q0FFQyxHQUNNLFNBQVNDLFdBQVdDLENBQVU7SUFDbkMsT0FBT0EsYUFBYUM7QUFDdEI7QUFFQTs7O0NBR0MsR0FDTSxTQUFTQyxnQkFFZEMsRUFBSztJQUNMLE9BQVEsT0FBT0MsS0FBYyxHQUFHQztRQUM5QixJQUFJO1lBQ0YsT0FBTyxNQUFNRixHQUFHQyxRQUFRQztRQUMxQixFQUFFLE9BQU9DLEtBQUs7WUFDWkMsUUFBUUMsS0FBSyxDQUFDLDBCQUEwQkY7WUFDeEMsT0FBT1IscURBQVlBLENBQUNXLElBQUksQ0FBQztnQkFDdkJDLElBQUk7Z0JBQ0pGLE9BQU87Z0JBQ1BHLFNBQVM7WUFDWCxHQUFHO2dCQUFFQyxRQUFRO1lBQUk7UUFDbkI7SUFDRjtBQUNGIiwic291cmNlcyI6WyJDOlxcQUktQk9TXFxhaWJvcy1lcnBCT1NcXGFwcHNcXGJmZlxcYXBwXFxsaWJcXHJvdXRlLXV0aWxzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gXCJuZXh0L3NlcnZlclwiO1xyXG5cclxuLyoqXHJcbiAqIFR5cGUgZ3VhcmQgdG8gY2hlY2sgaWYgYSB2YWx1ZSBpcyBhIFJlc3BvbnNlIG9iamVjdFxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGlzUmVzcG9uc2UoeDogdW5rbm93bik6IHggaXMgUmVzcG9uc2Uge1xyXG4gIHJldHVybiB4IGluc3RhbmNlb2YgUmVzcG9uc2U7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBFcnJvciBib3VuZGFyeSB3cmFwcGVyIHRvIGNhdGNoIHRydWx5IHVuZXhwZWN0ZWQgZXhjZXB0aW9uc1xyXG4gKiBVc2UgdGhpcyB0byB3cmFwIHJvdXRlIGhhbmRsZXJzIGZvciBjb25zaXN0ZW50IGVycm9yIGhhbmRsaW5nXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gd2l0aFJvdXRlRXJyb3JzPFxyXG4gIEYgZXh0ZW5kcyAocmVxOiBSZXF1ZXN0LCAuLi5hcmdzOiBhbnlbXSkgPT4gUHJvbWlzZTxSZXNwb25zZT5cclxuPihmbjogRik6IEYge1xyXG4gIHJldHVybiAoYXN5bmMgKHJlcTogUmVxdWVzdCwgLi4uYXJnczogYW55W10pID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIHJldHVybiBhd2FpdCBmbihyZXEsIC4uLmFyZ3MpO1xyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJVbmhhbmRsZWQgcm91dGUgZXJyb3I6XCIsIGVycik7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IFxyXG4gICAgICAgIG9rOiBmYWxzZSwgXHJcbiAgICAgICAgZXJyb3I6IFwiSW50ZXJuYWxTZXJ2ZXJFcnJvclwiLCBcclxuICAgICAgICBtZXNzYWdlOiBcIkludGVybmFsIFNlcnZlciBFcnJvclwiIFxyXG4gICAgICB9LCB7IHN0YXR1czogNTAwIH0pO1xyXG4gICAgfVxyXG4gIH0pIGFzIEY7XHJcbn1cclxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImlzUmVzcG9uc2UiLCJ4IiwiUmVzcG9uc2UiLCJ3aXRoUm91dGVFcnJvcnMiLCJmbiIsInJlcSIsImFyZ3MiLCJlcnIiLCJjb25zb2xlIiwiZXJyb3IiLCJqc29uIiwib2siLCJtZXNzYWdlIiwic3RhdHVzIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/lib/route-utils.ts\n");

/***/ }),

/***/ "(ssr)/../../node_modules/.pnpm/next@15.5.4_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!*************************************************************************************************************************************************************************************!*\
  !*** ../../node_modules/.pnpm/next@15.5.4_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \*************************************************************************************************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "../app-render/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/server/app-render/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/action-async-storage.external.js");

/***/ }),

/***/ "../app-render/after-task-async-storage.external":
/*!***********************************************************************************!*\
  !*** external "next/dist/server/app-render/after-task-async-storage.external.js" ***!
  \***********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/after-task-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "next/dist/shared/lib/no-fallback-error.external":
/*!******************************************************************!*\
  !*** external "next/dist/shared/lib/no-fallback-error.external" ***!
  \******************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/no-fallback-error.external");

/***/ }),

/***/ "next/dist/shared/lib/router/utils/app-paths":
/*!**************************************************************!*\
  !*** external "next/dist/shared/lib/router/utils/app-paths" ***!
  \**************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router/utils/app-paths");

/***/ }),

/***/ "node:crypto":
/*!******************************!*\
  !*** external "node:crypto" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:crypto");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:fs");

/***/ }),

/***/ "node:path":
/*!****************************!*\
  !*** external "node:path" ***!
  \****************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:path");

/***/ }),

/***/ "node:url":
/*!***************************!*\
  !*** external "node:url" ***!
  \***************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:url");

/***/ }),

/***/ "pg":
/*!*********************!*\
  !*** external "pg" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = import("pg");;

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next@15.5.4_react-dom@19.1.1_react@19.1.1__react@19.1.1","vendor-chunks/drizzle-orm@0.44.5_@types+pg@8.15.5_pg@8.16.3","vendor-chunks/zod@3.25.76","vendor-chunks/json5@2.2.3"], () => (__webpack_exec__("(rsc)/../../node_modules/.pnpm/next@15.5.4_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fsales-invoices%2Froute&page=%2Fapi%2Fsales-invoices%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsales-invoices%2Froute.ts&appDir=C%3A%5CAI-BOS%5Caibos-erpBOS%5Capps%5Cbff%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CAI-BOS%5Caibos-erpBOS%5Capps%5Cbff&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D&isGlobalNotFoundEnabled=!")));
module.exports = __webpack_exports__;

})();